"use strict";var Cy=Object.defineProperty,Ry=Object.defineProperties,Oy=Object.getOwnPropertyDescriptors,up=Object.getOwnPropertySymbols,Py=Object.prototype.hasOwnProperty,Ly=Object.prototype.propertyIsEnumerable,cp=(nt,_e,X)=>_e in nt?Cy(nt,_e,{enumerable:!0,configurable:!0,writable:!0,value:X}):nt[_e]=X,lp=(nt,_e)=>{for(var X in _e||(_e={}))Py.call(_e,X)&&cp(nt,X,_e[X]);if(up)for(var X of up(_e))Ly.call(_e,X)&&cp(nt,X,_e[X]);return nt},hp=(nt,_e)=>Ry(nt,Oy(_e));(self.webpackChunkchaskigo=self.webpackChunkchaskigo||[]).push([[296],{2090:(nt,_e,X)=>{X.d(_e,{BH:()=>Sn,G6:()=>Xe,L:()=>Re,LL:()=>Qn,Pz:()=>Nt,Sg:()=>pn,ZB:()=>N,ZR:()=>kt,aH:()=>fn,b$:()=>me,eu:()=>M,hl:()=>bn,jU:()=>Se,m9:()=>Qe,ne:()=>It,q4:()=>Gt,r3:()=>si,ru:()=>pe,tV:()=>B,uI:()=>ve,vZ:()=>an,w1:()=>ce,xO:()=>Jn,xb:()=>br,z$:()=>oe});const le=function(v){const y=[];let w=0;for(let O=0;O<v.length;O++){let S=v.charCodeAt(O);S<128?y[w++]=S:S<2048?(y[w++]=S>>6|192,y[w++]=63&S|128):55296==(64512&S)&&O+1<v.length&&56320==(64512&v.charCodeAt(O+1))?(S=65536+((1023&S)<<10)+(1023&v.charCodeAt(++O)),y[w++]=S>>18|240,y[w++]=S>>12&63|128,y[w++]=S>>6&63|128,y[w++]=63&S|128):(y[w++]=S>>12|224,y[w++]=S>>6&63|128,y[w++]=63&S|128)}return y},ie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(v,y){if(!Array.isArray(v))throw Error("encodeByteArray takes an array as a parameter");this.init_();const w=y?this.byteToCharMapWebSafe_:this.byteToCharMap_,O=[];for(let S=0;S<v.length;S+=3){const W=v[S],ae=S+1<v.length,Ee=ae?v[S+1]:0,Je=S+2<v.length,rt=Je?v[S+2]:0;let Ft=(15&Ee)<<2|rt>>6,Xt=63&rt;Je||(Xt=64,ae||(Ft=64)),O.push(w[W>>2],w[(3&W)<<4|Ee>>4],w[Ft],w[Xt])}return O.join("")},encodeString(v,y){return this.HAS_NATIVE_SUPPORT&&!y?btoa(v):this.encodeByteArray(le(v),y)},decodeString(v,y){return this.HAS_NATIVE_SUPPORT&&!y?atob(v):function(v){const y=[];let w=0,O=0;for(;w<v.length;){const S=v[w++];if(S<128)y[O++]=String.fromCharCode(S);else if(S>191&&S<224){const W=v[w++];y[O++]=String.fromCharCode((31&S)<<6|63&W)}else if(S>239&&S<365){const Je=((7&S)<<18|(63&v[w++])<<12|(63&v[w++])<<6|63&v[w++])-65536;y[O++]=String.fromCharCode(55296+(Je>>10)),y[O++]=String.fromCharCode(56320+(1023&Je))}else{const W=v[w++],ae=v[w++];y[O++]=String.fromCharCode((15&S)<<12|(63&W)<<6|63&ae)}}return y.join("")}(this.decodeStringToByteArray(v,y))},decodeStringToByteArray(v,y){this.init_();const w=y?this.charToByteMapWebSafe_:this.charToByteMap_,O=[];for(let S=0;S<v.length;){const W=w[v.charAt(S++)],Ee=S<v.length?w[v.charAt(S)]:0;++S;const rt=S<v.length?w[v.charAt(S)]:64;++S;const fe=S<v.length?w[v.charAt(S)]:64;if(++S,null==W||null==Ee||null==rt||null==fe)throw Error();O.push(W<<2|Ee>>4),64!==rt&&(O.push(Ee<<4&240|rt>>2),64!==fe&&O.push(rt<<6&192|fe))}return O},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let v=0;v<this.ENCODED_VALS.length;v++)this.byteToCharMap_[v]=this.ENCODED_VALS.charAt(v),this.charToByteMap_[this.byteToCharMap_[v]]=v,this.byteToCharMapWebSafe_[v]=this.ENCODED_VALS_WEBSAFE.charAt(v),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[v]]=v,v>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(v)]=v,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(v)]=v)}}},Re=function(v){return function(v){const y=le(v);return ie.encodeByteArray(y,!0)}(v).replace(/\./g,"")},B=function(v){try{return ie.decodeString(v,!0)}catch(y){console.error("base64Decode failed: ",y)}return null};function N(v,y){if(!(y instanceof Object))return y;switch(y.constructor){case Date:return new Date(y.getTime());case Object:void 0===v&&(v={});break;case Array:v=[];break;default:return y}for(const w in y)!y.hasOwnProperty(w)||!J(w)||(v[w]=N(v[w],y[w]));return v}function J(v){return"__proto__"!==v}function oe(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function ve(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(oe())}function Se(){return"object"==typeof self&&self.self===self}function pe(){const v="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof v&&void 0!==v.id}function me(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ce(){const v=oe();return v.indexOf("MSIE ")>=0||v.indexOf("Trident/")>=0}function Xe(){return!function vt(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(v){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function bn(){return"object"==typeof indexedDB}function M(){return new Promise((v,y)=>{try{let w=!0;const O="validate-browser-context-for-indexeddb-analytics-module",S=self.indexedDB.open(O);S.onsuccess=()=>{S.result.close(),w||self.indexedDB.deleteDatabase(O),v(!0)},S.onupgradeneeded=()=>{w=!1},S.onerror=()=>{var W;y((null===(W=S.error)||void 0===W?void 0:W.message)||"")}}catch(w){y(w)}})}const qt=()=>{try{return function we(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const v=process.env.__FIREBASE_DEFAULTS__;return v?JSON.parse(v):void 0})()||(()=>{if("undefined"==typeof document)return;let v;try{v=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(w){return}const y=v&&B(v[1]);return y&&JSON.parse(y)})()}catch(v){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${v}`)}},Gt=v=>{var y,w;return null===(w=null===(y=qt())||void 0===y?void 0:y.emulatorHosts)||void 0===w?void 0:w[v]},fn=()=>{var v;return null===(v=qt())||void 0===v?void 0:v.config},Nt=v=>{var y;return null===(y=qt())||void 0===y?void 0:y[`_${v}`]};class Sn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((y,w)=>{this.resolve=y,this.reject=w})}wrapCallback(y){return(w,O)=>{w?this.reject(w):this.resolve(O),"function"==typeof y&&(this.promise.catch(()=>{}),1===y.length?y(w):y(w,O))}}}function pn(v,y){if(v.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const O=y||"demo-project",S=v.iat||0,W=v.sub||v.user_id;if(!W)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const ae=Object.assign({iss:`https://securetoken.google.com/${O}`,aud:O,iat:S,exp:S+3600,auth_time:S,sub:W,user_id:W,firebase:{sign_in_provider:"custom",identities:{}}},v);return[Re(JSON.stringify({alg:"none",type:"JWT"})),Re(JSON.stringify(ae)),""].join(".")}class kt extends Error{constructor(y,w,O){super(w),this.code=y,this.customData=O,this.name="FirebaseError",Object.setPrototypeOf(this,kt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qn.prototype.create)}}class Qn{constructor(y,w,O){this.service=y,this.serviceName=w,this.errors=O}create(y,...w){const O=w[0]||{},S=`${this.service}/${y}`,W=this.errors[y],ae=W?function Yn(v,y){return v.replace(Me,(w,O)=>{const S=y[O];return null!=S?String(S):`<${O}?>`})}(W,O):"Error";return new kt(S,`${this.serviceName}: ${ae} (${S}).`,O)}}const Me=/\{\$([^}]+)}/g;function si(v,y){return Object.prototype.hasOwnProperty.call(v,y)}function br(v){for(const y in v)if(Object.prototype.hasOwnProperty.call(v,y))return!1;return!0}function an(v,y){if(v===y)return!0;const w=Object.keys(v),O=Object.keys(y);for(const S of w){if(!O.includes(S))return!1;const W=v[S],ae=y[S];if(Dn(W)&&Dn(ae)){if(!an(W,ae))return!1}else if(W!==ae)return!1}for(const S of O)if(!w.includes(S))return!1;return!0}function Dn(v){return null!==v&&"object"==typeof v}function Jn(v){const y=[];for(const[w,O]of Object.entries(v))Array.isArray(O)?O.forEach(S=>{y.push(encodeURIComponent(w)+"="+encodeURIComponent(S))}):y.push(encodeURIComponent(w)+"="+encodeURIComponent(O));return y.length?"&"+y.join("&"):""}function It(v,y){const w=new $t(v,y);return w.subscribe.bind(w)}class $t{constructor(y,w){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=w,this.task.then(()=>{y(this)}).catch(O=>{this.error(O)})}next(y){this.forEachObserver(w=>{w.next(y)})}error(y){this.forEachObserver(w=>{w.error(y)}),this.close(y)}complete(){this.forEachObserver(y=>{y.complete()}),this.close()}subscribe(y,w,O){let S;if(void 0===y&&void 0===w&&void 0===O)throw new Error("Missing Observer.");S=function Cn(v,y){if("object"!=typeof v||null===v)return!1;for(const w of y)if(w in v&&"function"==typeof v[w])return!0;return!1}(y,["next","error","complete"])?y:{next:y,error:w,complete:O},void 0===S.next&&(S.next=Ze),void 0===S.error&&(S.error=Ze),void 0===S.complete&&(S.complete=Ze);const W=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?S.error(this.finalError):S.complete()}catch(ae){}}),this.observers.push(S),W}unsubscribeOne(y){void 0===this.observers||void 0===this.observers[y]||(delete this.observers[y],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(y){if(!this.finalized)for(let w=0;w<this.observers.length;w++)this.sendOne(w,y)}sendOne(y,w){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[y])try{w(this.observers[y])}catch(O){"undefined"!=typeof console&&console.error&&console.error(O)}})}close(y){this.finalized||(this.finalized=!0,void 0!==y&&(this.finalError=y),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ze(){}function Qe(v){return v&&v._delegate?v._delegate:v}},8667:(nt,_e,X)=>{X.d(_e,{U:()=>x});class x{}},5503:(nt,_e,X)=>{X.d(_e,{D:()=>ne});var x=X(9808),I=X(5e3);let ne=(()=>{class le{}return le.\u0275fac=function(ie){return new(ie||le)},le.\u0275mod=I.oAB({type:le}),le.\u0275inj=I.cJS({imports:[[x.ez]]}),le})()},270:(nt,_e,X)=>{X.d(_e,{_O:()=>Fe,hJ:()=>Is,v0:()=>Wi,rh:()=>hr});var x=X(5861),I=X(2090),ne=X(6881),le=X(1877),Ce=X(655),ie=X(4859);const vt=function oe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Se=new I.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),me=new le.Yd("@firebase/auth");function At(c,...o){me.logLevel<=le.in.ERROR&&me.error(`Auth (${ne.SDK_VERSION}): ${c}`,...o)}function ce(c,...o){throw bn(c,...o)}function Ae(c,...o){return bn(c,...o)}function Oe(c,o,a){const h=Object.assign(Object.assign({},vt()),{[o]:a});return new I.LL("auth","Firebase",h).create(o,{appName:c.name})}function Xe(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&ce(c,"argument-error"),Oe(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function bn(c,...o){if("string"!=typeof c){const a=o[0],h=[...o.slice(1)];return h[0]&&(h[0].appName=c.name),c._errorFactory.create(a,...h)}return Se.create(c,...o)}function M(c,o,...a){if(!c)throw bn(o,...a)}function je(c){const o="INTERNAL ASSERTION FAILED: "+c;throw At(o),new Error(o)}function we(c,o){c||je(o)}const xt=new Map;function ye(c){we(c instanceof Function,"Expected a class definition");let o=xt.get(c);return o?(we(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,xt.set(c,o),o)}function Gt(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function fn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class pn{constructor(o,a){this.shortDelay=o,this.longDelay=a,we(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,I.uI)()||(0,I.b$)()}get(){return function Nt(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(function Dt(){return"http:"===fn()||"https:"===fn()}()||(0,I.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Zn(c,o){we(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class kt{static initialize(o,a,h){this.fetchImpl=o,a&&(this.headersImpl=a),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void je("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void je("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void je("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Qn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Yn=new pn(3e4,6e4);function Me(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function $e(c,o,a,h){return Xn.apply(this,arguments)}function Xn(){return(Xn=(0,x.Z)(function*(c,o,a,h,p={}){return jt(c,p,(0,x.Z)(function*(){let m={},E={};h&&("GET"===o?E=h:m={body:JSON.stringify(h)});const R=(0,I.xO)(Object.assign({key:c.config.apiKey},E)).slice(1),j=yield c._getAdditionalHeaders();return j["Content-Type"]="application/json",c.languageCode&&(j["X-Firebase-Locale"]=c.languageCode),kt.fetch()(ii(c,c.config.apiHost,a,R),Object.assign({method:o,headers:j,referrerPolicy:"no-referrer"},m))}))})).apply(this,arguments)}function jt(c,o,a){return An.apply(this,arguments)}function An(){return(An=(0,x.Z)(function*(c,o,a){c._canInitEmulator=!1;const h=Object.assign(Object.assign({},Qn),o);try{const p=new si(c),m=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const E=yield m.json();if("needConfirmation"in E)throw on(c,"account-exists-with-different-credential",E);if(m.ok&&!("errorMessage"in E))return E;{const R=m.ok?E.errorMessage:E.error.message,[j,Y]=R.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===j)throw on(c,"credential-already-in-use",E);if("EMAIL_EXISTS"===j)throw on(c,"email-already-in-use",E);if("USER_DISABLED"===j)throw on(c,"user-disabled",E);const Z=h[j]||j.toLowerCase().replace(/[_\s]+/g,"-");if(Y)throw Oe(c,Z,Y);ce(c,Z)}}catch(p){if(p instanceof I.ZR)throw p;ce(c,"network-request-failed")}})).apply(this,arguments)}function Ct(c,o,a,h){return xn.apply(this,arguments)}function xn(){return(xn=(0,x.Z)(function*(c,o,a,h,p={}){const m=yield $e(c,o,a,h,p);return"mfaPendingCredential"in m&&ce(c,"multi-factor-auth-required",{_serverResponse:m}),m})).apply(this,arguments)}function ii(c,o,a,h){const p=`${o}${a}?${h}`;return c.config.emulator?Zn(c.config,p):`${c.config.apiScheme}://${p}`}class si{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,h)=>{this.timer=setTimeout(()=>h(Ae(this.auth,"network-request-failed")),Yn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function on(c,o,a){const h={appName:c.name};a.email&&(h.email=a.email),a.phoneNumber&&(h.phoneNumber=a.phoneNumber);const p=Ae(c,o,h);return p.customData._tokenResponse=a,p}function Sr(){return(Sr=(0,x.Z)(function*(c,o){return $e(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function Nn(c,o){return Jn.apply(this,arguments)}function Jn(){return(Jn=(0,x.Z)(function*(c,o){return $e(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function kn(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function It(){return(It=(0,x.Z)(function*(c,o=!1){const a=(0,I.m9)(c),h=yield a.getIdToken(o),p=mn(h);M(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const m="object"==typeof p.firebase?p.firebase:void 0,E=null==m?void 0:m.sign_in_provider;return{claims:p,token:h,authTime:kn($t(p.auth_time)),issuedAtTime:kn($t(p.iat)),expirationTime:kn($t(p.exp)),signInProvider:E||null,signInSecondFactor:(null==m?void 0:m.sign_in_second_factor)||null}})).apply(this,arguments)}function $t(c){return 1e3*Number(c)}function mn(c){var o;const[a,h,p]=c.split(".");if(void 0===a||void 0===h||void 0===p)return At("JWT malformed, contained fewer than 3 sections"),null;try{const m=(0,I.tV)(h);return m?JSON.parse(m):(At("Failed to decode base64 JWT payload"),null)}catch(m){return At("Caught error parsing JWT payload as JSON",null===(o=m)||void 0===o?void 0:o.toString()),null}}function Ze(c,o){return gn.apply(this,arguments)}function gn(){return(gn=(0,x.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(h){throw h instanceof I.ZR&&yn(h)&&c.auth.currentUser===c&&(yield c.auth.signOut()),h}})).apply(this,arguments)}function yn({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class xr{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const h=this.getInterval(o);this.timerId=setTimeout((0,x.Z)(function*(){yield a.iteration()}),h)}iteration(){var o=this;return(0,x.Z)(function*(){var a;try{yield o.user.getIdToken(!0)}catch(h){return void("auth/network-request-failed"===(null===(a=h)||void 0===a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Dr{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=kn(this.lastLoginAt),this.creationTime=kn(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function ut(c){return Nr.apply(this,arguments)}function Nr(){return(Nr=(0,x.Z)(function*(c){var o;const a=c.auth,h=yield c.getIdToken(),p=yield Ze(c,Nn(a,{idToken:h}));M(null==p?void 0:p.users.length,a,"internal-error");const m=p.users[0];c._notifyReloadListener(m);const E=(null===(o=m.providerUserInfo)||void 0===o?void 0:o.length)?kr(m.providerUserInfo):[],R=er(c.providerData,E),Z=!!c.isAnonymous&&!(c.email&&m.passwordHash||(null==R?void 0:R.length)),Q={uid:m.localId,displayName:m.displayName||null,photoURL:m.photoUrl||null,email:m.email||null,emailVerified:m.emailVerified||!1,phoneNumber:m.phoneNumber||null,tenantId:m.tenantId||null,providerData:R,metadata:new Dr(m.createdAt,m.lastLoginAt),isAnonymous:Z};Object.assign(c,Q)})).apply(this,arguments)}function Rn(){return(Rn=(0,x.Z)(function*(c){const o=(0,I.m9)(c);yield ut(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function er(c,o){return[...c.filter(h=>!o.some(p=>p.providerId===h.providerId)),...o]}function kr(c){return c.map(o=>{var{providerId:a}=o,h=(0,Ce._T)(o,["providerId"]);return{providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function Yt(){return(Yt=(0,x.Z)(function*(c,o){const a=yield jt(c,{},(0,x.Z)(function*(){const h=(0,I.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:m}=c.config,E=ii(c,p,"/v1/token",`key=${m}`),R=yield c._getAdditionalHeaders();return R["Content-Type"]="application/x-www-form-urlencoded",kt.fetch()(E,{method:"POST",headers:R,body:h})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Lt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){M(o.idToken,"internal-error"),M(void 0!==o.idToken,"internal-error"),M(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Cn(c){const o=mn(c);return M(o,"internal-error"),M(void 0!==o.exp,"internal-error"),M(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var h=this;return(0,x.Z)(function*(){return M(!h.accessToken||h.refreshToken,o,"user-token-expired"),a||!h.accessToken||h.isExpired?h.refreshToken?(yield h.refresh(o,h.refreshToken),h.accessToken):null:h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var h=this;return(0,x.Z)(function*(){const{accessToken:p,refreshToken:m,expiresIn:E}=yield function ai(c,o){return Yt.apply(this,arguments)}(o,a);h.updateTokensAndExpiration(p,m,Number(E))})()}updateTokensAndExpiration(o,a,h){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(o,a){const{refreshToken:h,accessToken:p,expirationTime:m}=a,E=new Lt;return h&&(M("string"==typeof h,"internal-error",{appName:o}),E.refreshToken=h),p&&(M("string"==typeof p,"internal-error",{appName:o}),E.accessToken=p),m&&(M("number"==typeof m,"internal-error",{appName:o}),E.expirationTime=m),E}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Lt,this.toJSON())}_performRefresh(){return je("not implemented")}}function Mt(c,o){M("string"==typeof c||void 0===c,"internal-error",{appName:o})}class xe{constructor(o){var{uid:a,auth:h,stsTokenManager:p}=o,m=(0,Ce._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new xr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=m.displayName||null,this.email=m.email||null,this.emailVerified=m.emailVerified||!1,this.phoneNumber=m.phoneNumber||null,this.photoURL=m.photoURL||null,this.isAnonymous=m.isAnonymous||!1,this.tenantId=m.tenantId||null,this.providerData=m.providerData?[...m.providerData]:[],this.metadata=new Dr(m.createdAt||void 0,m.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,x.Z)(function*(){const h=yield Ze(a,a.stsTokenManager.getToken(a.auth,o));return M(h,a.auth,"internal-error"),a.accessToken!==h&&(a.accessToken=h,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),h})()}getIdTokenResult(o){return function Ar(c){return It.apply(this,arguments)}(this,o)}reload(){return function oi(c){return Rn.apply(this,arguments)}(this)}_assign(o){this!==o&&(M(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new xe(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){M(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var h=this;return(0,x.Z)(function*(){let p=!1;o.idToken&&o.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield ut(h)),yield h.auth._persistUserIfCurrent(h),p&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var o=this;return(0,x.Z)(function*(){const a=yield o.getIdToken();return yield Ze(o,function br(c,o){return Sr.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var h,p,m,E,R,j,Y,Z;const Q=null!==(h=a.displayName)&&void 0!==h?h:void 0,nn=null!==(p=a.email)&&void 0!==p?p:void 0,Tn=null!==(m=a.phoneNumber)&&void 0!==m?m:void 0,rn=null!==(E=a.photoURL)&&void 0!==E?E:void 0,gu=null!==(R=a.tenantId)&&void 0!==R?R:void 0,pt=null!==(j=a._redirectEventId)&&void 0!==j?j:void 0,ca=null!==(Y=a.createdAt)&&void 0!==Y?Y:void 0,Zr=null!==(Z=a.lastLoginAt)&&void 0!==Z?Z:void 0,{uid:so,emailVerified:sn,isAnonymous:la,providerData:_r,stsTokenManager:yu}=a;M(so&&yu,o,"internal-error");const Gc=Lt.fromJSON(this.name,yu);M("string"==typeof so,o,"internal-error"),Mt(Q,o.name),Mt(nn,o.name),M("boolean"==typeof sn,o,"internal-error"),M("boolean"==typeof la,o,"internal-error"),Mt(Tn,o.name),Mt(rn,o.name),Mt(gu,o.name),Mt(pt,o.name),Mt(ca,o.name),Mt(Zr,o.name);const ue=new xe({uid:so,auth:o,email:nn,emailVerified:sn,displayName:Q,isAnonymous:la,photoURL:rn,phoneNumber:Tn,tenantId:gu,stsTokenManager:Gc,createdAt:ca,lastLoginAt:Zr});return _r&&Array.isArray(_r)&&(ue.providerData=_r.map(jc=>Object.assign({},jc))),pt&&(ue._redirectEventId=pt),ue}static _fromIdTokenResponse(o,a,h=!1){return(0,x.Z)(function*(){const p=new Lt;p.updateFromServerResponse(a);const m=new xe({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:h});return yield ut(m),m})()}}const v=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,x.Z)(function*(){return!0})()}_set(a,h){var p=this;return(0,x.Z)(function*(){p.storage[a]=h})()}_get(a){var h=this;return(0,x.Z)(function*(){const p=h.storage[a];return void 0===p?null:p})()}_remove(a){var h=this;return(0,x.Z)(function*(){delete h.storage[a]})()}_addListener(a,h){}_removeListener(a,h){}}return c.type="NONE",c})();function y(c,o,a){return`firebase:${c}:${o}:${a}`}class w{constructor(o,a,h){this.persistence=o,this.auth=a,this.userKey=h;const{config:p,name:m}=this.auth;this.fullUserKey=y(this.userKey,p.apiKey,m),this.fullPersistenceKey=y("persistence",p.apiKey,m),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,x.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?xe._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,x.Z)(function*(){if(a.persistence===o)return;const h=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,h?a.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,h="authUser"){return(0,x.Z)(function*(){if(!a.length)return new w(ye(v),o,h);const p=(yield Promise.all(a.map(function(){var Y=(0,x.Z)(function*(Z){if(yield Z._isAvailable())return Z});return function(Z){return Y.apply(this,arguments)}}()))).filter(Y=>Y);let m=p[0]||ye(v);const E=y(h,o.config.apiKey,o.name);let R=null;for(const Y of a)try{const Z=yield Y._get(E);if(Z){const Q=xe._fromJSON(o,Z);Y!==m&&(R=Q),m=Y;break}}catch(Z){}const j=p.filter(Y=>Y._shouldAllowMigration);return m._shouldAllowMigration&&j.length?(m=j[0],R&&(yield m._set(E,R.toJSON())),yield Promise.all(a.map(function(){var Y=(0,x.Z)(function*(Z){if(Z!==m)try{yield Z._remove(E)}catch(Q){}});return function(Z){return Y.apply(this,arguments)}}())),new w(m,o,h)):new w(m,o,h)})()}}function O(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Ee(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(S(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(rt(o))return"Blackberry";if(wt(o))return"Webos";if(W(o))return"Safari";if((o.includes("chrome/")||ae(o))&&!o.includes("edge/"))return"Chrome";if(Je(o))return"Android";{const h=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function S(c=(0,I.z$)()){return/firefox\//i.test(c)}function W(c=(0,I.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function ae(c=(0,I.z$)()){return/crios\//i.test(c)}function Ee(c=(0,I.z$)()){return/iemobile/i.test(c)}function Je(c=(0,I.z$)()){return/android/i.test(c)}function rt(c=(0,I.z$)()){return/blackberry/i.test(c)}function wt(c=(0,I.z$)()){return/webos/i.test(c)}function fe(c=(0,I.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function nr(c=(0,I.z$)()){return fe(c)||Je(c)||wt(c)||rt(c)||/windows phone/i.test(c)||Ee(c)}function k(c,o=[]){let a;switch(c){case"Browser":a=O((0,I.z$)());break;case"Worker":a=`${O((0,I.z$)())}-${c}`;break;default:a=c}const h=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${ne.SDK_VERSION}/${h}`}class b{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const h=m=>new Promise((E,R)=>{try{E(o(m))}catch(j){R(j)}});h.onAbort=a,this.queue.push(h);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,x.Z)(function*(){var h;if(a.auth.currentUser===o)return;const p=[];try{for(const m of a.queue)yield m(o),m.onAbort&&p.push(m.onAbort)}catch(m){p.reverse();for(const E of p)try{E()}catch(R){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null===(h=m)||void 0===h?void 0:h.message})}})()}}class V{constructor(o,a,h){this.app=o,this.heartbeatServiceProvider=a,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new te(this),this.idTokenSubscription=new te(this),this.beforeStateQueue=new b(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Se,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=h.sdkClientVersion}_initializeWithPersistence(o,a){var h=this;return a&&(this._popupRedirectResolver=ye(a)),this._initializationPromise=this.queue((0,x.Z)(function*(){var p,m;if(!h._deleted&&(h.persistenceManager=yield w.create(h,o),!h._deleted)){if(null===(p=h._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch(E){}yield h.initializeCurrentUser(a),h.lastNotifiedUid=(null===(m=h.currentUser)||void 0===m?void 0:m.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,x.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,x.Z)(function*(){var h;const p=yield a.assertedPersistence.getCurrentUser();let m=p,E=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const R=null===(h=a.redirectUser)||void 0===h?void 0:h._redirectEventId,j=null==m?void 0:m._redirectEventId,Y=yield a.tryRedirectSignIn(o);(!R||R===j)&&(null==Y?void 0:Y.user)&&(m=Y.user,E=!0)}if(!m)return a.directlySetCurrentUser(null);if(!m._redirectEventId){if(E)try{yield a.beforeStateQueue.runMiddleware(m)}catch(R){m=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(R))}return m?a.reloadAndSetCurrentUserOrClear(m):a.directlySetCurrentUser(null)}return M(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===m._redirectEventId?a.directlySetCurrentUser(m):a.reloadAndSetCurrentUserOrClear(m)})()}tryRedirectSignIn(o){var a=this;return(0,x.Z)(function*(){let h=null;try{h=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,x.Z)(function*(){var h;try{yield ut(o)}catch(p){if("auth/network-request-failed"!==(null===(h=p)||void 0===h?void 0:h.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function Sn(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,x.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,x.Z)(function*(){const h=o?(0,I.m9)(o):null;return h&&M(h.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(h&&h._clone(a))})()}_updateCurrentUser(o,a=!1){var h=this;return(0,x.Z)(function*(){if(!h._deleted)return o&&M(h.tenantId===o.tenantId,h,"tenant-id-mismatch"),a||(yield h.beforeStateQueue.runMiddleware(o)),h.queue((0,x.Z)(function*(){yield h.directlySetCurrentUser(o),h.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,x.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,x.Z)(function*(){yield a.assertedPersistence.setPersistence(ye(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new I.LL("auth","Firebase",o())}onAuthStateChanged(o,a,h){return this.registerStateListener(this.authStateSubscription,o,a,h)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,h){return this.registerStateListener(this.idTokenSubscription,o,a,h)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var h=this;return(0,x.Z)(function*(){const p=yield h.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,x.Z)(function*(){if(!a.redirectPersistenceManager){const h=o&&ye(o)||a._popupRedirectResolver;M(h,a,"argument-error"),a.redirectPersistenceManager=yield w.create(a,[ye(h._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,x.Z)(function*(){var h,p;return a._isInitialized&&(yield a.queue((0,x.Z)(function*(){}))),(null===(h=a._currentUser)||void 0===h?void 0:h._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,x.Z)(function*(){if(o===a.currentUser)return a.queue((0,x.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,h,p){if(this._deleted)return()=>{};const m="function"==typeof a?a:a.next.bind(a),E=this._isInitialized?Promise.resolve():this._initializationPromise;return M(E,this,"internal-error"),E.then(()=>m(this.currentUser)),"function"==typeof a?o.addObserver(a,h,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,x.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return M(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=k(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,x.Z)(function*(){var a;const h={"X-Client-Version":o.clientVersion};o.app.options.appId&&(h["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(h["X-Firebase-Client"]=p),h})()}}function K(c){return(0,I.m9)(c)}class te{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,I.ne)(a=>this.observer=a)}get next(){return M(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Te(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Ye(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Cr{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return je("not implemented")}_getIdTokenResponse(o){return je("not implemented")}_linkToIdToken(o,a){return je("not implemented")}_getReauthenticationResolver(o){return je("not implemented")}}function Kt(c,o){return mi.apply(this,arguments)}function mi(){return(mi=(0,x.Z)(function*(c,o){return Ct(c,"POST","/v1/accounts:signInWithIdp",Me(c,o))})).apply(this,arguments)}class Ln extends Cr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new Ln(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):ce("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:p}=a,m=(0,Ce._T)(a,["providerId","signInMethod"]);if(!h||!p)return null;const E=new Ln(h,p);return E.idToken=m.idToken||void 0,E.accessToken=m.accessToken||void 0,E.secret=m.secret,E.nonce=m.nonce,E.pendingToken=m.pendingToken||null,E}_getIdTokenResponse(o){return Kt(o,this.buildRequest())}_linkToIdToken(o,a){const h=this.buildRequest();return h.idToken=a,Kt(o,h)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Kt(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,I.xO)(a)}return o}}class Jt{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Pr extends Jt{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}let Fe=(()=>{class c extends Pr{constructor(){super("facebook.com")}static credential(a){return Ln._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(h){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),Is=(()=>{class c extends Pr{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Ln._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:p}=a;if(!h&&!p)return null;try{return c.credential(h,p)}catch(m){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})();class ft{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,h,p=!1){return(0,x.Z)(function*(){const m=yield xe._fromIdTokenResponse(o,h,p),E=_n(h);return new ft({user:m,providerId:E,_tokenResponse:h,operationType:a})})()}static _forOperation(o,a,h){return(0,x.Z)(function*(){yield o._updateTokensIfNecessary(h,!0);const p=_n(h);return new ft({user:o,providerId:p,_tokenResponse:h,operationType:a})})()}}function _n(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}class wi extends I.ZR{constructor(o,a,h,p){var m;super(a.code,a.message),this.operationType=h,this.user=p,Object.setPrototypeOf(this,wi.prototype),this.customData={appName:o.name,tenantId:null!==(m=o.tenantId)&&void 0!==m?m:void 0,_serverResponse:a.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(o,a,h,p){return new wi(o,a,h,p)}}function or(c,o,a,h){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(m=>{throw"auth/multi-factor-auth-required"===m.code?wi._fromErrorAndOperation(c,m,o,h):m})}function ko(c,o){return bs.apply(this,arguments)}function bs(){return(bs=(0,x.Z)(function*(c,o,a=!1){const h=yield Ze(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return ft._forOperation(c,"link",h)})).apply(this,arguments)}function As(){return(As=(0,x.Z)(function*(c,o,a=!1){var h;const{auth:p}=c,m="reauthenticate";try{const E=yield Ze(c,or(p,m,o,c),a);M(E.idToken,p,"internal-error");const R=mn(E.idToken);M(R,p,"internal-error");const{sub:j}=R;return M(c.uid===j,p,"user-mismatch"),ft._forOperation(c,m,E)}catch(E){throw"auth/user-not-found"===(null===(h=E)||void 0===h?void 0:h.code)&&ce(p,"user-mismatch"),E}})).apply(this,arguments)}function bi(){return(bi=(0,x.Z)(function*(c,o,a=!1){const h="signIn",p=yield or(c,h,o),m=yield ft._fromIdTokenResponse(c,h,p);return a||(yield c._updateCurrentUser(m.user)),m})).apply(this,arguments)}const js="__sak";class G{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(js,"1"),this.storage.removeItem(js),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const dc=(()=>{class c extends G{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function D(){const c=(0,I.z$)();return W(c)||fe(c)}()&&function cs(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=nr(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const p=this.storage.getItem(h),m=this.localCache[h];p!==m&&a(h,m,p)}}onStorageEvent(a,h=!1){if(!a.key)return void this.forAllChangedKeys((R,j,Y)=>{this.notifyListeners(R,Y)});const p=a.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const R=this.storage.getItem(p);if(a.newValue!==R)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!h)return}const m=()=>{const R=this.storage.getItem(p);!h&&this.localCache[p]===R||this.notifyListeners(p,R)},E=this.storage.getItem(p);!function tr(){return(0,I.w1)()&&10===document.documentMode}()||E===a.newValue||a.newValue===a.oldValue?m():setTimeout(m,10)}notifyListeners(a,h){this.localCache[a]=h;const p=this.listeners[a];if(p)for(const m of Array.from(p))m(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,h){var p=()=>super._set,m=this;return(0,x.Z)(function*(){yield p().call(m,a,h),m.localCache[a]=JSON.stringify(h)})()}_get(a){var h=()=>super._get,p=this;return(0,x.Z)(function*(){const m=yield h().call(p,a);return p.localCache[a]=JSON.stringify(m),m})()}_remove(a){var h=()=>super._remove,p=this;return(0,x.Z)(function*(){yield h().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),Ya=(()=>{class c extends G{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}return c.type="SESSION",c})();let pc=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(m=>m.isListeningto(a));if(h)return h;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var h=this;return(0,x.Z)(function*(){const p=a,{eventId:m,eventType:E,data:R}=p.data,j=h.handlersMap[E];if(!(null==j?void 0:j.size))return;p.ports[0].postMessage({status:"ack",eventId:m,eventType:E});const Y=Array.from(j).map(function(){var Q=(0,x.Z)(function*(nn){return nn(p.origin,R)});return function(nn){return Q.apply(this,arguments)}}()),Z=yield function fc(c){return Promise.all(c.map(function(){var o=(0,x.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(h){return{fulfilled:!1,reason:h}}});return function(a){return o.apply(this,arguments)}}()))}(Y);p.ports[0].postMessage({status:"done",eventId:m,eventType:E,response:Z})})()}_subscribe(a,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function Ri(c="",o=10){let a="";for(let h=0;h<o;h++)a+=Math.floor(10*Math.random());return c+a}class mc{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,h=50){var p=this;return(0,x.Z)(function*(){const m="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!m)throw new Error("connection_unavailable");let E,R;return new Promise((j,Y)=>{const Z=Ri("",20);m.port1.start();const Q=setTimeout(()=>{Y(new Error("unsupported_event"))},h);R={messageChannel:m,onMessage(nn){const Tn=nn;if(Tn.data.eventId===Z)switch(Tn.data.status){case"ack":clearTimeout(Q),E=setTimeout(()=>{Y(new Error("timeout"))},3e3);break;case"done":clearTimeout(E),j(Tn.data.response);break;default:clearTimeout(Q),clearTimeout(E),Y(new Error("invalid_response"))}}},p.handlers.add(R),m.port1.addEventListener("message",R.onMessage),p.target.postMessage({eventType:o,eventId:Z,data:a},[m.port2])}).finally(()=>{R&&p.removeMessageHandler(R)})})()}}function it(){return window}function $s(){return void 0!==it().WorkerGlobalScope&&"function"==typeof it().importScripts}function Un(){return(Un=(0,x.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const ee="firebaseLocalStorageDb",de="firebaseLocalStorage",Ja="fbase_key";class ke{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function q(c,o){return c.transaction([de],o?"readwrite":"readonly").objectStore(de)}function Pi(){const c=indexedDB.open(ee,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const h=c.result;try{h.createObjectStore(de,{keyPath:Ja})}catch(p){a(p)}}),c.addEventListener("success",(0,x.Z)(function*(){const h=c.result;h.objectStoreNames.contains(de)?o(h):(h.close(),yield function Ks(){const c=indexedDB.deleteDatabase(ee);return new ke(c).toPromise()}(),o(yield Pi()))}))})}function Vn(c,o,a){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,x.Z)(function*(c,o,a){const h=q(c,!0).put({[Ja]:o,value:a});return new ke(h).toPromise()})).apply(this,arguments)}function qo(){return(qo=(0,x.Z)(function*(c,o){const a=q(c,!1).get(o),h=yield new ke(a).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function Vr(c,o){const a=q(c,!0).delete(o);return new ke(a).toPromise()}const Go=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,x.Z)(function*(){return a.db||(a.db=yield Pi()),a.db})()}_withRetries(a){var h=this;return(0,x.Z)(function*(){let p=0;for(;;)try{const m=yield h._openDb();return yield a(m)}catch(m){if(p++>3)throw m;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,x.Z)(function*(){return $s()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,x.Z)(function*(){a.receiver=pc._getInstance(function Ve(){return $s()?self:null}()),a.receiver._subscribe("keyChanged",function(){var h=(0,x.Z)(function*(p,m){return{keyProcessed:(yield a._poll()).includes(m.key)}});return function(p,m){return h.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var h=(0,x.Z)(function*(p,m){return["keyChanged"]});return function(p,m){return h.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,x.Z)(function*(){var h,p;if(a.activeServiceWorker=yield function se(){return Un.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new mc(a.activeServiceWorker);const m=yield a.sender._send("ping",{},800);!m||(null===(h=m[0])||void 0===h?void 0:h.fulfilled)&&(null===(p=m[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var h=this;return(0,x.Z)(function*(){if(h.sender&&h.activeServiceWorker&&function Xa(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:a},h.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,x.Z)(function*(){try{if(!indexedDB)return!1;const a=yield Pi();return yield Vn(a,js,"1"),yield Vr(a,js),!0}catch(a){}return!1})()}_withPendingWrite(a){var h=this;return(0,x.Z)(function*(){h.pendingWrites++;try{yield a()}finally{h.pendingWrites--}})()}_set(a,h){var p=this;return(0,x.Z)(function*(){return p._withPendingWrite((0,x.Z)(function*(){return yield p._withRetries(m=>Vn(m,a,h)),p.localCache[a]=h,p.notifyServiceWorker(a)}))})()}_get(a){var h=this;return(0,x.Z)(function*(){const p=yield h._withRetries(m=>function zs(c,o){return qo.apply(this,arguments)}(m,a));return h.localCache[a]=p,p})()}_remove(a){var h=this;return(0,x.Z)(function*(){return h._withPendingWrite((0,x.Z)(function*(){return yield h._withRetries(p=>Vr(p,a)),delete h.localCache[a],h.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,x.Z)(function*(){const h=yield a._withRetries(E=>{const R=q(E,!1).getAll();return new ke(R).toPromise()});if(!h)return[];if(0!==a.pendingWrites)return[];const p=[],m=new Set;for(const{fbase_key:E,value:R}of h)m.add(E),JSON.stringify(a.localCache[E])!==JSON.stringify(R)&&(a.notifyListeners(E,R),p.push(E));for(const E of Object.keys(a.localCache))a.localCache[E]&&!m.has(E)&&(a.notifyListeners(E,null),p.push(E));return p})()}notifyListeners(a,h){this.localCache[a]=h;const p=this.listeners[a];if(p)for(const m of Array.from(p))m(h)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,x.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Wt(c){return`__${c}${Math.floor(1e6*Math.random())}`}function tn(c,o){return o?ye(o):(M(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}Wt("rcb"),new pn(3e4,6e4);class Wo extends Cr{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return Kt(o,this._buildIdpRequest())}_linkToIdToken(o,a){return Kt(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return Kt(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Gn(c){return function Co(c,o){return bi.apply(this,arguments)}(c.auth,new Wo(c),c.bypassAuthState)}function Bi(c){const{auth:o,user:a}=c;return M(a,o,"internal-error"),function Ss(c,o){return As.apply(this,arguments)}(a,new Wo(c),c.bypassAuthState)}function qi(c){return Ws.apply(this,arguments)}function Ws(){return(Ws=(0,x.Z)(function*(c){const{auth:o,user:a}=c;return M(a,o,"internal-error"),ko(a,new Wo(c),c.bypassAuthState)})).apply(this,arguments)}class In{constructor(o,a,h,p,m=!1){this.auth=o,this.resolver=h,this.user=p,this.bypassAuthState=m,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,x.Z)(function*(h,p){o.pendingPromise={resolve:h,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(m){o.reject(m)}});return function(h,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,x.Z)(function*(){const{urlResponse:h,sessionId:p,postBody:m,tenantId:E,error:R,type:j}=o;if(R)return void a.reject(R);const Y={auth:a.auth,requestUri:h,sessionId:p,tenantId:E||void 0,postBody:m||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(j)(Y))}catch(Z){a.reject(Z)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Gn;case"linkViaPopup":case"linkViaRedirect":return qi;case"reauthViaPopup":case"reauthViaRedirect":return Bi;default:ce(this.auth,"internal-error")}}resolve(o){we(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){we(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Hs=new pn(2e3,1e4);function hr(c,o,a){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,x.Z)(function*(c,o,a){const h=K(c);Xe(c,o,Jt);const p=tn(h,a);return new Gi(h,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}let Gi=(()=>{class c extends In{constructor(a,h,p,m,E){super(a,h,m,E),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,x.Z)(function*(){const h=yield a.execute();return M(h,a.auth,"internal-error"),h})()}onExecution(){var a=this;return(0,x.Z)(function*(){we(1===a.filter.length,"Popup operations only handle one event");const h=Ri();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],h),a.authWindow.associatedEvent=h,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(Ae(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Ae(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var h,p;this.pollId=(null===(p=null===(h=this.authWindow)||void 0===h?void 0:h.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(Ae(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,Hs.get())};a()}}return c.currentPopupAction=null,c})();const fr=new Map;class ji extends In{constructor(o,a,h=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,h),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,x.Z)(function*(){let h=fr.get(a.auth._key());if(!h){try{const m=(yield function ou(c,o){return Qs.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;h=()=>Promise.resolve(m)}catch(p){h=()=>Promise.reject(p)}fr.set(a.auth._key(),h)}return a.bypassAuthState||fr.set(a.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,h=this;return(0,x.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(h,o);if("unknown"!==o.type){if(o.eventId){const p=yield h.auth._redirectUserForId(o.eventId);if(p)return h.user=p,a().call(h,o);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,x.Z)(function*(){})()}cleanUp(){}}function Qs(){return(Qs=(0,x.Z)(function*(c,o){const a=Ho(o),h=au(c);if(!(yield h._isAvailable()))return!1;const p="true"===(yield h._get(a));return yield h._remove(a),p})).apply(this,arguments)}function Sc(c,o){fr.set(c._key(),o)}function au(c){return ye(c._redirectPersistence)}function Ho(c){return y("pendingRedirect",c.config.apiKey,c.name)}function Qo(c,o){return Js.apply(this,arguments)}function Js(){return(Js=(0,x.Z)(function*(c,o,a=!1){const h=K(c),p=tn(h,o),E=yield new ji(h,p,a).execute();return E&&!a&&(delete E.user._redirectEventId,yield h._persistUserIfCurrent(E.user),yield h._setRedirectUser(null,o)),E})).apply(this,arguments)}class kc{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(o,h)&&(a=!0,this.sendToConsumer(o,h),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Cc(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uu(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var h;if(o.error&&!uu(o)){const p=(null===(h=o.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";a.onError(Ae(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const h=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&h}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xo(o))}saveEventToCache(o){this.cachedEventUids.add(Xo(o)),this.lastProcessedEventTime=Date.now()}}function Xo(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function uu({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Rc(c){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,x.Z)(function*(c,o={}){return $e(c,"GET","/v1/projects",o)})).apply(this,arguments)}const $n=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$r=/^https?/;function eo(){return(eo=(0,x.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Rc(c);for(const a of o)try{if(cu(a))return}catch(h){}ce(c,"unauthorized-domain")})).apply(this,arguments)}function cu(c){const o=Gt(),{protocol:a,hostname:h}=new URL(o);if(c.startsWith("chrome-extension://")){const E=new URL(c);return""===E.hostname&&""===h?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&E.hostname===h}if(!$r.test(a))return!1;if($n.test(c))return h===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(h)}const wn=new pn(3e4,6e4);function ea(){const c=it().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let $i=null;function ta(c){return $i=$i||function Kr(c){return new Promise((o,a)=>{var h,p,m;function E(){ea(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{ea(),a(Ae(c,"network-request-failed"))},timeout:wn.get()})}if(null===(p=null===(h=it().gapi)||void 0===h?void 0:h.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(m=it().gapi)||void 0===m?void 0:m.load)){const R=Wt("iframefcb");return it()[R]=()=>{gapi.load?E():a(Ae(c,"network-request-failed"))},function Mi(c){return new Promise((o,a)=>{const h=document.createElement("script");h.setAttribute("src",c),h.onload=o,h.onerror=p=>{const m=Ae("internal-error");m.customData=p,a(m)},h.type="text/javascript",h.charset="UTF-8",function A(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(h)})}(`https://apis.google.com/js/api.js?onload=${R}`).catch(j=>a(j))}E()}}).catch(o=>{throw $i=null,o})}(c),$i}const na=new pn(5e3,15e3),bt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},to=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ki(c){const o=c.config;M(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Zn(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,h={apiKey:o.apiKey,appName:c.name,v:ne.SDK_VERSION},p=to.get(c.config.apiHost);p&&(h.eid=p);const m=c._getFrameworks();return m.length&&(h.fw=m.join(",")),`${a}?${(0,I.xO)(h).slice(1)}`}function zi(){return zi=(0,x.Z)(function*(c){const o=yield ta(c),a=it().gapi;return M(a,c,"internal-error"),o.open({where:document.body,url:Ki(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bt,dontclear:!0},h=>new Promise(function(){var p=(0,x.Z)(function*(m,E){yield h.restyle({setHideOnLeave:!1});const R=Ae(c,"network-request-failed"),j=it().setTimeout(()=>{E(R)},na.get());function Y(){it().clearTimeout(j),m(h)}h.ping(Y).then(Y,()=>{E(R)})});return function(m,E){return p.apply(this,arguments)}}()))}),zi.apply(this,arguments)}const ia={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class sa{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function oa(c,o,a,h,p,m){M(c.config.authDomain,c,"auth-domain-config-required"),M(c.config.apiKey,c,"invalid-api-key");const E={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:h,v:ne.SDK_VERSION,eventId:p};if(o instanceof Jt){o.setDefaultLanguage(c.languageCode),E.providerId=o.providerId||"",(0,I.xb)(o.getCustomParameters())||(E.customParameters=JSON.stringify(o.getCustomParameters()));for(const[j,Y]of Object.entries(m||{}))E[j]=Y}if(o instanceof Pr){const j=o.getScopes().filter(Y=>""!==Y);j.length>0&&(E.scopes=j.join(","))}c.tenantId&&(E.tid=c.tenantId);const R=E;for(const j of Object.keys(R))void 0===R[j]&&delete R[j];return`${function Wr({config:c}){return c.emulator?Zn(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,I.xO)(R).slice(1)}`}const En="webStorageSupport",gr=class mu{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ya,this._completeRedirectFn=Qo,this._overrideRedirectResult=Sc}_openPopup(o,a,h,p){var m=this;return(0,x.Z)(function*(){var E;we(null===(E=m.eventManagers[o._key()])||void 0===E?void 0:E.manager,"_initialize() not called before _openPopup()");const R=oa(o,a,h,Gt(),p);return function pu(c,o,a,h=500,p=600){const m=Math.max((window.screen.availHeight-p)/2,0).toString(),E=Math.max((window.screen.availWidth-h)/2,0).toString();let R="";const j=Object.assign(Object.assign({},ia),{width:h.toString(),height:p.toString(),top:m,left:E}),Y=(0,I.z$)().toLowerCase();a&&(R=ae(Y)?"_blank":a),S(Y)&&(o=o||"http://localhost",j.scrollbars="yes");const Z=Object.entries(j).reduce((nn,[Tn,rn])=>`${nn}${Tn}=${rn},`,"");if(function Xt(c=(0,I.z$)()){var o;return fe(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(Y)&&"_self"!==R)return function no(c,o){const a=document.createElement("a");a.href=c,a.target=o;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(h)}(o||"",R),new sa(null);const Q=window.open(o||"",R,Z);M(Q,c,"popup-blocked");try{Q.focus()}catch(nn){}return new sa(Q)}(o,R,Ri())})()}_openRedirect(o,a,h,p){var m=this;return(0,x.Z)(function*(){return yield m._originValidation(o),function gc(c){it().location.href=c}(oa(o,a,h,Gt(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:m}=this.eventManagers[a];return p?Promise.resolve(p):(we(m,"If manager is not set, promise should be"),m)}const h=this.initAndGetManager(o);return this.eventManagers[a]={promise:h},h.catch(()=>{delete this.eventManagers[a]}),h}initAndGetManager(o){var a=this;return(0,x.Z)(function*(){const h=yield function lu(c){return zi.apply(this,arguments)}(o),p=new kc(o);return h.register("authEvent",m=>(M(null==m?void 0:m.authEvent,o,"invalid-auth-event"),{status:p.onEvent(m.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=h,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(En,{type:En},p=>{var m;const E=null===(m=null==p?void 0:p[0])||void 0===m?void 0:m[En];void 0!==E&&a(!!E),ce(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Oc(c){return eo.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return nr()||W()||fe()}};var aa="@firebase/auth",Hr="0.20.10";class Vc{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,x.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(h=>{var p;o((null===(p=h)||void 0===p?void 0:p.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){M(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const io=(0,I.Pz)("authIdTokenMaxAge")||300;let ua=null;const qc=c=>function(){var o=(0,x.Z)(function*(a){const h=a&&(yield a.getIdTokenResult()),p=h&&((new Date).getTime()-Date.parse(h.issuedAtTime))/1e3;if(p&&p>io)return;const m=null==h?void 0:h.token;ua!==m&&(ua=m,yield fetch(c,{method:m?"POST":"DELETE",headers:m?{Authorization:`Bearer ${m}`}:{}}))});return function(a){return o.apply(this,arguments)}}();function Wi(c=(0,ne.getApp)()){const o=(0,ne._getProvider)(c,"auth");if(o.isInitialized())return o.getImmediate();const a=function Tr(c,o){const a=(0,ne._getProvider)(c,"auth");if(a.isInitialized()){const p=a.getImmediate(),m=a.getOptions();if((0,I.vZ)(m,null!=o?o:{}))return p;ce(p,"already-initialized")}return a.initialize({options:o})}(c,{popupRedirectResolver:gr,persistence:[Go,dc,Ya]}),h=(0,I.Pz)("authTokenSyncURL");if(h){const m=qc(h);(function Qa(c,o,a){(0,I.m9)(c).beforeAuthStateChanged(o,a)})(a,m,()=>m(a.currentUser)),function cc(c,o,a,h){(0,I.m9)(c).onIdTokenChanged(o,a,h)}(a,E=>m(E))}const p=(0,I.q4)("auth");return p&&function he(c,o,a){const h=K(c);M(h._canInitEmulator,h,"emulator-config-failed"),M(/^https?:\/\//.test(o),h,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),m=Te(o),{host:E,port:R}=function dt(c){const o=Te(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const h=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(h);if(p){const m=p[1];return{host:m,port:Ye(h.substr(m.length+1))}}{const[m,E]=h.split(":");return{host:m,port:Ye(E)}}}(o);h.config.emulator={url:`${m}//${E}${null===R?"":`:${R}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:E,port:R,protocol:m.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function ls(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(a,`http://${p}`),a}!function qe(c){(0,ne._registerComponent)(new ie.wA("auth",(o,{options:a})=>{const h=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:m,authDomain:E}=h.options;return((R,j)=>{M(m&&!m.includes(":"),"invalid-api-key",{appName:R.name}),M(!(null==E?void 0:E.includes(":")),"argument-error",{appName:R.name});const Y={apiKey:m,authDomain:E,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:k(c)},Z=new V(R,j,Y);return function qt(c,o){const a=(null==o?void 0:o.persistence)||[],h=(Array.isArray(a)?a:[a]).map(ye);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(h,null==o?void 0:o.popupRedirectResolver)}(Z,a),Z})(h,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,h)=>{o.getProvider("auth-internal").initialize()})),(0,ne._registerComponent)(new ie.wA("auth-internal",o=>{const a=K(o.getProvider("auth").getImmediate());return new Vc(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,ne.registerVersion)(aa,Hr,function Bc(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,ne.registerVersion)(aa,Hr,"esm2017")}("Browser")},127:(nt,_e,X)=>{X.d(_e,{Z:()=>x.Z});var x=X(3942);x.Z.registerVersion("firebase","9.12.1","app-compat")},6533:(nt,_e,X)=>{var B,x=X(3942),I=X(5861),ne=X(6881),le=X(4859),Ce=X(1877),ie=X(2090),at="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Re={},L=L||{},N=at||self;function J(){}function oe(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function ve(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Se="closure_uid_"+(1e9*Math.random()>>>0),pe=0;function me(n,e,t){return n.call.apply(n.bind,arguments)}function At(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ce(n,e,t){return(ce=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?me:At).apply(null,arguments)}function Ae(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Oe(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,i,s){for(var u=Array(arguments.length-2),l=2;l<arguments.length;l++)u[l-2]=arguments[l];return e.prototype[i].apply(r,u)}}function Xe(){this.s=this.s,this.o=this.o}var M={};Xe.prototype.s=!1,Xe.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var n=function vt(n){return Object.prototype.hasOwnProperty.call(n,Se)&&n[Se]||(n[Se]=++pe)}(this);delete M[n]}},Xe.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const je=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function we(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function xt(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(oe(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let u=0;u<s;u++)n[i+u]=r[u]}else n.push(r)}}function ye(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ye.prototype.h=function(){this.defaultPrevented=!0};var Tr=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{N.addEventListener("test",J,e),N.removeEventListener("test",J,e)}catch(t){}return n}();function qt(n){return/^[\s\xa0]*$/.test(n)}var Gt=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Dt(n,e){return n<e?-1:n>e?1:0}function fn(){var n=N.navigator;return n&&(n=n.userAgent)?n:""}function Nt(n){return-1!=fn().indexOf(n)}function Sn(n){return Sn[" "](n),n}Sn[" "]=J;var jt,n,Zn=Nt("Opera"),kt=Nt("Trident")||Nt("MSIE"),Qn=Nt("Edge"),Yn=Qn||kt,Me=Nt("Gecko")&&!(-1!=fn().toLowerCase().indexOf("webkit")&&!Nt("Edge"))&&!(Nt("Trident")||Nt("MSIE"))&&!Nt("Edge"),$e=-1!=fn().toLowerCase().indexOf("webkit")&&!Nt("Edge");function Xn(){var n=N.document;return n?n.documentMode:void 0}e:{var An="",Ct=(n=fn(),Me?/rv:([^\);]+)(\)|;)/.exec(n):Qn?/Edge\/([\d\.]+)/.exec(n):kt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):$e?/WebKit\/(\S+)/.exec(n):Zn?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Ct&&(An=Ct?Ct[1]:""),kt){var xn=Xn();if(null!=xn&&xn>parseFloat(An)){jt=String(xn);break e}}jt=An}var ii={};var Sr=N.document&&kt&&(Xn()||parseInt(jt,10))||void 0;function an(n,e){if(ye.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Me){e:{try{Sn(e.nodeName);var i=!0;break e}catch(s){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Dn[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&an.X.h.call(this)}}Oe(an,ye);var Dn={2:"touch",3:"pen",4:"mouse"};an.prototype.h=function(){an.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Nn="closure_listenable_"+(1e6*Math.random()|0),Jn=0;function kn(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=i,this.key=++Jn,this.ba=this.ea=!1}function un(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Ar(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function It(n){const e={};for(const t in n)e[t]=n[t];return e}const $t="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mn(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<$t.length;s++)t=$t[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Cn(n){this.src=n,this.g={},this.h=0}function Ze(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=je(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(un(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function gn(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==r)return i}return-1}Cn.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=gn(n,e,r,i);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new kn(e,this.src,s,!!r,i)).ea=t,n.push(e)),e};var yn="closure_lm_"+(1e6*Math.random()|0),xr={};function Dr(n,e,t,r,i){if(r&&r.once)return oi(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Dr(n,e[s],t,r,i);return null}return t=Mt(t),n&&n[Nn]?n.N(e,t,ve(r)?!!r.capture:!!r,i):ut(n,e,t,!1,r,i)}function ut(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var u=ve(i)?!!i.capture:!!i,l=Yt(n);if(l||(n[yn]=l=new Cn(n)),(t=l.add(e,t,r,u,s)).proxy)return t;if(r=function Nr(){const e=ai;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Tr||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(kr(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function oi(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)oi(n,e[s],t,r,i);return null}return t=Mt(t),n&&n[Nn]?n.O(e,t,ve(r)?!!r.capture:!!r,i):ut(n,e,t,!0,r,i)}function Rn(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Rn(n,e[s],t,r,i);else r=ve(r)?!!r.capture:!!r,t=Mt(t),n&&n[Nn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=gn(s=n.g[e],t,r,i))&&(un(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Yt(n))&&(e=n.g[e.toString()],n=-1,e&&(n=gn(e,t,r,i)),(t=-1<n?e[n]:null)&&er(t))}function er(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[Nn])Ze(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(kr(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Yt(e))?(Ze(t,n),0==t.h&&(t.src=null,e[yn]=null)):un(n)}}}function kr(n){return n in xr?xr[n]:xr[n]="on"+n}function ai(n,e){if(n.ba)n=!0;else{e=new an(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&er(n),n=t.call(r,e)}return n}function Yt(n){return(n=n[yn])instanceof Cn?n:null}var Lt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Mt(n){return"function"==typeof n?n:(n[Lt]||(n[Lt]=function(e){return n.handleEvent(e)}),n[Lt])}function xe(){Xe.call(this),this.i=new Cn(this),this.P=this,this.I=null}function Qe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new ye(e,n);else if(e instanceof ye)e.target=e.target||n;else{var i=e;mn(e=new ye(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];i=v(u,r,!0,e)&&i}if(i=v(u=e.g=n,r,!0,e)&&i,i=v(u,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=v(u=e.g=t[s],r,!1,e)&&i}function v(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var l=u.listener,d=u.ha||u.src;u.ea&&Ze(n.i,u),i=!1!==l.call(d,r)&&i}}return i&&!r.defaultPrevented}Oe(xe,Xe),xe.prototype[Nn]=!0,xe.prototype.removeEventListener=function(n,e,t,r){Rn(this,n,e,t,r)},xe.prototype.M=function(){if(xe.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)un(t[r]);delete n.g[e],n.h--}}this.I=null},xe.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},xe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var y=N.JSON.stringify;function w(){var n=fe;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Je,S=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new W,n=>n.reset());class W{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ae(n){N.setTimeout(()=>{throw n},0)}function Ee(n,e){Je||function rt(){var n=N.Promise.resolve(void 0);Je=function(){n.then(Ft)}}(),wt||(Je(),wt=!0),fe.add(n,e)}var wt=!1,fe=new class O{constructor(){this.h=this.g=null}add(e,t){const r=S.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Ft(){for(var n;n=w();){try{n.h.call(n.g)}catch(t){ae(t)}var e=S;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}wt=!1}function Xt(n,e){xe.call(this),this.h=n||1,this.g=e||N,this.j=ce(this.lb,this),this.l=Date.now()}function tr(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function nr(n,e,t){if("function"==typeof n)t&&(n=ce(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=ce(n.handleEvent,n)}return 2147483647<Number(e)?-1:N.setTimeout(n,e||0)}function cs(n){n.g=nr(()=>{n.g=null,n.i&&(n.i=!1,cs(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Oe(Xt,xe),(B=Xt.prototype).ca=!1,B.R=null,B.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Qe(this,"tick"),this.ca&&(tr(this),this.start()))}},B.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},B.M=function(){Xt.X.M.call(this),tr(this),delete this.g};class k extends Xe{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:cs(this)}M(){super.M(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function b(n){Xe.call(this),this.h=n,this.g={}}Oe(b,Xe);var V=[];function K(n,e,t,r){Array.isArray(t)||(t&&(V[0]=t.toString()),t=V);for(var i=0;i<t.length;i++){var s=Dr(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function te(n){Ar(n.g,function(e,t){this.g.hasOwnProperty(t)&&er(e)},n),n.g={}}function he(){this.g=!0}function Ye(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Cr(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<i.length;u++)i[u]=""}}}return y(t)}catch(l){return e}}(n,t)+(r?" "+r:"")})}b.prototype.M=function(){b.X.M.call(this),te(this)},b.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},he.prototype.Aa=function(){this.g=!1},he.prototype.info=function(){};var On={},hs=null;function ui(){return hs=hs||new xe}function ds(n){ye.call(this,On.Pa,n)}function ci(n){const e=ui();Qe(e,new ds(e,n))}function fs(n,e){ye.call(this,On.STAT_EVENT,n),this.stat=e}function Et(n){const e=ui();Qe(e,new fs(e,n))}function ps(n,e){ye.call(this,On.Qa,n),this.size=e}function Pn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){n()},e)}On.Pa="serverreachability",Oe(ds,ye),On.STAT_EVENT="statevent",Oe(fs,ye),On.Qa="timingevent",Oe(ps,ye);var Rr={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Fa={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function li(){}function ms(){}li.prototype.h=null;var fi,hi={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function di(){ye.call(this,"d")}function To(){ye.call(this,"c")}function gs(){}function rr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new b(this),this.O=bo,this.T=new Xt(n=Yn?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Va}function Va(){this.i=null,this.g="",this.h=!1}Oe(di,ye),Oe(To,ye),Oe(gs,li),gs.prototype.g=function(){return new XMLHttpRequest},gs.prototype.i=function(){return{}},fi=new gs;var bo=45e3,pi={},Kt={};function mi(n,e,t){n.K=1,n.v=Is(cn(e)),n.s=t,n.P=!0,Ba(n,null)}function Ba(n,e){n.F=Date.now(),gi(n),n.A=cn(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),wi(t.i,"t",r),n.C=0,t=n.l.H,n.h=new Va,n.g=Uo(n.l,t?e:null,!n.s),0<n.N&&(n.L=new k(ce(n.La,n,n.g),n.N)),K(n.S,n.g,"readystatechange",n.ib),e=n.H?It(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),ci(1),function Te(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var u="",l=s.split("&"),d=0;d<l.length;d++){var f=l[d].split("=");if(1<f.length){var g=f[0];f=f[1];var _=g.split("_");u=2<=_.length&&"type"==_[1]?u+(g+"=")+f+"&":u+(g+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Ln(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function qa(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=So(n,t),i==Kt){4==e&&(n.o=4,Et(14),r=!1),Ye(n.j,n.m,null,"[Incomplete Response]");break}if(i==pi){n.o=4,Et(15),Ye(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Ye(n.j,n.m,i,null),Ao(n,i)}Ln(n)&&i!=Kt&&i!=pi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Et(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Wa(e),e.K=!0,Et(11))):(Ye(n.j,n.m,t,"[Invalid Chunked Response]"),sr(n),ir(n))}function So(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Kt:(t=Number(e.substring(t,r)),isNaN(t)?pi:(r+=1)+t>e.length?Kt:(e=e.substr(r,t),n.C=r+t,e))}function gi(n){n.V=Date.now()+n.O,ys(n,n.O)}function ys(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Pn(ce(n.gb,n),e)}function _s(n){n.B&&(N.clearTimeout(n.B),n.B=null)}function ir(n){0==n.l.G||n.I||Bs(n.l,n)}function sr(n){_s(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,tr(n.T),te(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Ao(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ti(t.h,n)))if(!n.J&&Ti(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(f){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(t.u)t.Ba=i[1],0<t.Ba-t.T&&37500>i[2]&&t.L&&0==t.A&&!t.v&&(t.v=Pn(ce(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Vs(t),Fo(t)}Ni(t),Et(18)}if(1>=Ei(t.h)&&t.ja){try{t.ja()}catch(f){}t.ja=void 0}}else vn(t,11)}else if((n.J||t.g==n)&&Vs(t),!qt(e))for(i=t.Fa.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.T=f[0],f=f[1],2==t.G)if("c"==f[0]){t.I=f[1],t.ka=f[2];const g=f[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const _=f[4];null!=_&&(t.Ca=_,t.j.info("SVER="+t.Ca));const T=f[5];null!=T&&"number"==typeof T&&0<T&&(t.J=r=1.5*T,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const C=n.g;if(C){const P=C.g?C.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(P){var s=r.h;s.g||-1==P.indexOf("spdy")&&-1==P.indexOf("quic")&&-1==P.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ss(s,s.h),s.h=null))}if(r.D){const $=C.g?C.g.getResponseHeader("X-HTTP-Session-Id"):null;$&&(r.za=$,Fe(r.F,r.D,$))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((r=t).sa=sc(r,r.H?r.ka:null,r.V),u.J){As(r.h,u);var l=u,d=r.J;d&&l.setTimeout(d),l.B&&(_s(l),gi(l)),r.g=u}else nc(r);0<t.i.length&&Fr(t)}else"stop"!=f[0]&&"close"!=f[0]||vn(t,7);else 3==t.G&&("stop"==f[0]||"close"==f[0]?"stop"==f[0]?vn(t,7):Di(t):"noop"!=f[0]&&t.l&&t.l.wa(f),t.A=0)}ci(4)}catch(f){}}function Ga(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(oe(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function yi(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(oe(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function xo(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(oe(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(B=rr.prototype).setTimeout=function(n){this.O=n},B.ib=function(n){n=n.target;const e=this.L;e&&3==Mn(n)?e.l():this.La(n)},B.La=function(n){try{if(n==this.g)e:{const g=Mn(this.g);var e=this.g.Ea();const _=this.g.aa();if(!(3>g)&&(3!=g||Yn||this.g&&(this.h.h||this.g.fa()||Os(this.g)))){this.I||4!=g||7==e||ci(8==e||0>=_?3:2),_s(this);var t=this.g.aa();this.Y=t;t:if(Ln(this)){var r=Os(this.g);n="";var i=r.length,s=4==Mn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){sr(this),ir(this);var u="";break t}this.h.i=new N.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function dt(n,e,t,r,i,s,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var l,d=this.g;if((l=d.g?d.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!qt(l)){var f=l;break t}}f=null}if(!(t=f)){this.i=!1,this.o=3,Et(12),sr(this),ir(this);break e}Ye(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ao(this,t)}this.P?(qa(this,g,u),Yn&&this.i&&3==g&&(K(this.S,this.T,"tick",this.hb),this.T.start())):(Ye(this.j,this.m,u,null),Ao(this,u)),4==g&&sr(this),this.i&&!this.I&&(4==g?Bs(this.l,this):(this.i=!1,gi(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Et(12)):(this.o=0,Et(13)),sr(this),ir(this)}}}catch(g){}},B.hb=function(){if(this.g){var n=Mn(this.g),e=this.g.fa();this.C<e.length&&(_s(this),qa(this,n,e),this.i&&4!=n&&gi(this))}},B.cancel=function(){this.I=!0,sr(this)},B.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function ls(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(ci(3),Et(17)),sr(this),this.o=2,ir(this)):ys(this,this.V-n)};var ja=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Or(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Or){this.h=void 0!==e?e:n.h,Jt(this,n.j),this.s=n.s,this.g=n.g,Pr(this,n.m),this.l=n.l,e=n.i;var t=new ft;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),_i(this,t),this.o=n.o}else n&&(t=String(n).match(ja))?(this.h=!!e,Jt(this,t[1]||"",!0),this.s=ws(t[2]||""),this.g=ws(t[3]||"",!0),Pr(this,t[4]),this.l=ws(t[5]||"",!0),_i(this,t[6]||"",!0),this.o=ws(t[7]||"")):(this.h=!!e,this.i=new ft(null,this.h))}function cn(n){return new Or(n)}function Jt(n,e,t){n.j=t?ws(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Pr(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function _i(n,e,t){e instanceof ft?(n.i=e,function za(n,e){e&&!n.j&&(_n(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Zu(this,r),wi(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=vi(e,Ka)),n.i=new ft(e,n.h))}function Fe(n,e,t){n.i.set(e,t)}function Is(n){return Fe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ws(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function vi(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Ii),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Ii(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Or.prototype.toString=function(){var n=[],e=this.j;e&&n.push(vi(e,$a,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(vi(e,$a,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(vi(t,"/"==t.charAt(0)?Ph:Do,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",vi(t,No)),n.join("")};var $a=/[#\/\?@]/g,Do=/[#\?:]/g,Ph=/[#\?]/g,Ka=/[#\?@]/g,No=/#/g;function ft(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function _n(n){n.g||(n.g=new Map,n.h=0,n.i&&function vs(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function Zu(n,e){_n(n),e=or(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Es(n,e){return _n(n),e=or(n,e),n.g.has(e)}function wi(n,e,t){Zu(n,e),0<t.length&&(n.i=null,n.g.set(or(n,e),we(t)),n.h+=t.length)}function or(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Ts(n){this.l=n||ko,n=N.PerformanceNavigationTiming?0<(n=N.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(N.g&&N.g.Ga&&N.g.Ga()&&N.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(B=ft.prototype).add=function(n,e){_n(this),this.i=null,n=or(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},B.forEach=function(n,e){_n(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},B.oa=function(){_n(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},B.W=function(n){_n(this);let e=[];if("string"==typeof n)Es(this,n)&&(e=e.concat(this.g.get(or(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},B.set=function(n,e){return _n(this),this.i=null,Es(this,n=or(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},B.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},B.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),u=this.W(r);for(r=0;r<u.length;r++){var i=s;""!==u[r]&&(i+="="+encodeURIComponent(String(u[r]))),n.push(i)}}return this.i=n.join("&")};var ko=10;function bs(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Ei(n){return n.h?1:n.g?n.g.size:0}function Ti(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ss(n,e){n.g?n.g.add(e):n.h=e}function As(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Co(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return we(n.i)}function bi(){}function Ro(){this.g=new bi}function Oo(n,e,t){const r=t||"";try{Ga(n,function(i,s){let u=i;ve(i)&&(u=y(i)),e.push(r+s+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Lr(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(s){}}function Si(n){this.l=n.ac||null,this.j=n.jb||!1}function Mr(n,e){xe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Po,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ts.prototype.cancel=function(){if(this.i=Co(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},bi.prototype.stringify=function(n){return N.JSON.stringify(n,void 0)},bi.prototype.parse=function(n){return N.JSON.parse(n,void 0)},Oe(Si,li),Si.prototype.g=function(){return new Mr(this.l,this.j)},Si.prototype.i=function(n){return function(){return n}}({}),Oe(Mr,xe);var Po=0;function xs(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Ds(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ar(n)}function ar(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(B=Mr.prototype).open=function(n,e){if(this.readyState!=Po)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ar(this)},B.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||N).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},B.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ds(this)),this.readyState=Po},B.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ar(this)),this.g&&(this.readyState=3,ar(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==N.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;xs(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},B.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ds(this):ar(this),3==this.readyState&&xs(this)}},B.Va=function(n){this.g&&(this.response=this.responseText=n,Ds(this))},B.Ua=function(n){this.g&&(this.response=n,Ds(this))},B.ga=function(){this.g&&Ds(this)},B.setRequestHeader=function(n,e){this.v.append(n,e)},B.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},B.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Mr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Lo=N.JSON.parse;function Ue(n){xe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ai,this.K=this.L=!1}Oe(Ue,xe);var Ai="",Mh=/^https?$/i,Mo=["POST","PUT"];function Ns(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Yu(n),Cs(n)}function Yu(n){n.D||(n.D=!0,Qe(n,"complete"),Qe(n,"error"))}function ks(n){if(n.h&&void 0!==L&&(!n.C[1]||4!=Mn(n)||2!=n.aa()))if(n.v&&4==Mn(n))nr(n.Ha,0,n);else if(Qe(n,"readystatechange"),4==Mn(n)){n.h=!1;try{const l=n.aa();e:switch(l){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===l){var i=String(n.H).match(ja)[1]||null;if(!i&&N.self&&N.self.location){var s=N.self.location.protocol;i=s.substr(0,s.length-1)}r=!Mh.test(i?i.toLowerCase():"")}t=r}if(t)Qe(n,"complete"),Qe(n,"success");else{n.m=6;try{var u=2<Mn(n)?n.g.statusText:""}catch(d){u=""}n.j=u+" ["+n.aa()+"]",Yu(n)}}finally{Cs(n)}}}function Cs(n,e){if(n.g){Rs(n);const t=n.g,r=n.C[0]?J:null;n.g=null,n.C=null,e||Qe(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function Rs(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(N.clearTimeout(n.A),n.A=null)}function Mn(n){return n.g?n.g.readyState:0}function Os(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ai:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Xu(n){let e="";return Ar(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function xi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Xu(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Fe(n,e,t))}function Ps(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ju(n){this.Ca=0,this.i=[],this.j=new he,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Ps("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Ps("baseRetryDelayMs",5e3,n),this.bb=Ps("retryDelaySeedMs",1e4,n),this.$a=Ps("forwardChannelMaxRetries",2,n),this.ta=Ps("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new Ts(n&&n.concurrentRequestLimit),this.Fa=new Ro,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Di(n){if(ec(n),3==n.G){var e=n.U++,t=cn(n.F);Fe(t,"SID",n.I),Fe(t,"RID",e),Fe(t,"TYPE","terminate"),Ms(n,t),(e=new rr(n,n.j,e,void 0)).K=2,e.v=Is(cn(t)),t=!1,N.navigator&&N.navigator.sendBeacon&&(t=N.navigator.sendBeacon(e.v.toString(),"")),!t&&N.Image&&((new Image).src=e.v,t=!0),t||(e.g=Uo(e.l,null),e.g.da(e.v)),e.F=Date.now(),gi(e)}ic(n)}function Fo(n){n.g&&(Wa(n),n.g.cancel(),n.g=null)}function ec(n){Fo(n),n.u&&(N.clearTimeout(n.u),n.u=null),Vs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&N.clearTimeout(n.m),n.m=null)}function Fr(n){bs(n.h)||n.m||(n.m=!0,Ee(n.Ja,n),n.C=0)}function Ls(n,e){var t;t=e?e.m:n.U++;const r=cn(n.F);Fe(r,"SID",n.I),Fe(r,"RID",t),Fe(r,"AID",n.T),Ms(n,r),n.o&&n.s&&xi(r,n.o,n.s),t=new rr(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Fs(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ss(n.h,t),mi(t,r,e)}function Ms(n,e){n.ia&&Ar(n.ia,function(t,r){Fe(e,r,t)}),n.l&&Ga({},function(t,r){Fe(e,r,t)})}function Fs(n,e,t){t=Math.min(n.i.length,t);var r=n.l?ce(n.l.Ra,n.l,n):null;e:{var i=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=i[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let l=!0;for(let d=0;d<t;d++){let f=i[d].h;const g=i[d].g;if(f-=s,0>f)s=Math.max(0,i[d].h-100),l=!1;else try{Oo(g,u,"req"+f+"_")}catch(_){r&&r(g)}}if(l){r=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function nc(n){n.g||n.u||(n.Z=1,Ee(n.Ia,n),n.A=0)}function Ni(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Pn(ce(n.Ia,n),rc(n,n.A)),n.A++,0))}function Wa(n){null!=n.B&&(N.clearTimeout(n.B),n.B=null)}function Us(n){n.g=new rr(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=cn(n.sa);Fe(e,"RID","rpc"),Fe(e,"SID",n.I),Fe(e,"CI",n.L?"0":"1"),Fe(e,"AID",n.T),Fe(e,"TYPE","xmlhttp"),Ms(n,e),n.o&&n.s&&xi(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Is(cn(e)),t.s=null,t.P=!0,Ba(t,n)}function Vs(n){null!=n.v&&(N.clearTimeout(n.v),n.v=null)}function Bs(n,e){var t=null;if(n.g==e){Vs(n),Wa(n),n.g=null;var r=2}else{if(!Ti(n.h,e))return;t=e.D,As(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;Qe(r=ui(),new ps(r,t,e,i)),Fr(n)}else nc(n);else if(3==(i=e.o)||0==i&&0<n.pa||!(1==r&&function tc(n,e){return!(Ei(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Pn(ce(n.Ja,n,e),rc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ni(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),i){case 1:vn(n,5);break;case 4:vn(n,10);break;case 3:vn(n,6);break;default:vn(n,2)}}function rc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function vn(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=ce(n.kb,n);t||(t=new Or("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Jt(t,"https"),Is(t)),function Qu(n,e){const t=new he;if(N.Image){const r=new Image;r.onload=Ae(Lr,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ae(Lr,t,r,"TestLoadImage: error",!1,e),r.onabort=Ae(Lr,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ae(Lr,t,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Et(2);n.G=0,n.l&&n.l.va(e),ic(n),ec(n)}function ic(n){if(n.G=0,n.la=[],n.l){const e=Co(n.h);(0!=e.length||0!=n.i.length)&&(xt(n.la,e),xt(n.la,n.i),n.h.i.length=0,we(n.i),n.i.length=0),n.l.ua()}}function sc(n,e,t){var r=t instanceof Or?cn(t):new Or(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Pr(r,r.m);else{var i=N.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Or(null,void 0);r&&Jt(s,r),e&&(s.g=e),i&&Pr(s,i),t&&(s.l=t),r=s}return e=n.za,(t=n.D)&&e&&Fe(r,t,e),Fe(r,"VER",n.ma),Ms(n,r),r}function Uo(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ue(t&&n.Da&&!n.ra?new Si({jb:!0}):n.ra)).Ka(n.H),e}function qs(){}function Gs(){if(kt&&!(10<=Number(Sr)))throw Error("Environmental error: no available transport.")}function Tt(n,e){xe.call(this),this.g=new Ju(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!qt(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qt(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Ur(this)}function oc(n){di.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Ha(){To.call(this),this.status=1}function Ur(n){this.g=n}(B=Ue.prototype).Ka=function(n){this.L=n},B.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():fi.g(),this.C=function Ua(n){return n.h||(n.h=n.i())}(this.u?this.u:fi),this.g.onreadystatechange=ce(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Ns(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=N.FormData&&n instanceof N.FormData,!(0<=je(Mo,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Rs(this),0<this.B&&((this.K=function Fh(n){return kt&&function si(){return function pn(n){var e=ii;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=Gt(String(jt)).split("."),t=Gt("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",s=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;n=Dt(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Dt(0==i[2].length,0==s[2].length)||Dt(i[2],s[2]),i=i[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ce(this.qa,this)):this.A=nr(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ns(this,s)}},B.qa=function(){void 0!==L&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Qe(this,"timeout"),this.abort(8))},B.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Qe(this,"complete"),Qe(this,"abort"),Cs(this))},B.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Cs(this,!0)),Ue.X.M.call(this)},B.Ha=function(){this.s||(this.F||this.v||this.l?ks(this):this.fb())},B.fb=function(){ks(this)},B.aa=function(){try{return 2<Mn(this)?this.g.status:-1}catch(n){return-1}},B.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},B.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Lo(e)}},B.Ea=function(){return this.m},B.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(B=Ju.prototype).ma=8,B.G=1,B.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const i=new rr(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=It(s),mn(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Fs(this,i,e),Fe(t=cn(this.F),"RID",n),Fe(t,"CVER",22),this.D&&Fe(t,"X-HTTP-Session-Id",this.D),Ms(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(Xu(s)))+"&"+e:this.o&&xi(t,this.o,s)),Ss(this.h,i),this.Ya&&Fe(t,"TYPE","init"),this.O?(Fe(t,"$req",e),Fe(t,"SID","null"),i.Z=!0,mi(i,t,null)):mi(i,t,e),this.G=2}}else 3==this.G&&(n?Ls(this,n):0==this.i.length||bs(this.h)||Ls(this))},B.Ia=function(){if(this.u=null,Us(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Pn(ce(this.eb,this),n)}},B.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Et(10),Fo(this),Us(this))},B.cb=function(){null!=this.v&&(this.v=null,Fo(this),Ni(this),Et(19))},B.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Et(2)):(this.j.info("Failed to ping google.com"),Et(1))},(B=qs.prototype).xa=function(){},B.wa=function(){},B.va=function(){},B.ua=function(){},B.Ra=function(){},Gs.prototype.g=function(n,e){return new Tt(n,e)},Oe(Tt,xe),Tt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Et(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=sc(n,null,n.V),Fr(n)},Tt.prototype.close=function(){Di(this.g)},Tt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=y(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&Fr(e)},Tt.prototype.M=function(){this.g.l=null,delete this.j,Di(this.g),delete this.g,Tt.X.M.call(this)},Oe(oc,di),Oe(Ha,To),Oe(Ur,qs),Ur.prototype.xa=function(){Qe(this.g,"a")},Ur.prototype.wa=function(n){Qe(this.g,new oc(n))},Ur.prototype.va=function(n){Qe(this.g,new Ha(n))},Ur.prototype.ua=function(){Qe(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,Tt.prototype.send=Tt.prototype.u,Tt.prototype.open=Tt.prototype.m,Tt.prototype.close=Tt.prototype.close,Rr.NO_ERROR=0,Rr.TIMEOUT=8,Rr.HTTP_ERROR=6,Fa.COMPLETE="complete",ms.EventType=hi,hi.OPEN="a",hi.CLOSE="b",hi.ERROR="c",hi.MESSAGE="d",xe.prototype.listen=xe.prototype.N,Ue.prototype.listenOnce=Ue.prototype.O,Ue.prototype.getLastError=Ue.prototype.Oa,Ue.prototype.getLastErrorCode=Ue.prototype.Ea,Ue.prototype.getStatus=Ue.prototype.aa,Ue.prototype.getResponseJson=Ue.prototype.Sa,Ue.prototype.getResponseText=Ue.prototype.fa,Ue.prototype.send=Ue.prototype.da,Ue.prototype.setWithCredentials=Ue.prototype.Ka;var ac=Re.createWebChannelTransport=function(){return new Gs},uc=Re.getStatEventTarget=function(){return ui()},Za=Re.ErrorCode=Rr,Uh=Re.EventType=Fa,cc=Re.Event=On,Qa=Re.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Vh=Re.FetchXmlHttpFactory=Si,Vo=Re.WebChannel=ms,Bh=Re.XhrIo=Ue;const lc="@firebase/firestore";class ct{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ct.UNAUTHENTICATED=new ct(null),ct.GOOGLE_CREDENTIALS=new ct("google-credentials-uid"),ct.FIRST_PARTY=new ct("first-party-uid"),ct.MOCK_USER=new ct("mock-user");let Fn="9.12.1";const Rt=new Ce.Yd("@firebase/firestore");function ki(){return Rt.logLevel}function U(n,...e){if(Rt.logLevel<=Ce.in.DEBUG){const t=e.map(Ci);Rt.debug(`Firestore (${Fn}): ${n}`,...t)}}function He(n,...e){if(Rt.logLevel<=Ce.in.ERROR){const t=e.map(Ci);Rt.error(`Firestore (${Fn}): ${n}`,...t)}}function ur(n,...e){if(Rt.logLevel<=Ce.in.WARN){const t=e.map(Ci);Rt.warn(`Firestore (${Fn}): ${n}`,...t)}}function Ci(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function z(n="Unexpected state"){const e=`FIRESTORE (${Fn}) INTERNAL ASSERTION FAILED: `+n;throw He(e),new Error(e)}function re(n,e){n||z()}function G(n,e){return n}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class F extends ie.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class et{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class hc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class dc{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ct.UNAUTHENTICATED))}shutdown(){}}class Gh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ya{constructor(e){this.t=e,this.currentUser=ct.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=f=>this.i!==i?(i=this.i,t(f)):Promise.resolve();let u=new et;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new et,e.enqueueRetryable(()=>s(this.currentUser))};const l=()=>{const f=u;e.enqueueRetryable((0,I.Z)(function*(){yield f.promise,yield s(r.currentUser)}))},d=f=>{U("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.auth.addAuthTokenListener(this.o),l()};this.t.onInit(f=>d(f)),setTimeout(()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?d(f):(U("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new et)}},0),l()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(U("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(re("string"==typeof r.accessToken),new hc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return re(null===e||"string"==typeof e),new ct(e)}}class fc{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i,this.type="FirstParty",this.user=ct.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(re(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class pc{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i}getToken(){return Promise.resolve(new fc(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(ct.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ri{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class mc{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=s=>{null!=s.error&&U("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,U("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{U("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?i(s):U("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(re("string"==typeof t.token),this.A=t.token,new Ri(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function gc(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class $s{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=gc(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function se(n,e){return n<e?-1:n>e?1:0}function Un(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Xa(n){return n+"\0"}class Ve{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new F(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new F(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new F(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new F(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Ve.fromMillis(Date.now())}static fromDate(e){return Ve.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Ve(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?se(this.nanoseconds,e.nanoseconds):se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ee{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ee(e)}static min(){return new ee(new Ve(0,0))}static max(){return new ee(new Ve(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Oi{constructor(e,t,r){void 0===t?t=0:t>e.length&&z(),void 0===r?r=e.length-t:r>e.length-t&&z(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Oi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Oi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),u=t.get(i);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class de extends Oi{construct(e,t,r){return new de(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new F(D.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new de(t)}static emptyPath(){return new de([])}}const Ja=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ke extends Oi{construct(e,t,r){return new ke(e,t,r)}static isValidIdentifier(e){return Ja.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ke.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ke(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new F(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const l=e[i];if("\\"===l){if(i+1===e.length)throw new F(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const d=e[i+1];if("\\"!==d&&"."!==d&&"`"!==d)throw new F(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=d,i+=2}else"`"===l?(u=!u,i++):"."!==l||u?(r+=l,i++):(s(),i++)}if(s(),u)throw new F(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ke(t)}static emptyPath(){return new ke([])}}class q{constructor(e){this.path=e}static fromPath(e){return new q(de.fromString(e))}static fromName(e){return new q(de.fromString(e).popFirst(5))}static empty(){return new q(de.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===de.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return de.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new q(new de(e.slice()))}}class Ks{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Pi(n){return n.fields.find(e=>2===e.kind)}function Vn(n){return n.fields.filter(e=>2!==e.kind)}Ks.UNKNOWN_ID=-1;class zs{constructor(e,t){this.fieldPath=e,this.kind=t}}class Vr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Vr(0,zt.min())}}function eu(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=ee.fromTimestamp(1e9===r?new Ve(t+1,0):new Ve(t,r));return new zt(i,q.empty(),e)}function tu(n){return new zt(n.readTime,n.key,-1)}class zt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new zt(ee.min(),q.empty(),-1)}static max(){return new zt(ee.max(),q.empty(),-1)}}function Go(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=q.comparator(n.documentKey,e.documentKey),0!==t?t:se(n.largestBatchId,e.largestBatchId))}const nu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ru{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Bn(n){return Li.apply(this,arguments)}function Li(){return Li=(0,I.Z)(function*(n){if(n.code!==D.FAILED_PRECONDITION||n.message!==nu)throw n;U("LocalStore","Unexpectedly lost primary lease")}),Li.apply(this,arguments)}class A{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new A((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof A?t:A.resolve(t)}catch(t){return A.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):A.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):A.reject(t)}static resolve(e){return new A((t,r)=>{t(e)})}static reject(e){return new A((t,r)=>{r(e)})}static waitFor(e){return new A((t,r)=>{let i=0,s=0,u=!1;e.forEach(l=>{++i,l.next(()=>{++s,u&&s===i&&t()},d=>r(d))}),u=!0,s===i&&t()})}static or(e){let t=A.resolve(!1);for(const r of e)t=t.next(i=>i?A.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new A((r,i)=>{const s=e.length,u=new Array(s);let l=0;for(let d=0;d<s;d++){const f=d;t(e[f]).next(g=>{u[f]=g,++l,l===s&&r(u)},g=>i(g))}})}static doWhile(e,t){return new A((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class Mi{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new et,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Fi(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=Ui(r.target.error);this.P.reject(new Fi(e,i))}}static open(e,t,r,i){try{return new Mi(t,e.transaction(i,r))}catch(s){throw new Fi(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(U("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new _c(t)}}class Wt{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Wt.D((0,ie.z$)())&&He("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return U("SimpleDb","Removing database:",e),cr(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,ie.hl)())return!1;if(Wt.N())return!0;const e=(0,ie.z$)(),t=Wt.D(e),r=0<t&&t<10,i=Wt.k(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,I.Z)(function*(){return t.db||(U("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{r(u.target.result)},s.onblocked=()=>{i(new Fi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const l=u.target.error;i("VersionError"===l.name?new F(D.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===l.name?new F(D.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+l):new Fi(e,l))},s.onupgradeneeded=u=>{U("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{U("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,I.Z)(function*(){const u="readonly"===t;let l=0;for(;;){++l;try{s.db=yield s.F(e);const d=Mi.open(s.db,e,u?"readonly":"readwrite",r),f=i(d).next(g=>(d.V(),g)).catch(g=>(d.abort(g),A.reject(g))).toPromise();return f.catch(()=>{}),yield d.v,f}catch(d){const f=d,g="FirebaseError"!==f.name&&l<3;if(U("SimpleDb","Transaction failed with error:",f.message,"Retrying:",g),s.close(),!g)return Promise.reject(f)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class yc{constructor(e){this.U=e,this.q=!1,this.K=null}get isDone(){return this.q}get G(){return this.K}set cursor(e){this.U=e}done(){this.q=!0}j(e){this.K=e}delete(){return cr(this.U.delete())}}class Fi extends F{constructor(e,t){super(D.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function en(n){return"IndexedDbTransactionError"===n.name}class _c{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(U("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(U("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),cr(r)}add(e){return U("SimpleDb","ADD",this.store.name,e,e),cr(this.store.add(e))}get(e){return cr(this.store.get(e)).next(t=>(void 0===t&&(t=null),U("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return U("SimpleDb","DELETE",this.store.name,e),cr(this.store.delete(e))}count(){return U("SimpleDb","COUNT",this.store.name),cr(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.H(i,(u,l)=>{s.push(l)}).next(()=>s)}{const i=this.store.getAll(r.range);return new A((s,u)=>{i.onerror=l=>{u(l.target.error)},i.onsuccess=l=>{s(l.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new A((i,s)=>{r.onerror=u=>{s(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}Y(e,t){U("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,(s,u,l)=>l.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}tt(e){const t=this.cursor({});return new A((r,i)=>{t.onerror=s=>{const u=Ui(s.target.error);i(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(l=>{l?u.continue():r()}):r()}})}H(e,t){const r=[];return new A((i,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const l=u.target.result;if(!l)return void i();const d=new yc(l),f=t(l.primaryKey,l.value,d);if(f instanceof A){const g=f.catch(_=>(d.done(),A.reject(_)));r.push(g)}d.isDone?i():null===d.G?l.continue():l.continue(d.G)}}).next(()=>A.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function cr(n){return new A((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Ui(r.target.error);t(i)}})}let iu=!1;function Ui(n){const e=Wt.D((0,ie.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new F("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return iu||(iu=!0,setTimeout(()=>{throw r},0)),r}}return n}class vc{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;U("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,I.Z)(function*(){t.task=null;try{U("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){en(r)?U("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Bn(r)}yield t.nt(6e4)}))}}class Ic{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,I.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let i=t,s=!0;return A.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return U("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,i).next(l=>{i-=l,r.add(u)});s=!1})).next(()=>t-i)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(i,s)).next(l=>(U("IndexBackiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>u.size)}))}ot(e,t){let r=e;return t.changes.forEach((i,s)=>{const u=tu(s);Go(u,r)>0&&(r=u)}),new zt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Ot{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>t.writeSequenceNumber(r))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}function su(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function lr(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function jo(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}Ot.at=-1;class We{constructor(e,t){this.comparator=e,this.root=t||lt.EMPTY}insert(e,t){return new We(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,lt.BLACK,null,null))}remove(e){return new We(this.comparator,this.root.remove(e,this.comparator).copy(null,null,lt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $o(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $o(this.root,e,this.comparator,!1)}getReverseIterator(){return new $o(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $o(this.root,e,this.comparator,!0)}}class $o{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class lt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:lt.RED,this.left=null!=i?i:lt.EMPTY,this.right=null!=s?s:lt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new lt(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return lt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return lt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,lt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,lt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();const e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}}lt.EMPTY=null,lt.RED=!0,lt.BLACK=!1,lt.EMPTY=new class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(n,e,t,r,i){return this}insert(n,e,t){return new lt(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ie{constructor(e){this.comparator=e,this.data=new We(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new wc(this.data.getIterator())}getIteratorFrom(e){return new wc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Ie)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Ie(this.comparator);return t.data=e,t}}class wc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function qn(n){return n.hasNext()?n.getNext():void 0}class Ht{constructor(e){this.fields=e,e.sort(ke.comparator)}static empty(){return new Ht([])}unionWith(e){let t=new Ie(ke.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ht(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Un(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class st{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new st(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new st(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}st.EMPTY_BYTE_STRING=new st("");const zo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ln(n){if(re(!!n),"string"==typeof n){let e=0;const t=zo.exec(n);if(re(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Be(n.seconds),nanos:Be(n.nanos)}}function Be(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Br(n){return"string"==typeof n?st.fromBase64String(n):st.fromUint8Array(n)}function Vi(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ec(n){const e=n.mapValue.fields.__previous_value__;return Vi(e)?Ec(e):e}function tn(n){const e=ln(n.mapValue.fields.__local_write_time__.timestampValue);return new Ve(e.seconds,e.nanos)}class Wo{constructor(e,t,r,i,s,u,l,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=l,this.useFetchStreams=d}}class Gn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Gn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Gn&&e.projectId===this.projectId&&e.database===this.database}}function Bi(n){return null==n}function qi(n){return 0===n&&1/n==-1/0}function Ws(n){return"number"==typeof n&&Number.isInteger(n)&&!qi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const In={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Hs={nullValue:"NULL_VALUE"};function hr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Vi(n)?4:bc(n)?9007199254740991:10:z()}function Zt(n,e){if(n===e)return!0;const t=hr(n);if(t!==hr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return tn(n).isEqual(tn(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=ln(r.timestampValue),u=ln(i.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Br(n.bytesValue).isEqual(Br(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return Be(r.geoPointValue.latitude)===Be(i.geoPointValue.latitude)&&Be(r.geoPointValue.longitude)===Be(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return Be(r.integerValue)===Be(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=Be(r.doubleValue),u=Be(i.doubleValue);return s===u?qi(s)===qi(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Un(n.arrayValue.values||[],e.arrayValue.values||[],Zt);case 10:return function(r,i){const s=r.mapValue.fields||{},u=i.mapValue.fields||{};if(su(s)!==su(u))return!1;for(const l in s)if(s.hasOwnProperty(l)&&(void 0===u[l]||!Zt(s[l],u[l])))return!1;return!0}(n,e);default:return z()}var i}function Zs(n,e){return void 0!==(n.values||[]).find(t=>Zt(t,e))}function hn(n,e){if(n===e)return 0;const t=hr(n),r=hr(e);if(t!==r)return se(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return se(n.booleanValue,e.booleanValue);case 2:return function(i,s){const u=Be(i.integerValue||i.doubleValue),l=Be(s.integerValue||s.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(n,e);case 3:return Tc(n.timestampValue,e.timestampValue);case 4:return Tc(tn(n),tn(e));case 5:return se(n.stringValue,e.stringValue);case 6:return function(i,s){const u=Br(i),l=Br(s);return u.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const u=i.split("/"),l=s.split("/");for(let d=0;d<u.length&&d<l.length;d++){const f=se(u[d],l[d]);if(0!==f)return f}return se(u.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const u=se(Be(i.latitude),Be(s.latitude));return 0!==u?u:se(Be(i.longitude),Be(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const u=i.values||[],l=s.values||[];for(let d=0;d<u.length&&d<l.length;++d){const f=hn(u[d],l[d]);if(f)return f}return se(u.length,l.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===In.mapValue&&s===In.mapValue)return 0;if(i===In.mapValue)return 1;if(s===In.mapValue)return-1;const u=i.fields||{},l=Object.keys(u),d=s.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){const _=se(l[g],f[g]);if(0!==_)return _;const T=hn(u[l[g]],d[f[g]]);if(0!==T)return T}return se(l.length,f.length)}(n.mapValue,e.mapValue);default:throw z()}}function Tc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return se(n,e);const t=ln(n),r=ln(e),i=se(t.seconds,r.seconds);return 0!==i?i:se(t.nanos,r.nanos)}function jn(n){return Gi(n)}function Gi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=ln(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Br(n.bytesValue).toBase64():"referenceValue"in n?q.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const u of r.values||[])s?s=!1:i+=",",i+=Gi(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",u=!0;for(const l of i)u?u=!1:s+=",",s+=`${l}:${Gi(r.fields[l])}`;return s+"}"}(n.mapValue):z();var e}function dr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function fr(n){return!!n&&"integerValue"in n}function ji(n){return!!n&&"arrayValue"in n}function ou(n){return!!n&&"nullValue"in n}function Qs(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qr(n){return!!n&&"mapValue"in n}function pr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return lr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=pr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=pr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function bc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Sc(n){return"nullValue"in n?Hs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?dr(Gn.empty(),q.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:z()}function au(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?dr(Gn.empty(),q.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?In:z()}function Ho(n,e){const t=hn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Ac(n,e){const t=hn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class ht{constructor(e){this.value=e}static empty(){return new ht({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=pr(t)}setAll(e){let t=ke.emptyPath(),r={},i=[];e.forEach((u,l)=>{if(!t.isImmediateParentOf(l)){const d=this.getFieldsMap(t);this.applyChanges(d,r,i),r={},i=[],t=l.popLast()}u?r[l.lastSegment()]=pr(u):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());qr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Zt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];qr(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){lr(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new ht(pr(this.value))}}function Ys(n){const e=[];return lr(n.fields,(t,r)=>{const i=new ke([t]);if(qr(r)){const s=Ys(r.mapValue).fields;if(0===s.length)e.push(i);else for(const u of s)e.push(i.child(u))}else e.push(i)}),new Ht(e)}class Pe{constructor(e,t,r,i,s,u){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.data=s,this.documentState=u}static newInvalidDocument(e){return new Pe(e,0,ee.min(),ee.min(),ht.empty(),0)}static newFoundDocument(e,t,r){return new Pe(e,1,t,ee.min(),r,0)}static newNoDocument(e,t){return new Pe(e,2,t,ee.min(),ht.empty(),0)}static newUnknownDocument(e,t){return new Pe(e,3,t,ee.min(),ht.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ht.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ht.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Pe&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Pe(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xc{constructor(e,t=null,r=[],i=[],s=null,u=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=u,this.endAt=l,this.ht=null}}function Xs(n,e=null,t=[],r=[],i=null,s=null,u=null){return new xc(n,e,t,r,i,s,u)}function Gr(n){const e=G(n);if(null===e.ht){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>{return(i=r).field.canonicalString()+i.op.toString()+jn(i.value);var i}).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Bi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>jn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>jn(r)).join(",")),e.ht=t}return e.ht}function mr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!Oc(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if((t=n.filters[i]).op!==(r=e.filters[i]).op||!t.field.isEqual(r.field)||!Zt(t.value,r.value))return!1;var t,r;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cu(n.startAt,e.startAt)&&cu(n.endAt,e.endAt)}function Zo(n){return q.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function jr(n,e){return n.filters.filter(t=>t instanceof ot&&t.field.isEqual(e))}function Qo(n,e,t){let r=Hs,i=!0;for(const s of jr(n,e)){let u=Hs,l=!0;switch(s.op){case"<":case"<=":u=Sc(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,l=!1;break;case"!=":case"not-in":u=Hs}Ho({value:r,inclusive:i},{value:u,inclusive:l})<0&&(r=u,i=l)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Ho({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function Js(n,e,t){let r=In,i=!0;for(const s of jr(n,e)){let u=In,l=!0;switch(s.op){case">=":case">":u=au(s.value),l=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,l=!1;break;case"!=":case"not-in":u=In}Ac({value:r,inclusive:i},{value:u,inclusive:l})>0&&(r=u,i=l)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Ac({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class ot extends class{}{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,r):new Yo(e,t,r):"array-contains"===t?new uu(e,r):"in"===t?new Cc(e,r):"not-in"===t?new Rc(e,r):"array-contains-any"===t?new Jo(e,r):new ot(e,t,r)}static lt(e,t,r){return"in"===t?new Nc(e,r):new kc(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(hn(t,this.value)):null!==t&&hr(this.value)===hr(t)&&this.ft(hn(t,this.value))}ft(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return z()}}dt(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Yo extends ot{constructor(e,t,r){super(e,t,r),this.key=q.fromName(r.referenceValue)}matches(e){const t=q.comparator(e.key,this.key);return this.ft(t)}}class Nc extends ot{constructor(e,t){super(e,"in",t),this.keys=Xo(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class kc extends ot{constructor(e,t){super(e,"not-in",t),this.keys=Xo(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Xo(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>q.fromName(r.referenceValue))}class uu extends ot{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ji(t)&&Zs(t.arrayValue,this.value)}}class Cc extends ot{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Zs(this.value.arrayValue,t)}}class Rc extends ot{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Zs(this.value.arrayValue,t)}}class Jo extends ot{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ji(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Zs(this.value.arrayValue,r))}}class $n{constructor(e,t){this.position=e,this.inclusive=t}}class $r{constructor(e,t="asc"){this.field=e,this.dir=t}}function Oc(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function eo(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],u=n.position[i];if(r=s.field.isKeyField()?q.comparator(q.fromName(u.referenceValue),t.key):hn(u,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function cu(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Zt(n.position[t],e.position[t]))return!1;return!0}class wn{constructor(e,t=null,r=[],i=[],s=null,u="F",l=null,d=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=u,this.startAt=l,this.endAt=d,this._t=null,this.wt=null}}function ea(n,e,t,r,i,s,u,l){return new wn(n,e,t,r,i,s,u,l)}function Kr(n){return new wn(n)}function $i(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function ta(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function na(n){for(const e of n.filters)if(e.dt())return e.field;return null}function ra(n){return null!==n.collectionGroup}function zr(n){const e=G(n);if(null===e._t){e._t=[];const t=na(e),r=ta(e);if(null!==t&&null===r)t.isKeyField()||e._t.push(new $r(t)),e._t.push(new $r(ke.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e._t.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e._t.push(new $r(ke.keyField(),s))}}}return e._t}function bt(n){const e=G(n);if(!e.wt)if("F"===e.limitType)e.wt=Xs(e.path,e.collectionGroup,zr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of zr(e))t.push(new $r(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new $n(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new $n(e.startAt.position,e.startAt.inclusive):null;e.wt=Xs(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e.wt}function to(n,e,t){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Ki(n,e){return mr(bt(n),bt(e))&&n.limitType===e.limitType}function lu(n){return`${Gr(bt(n))}|lt:${n.limitType}`}function zi(n){return`Query(target=${function Dc(n){let e=n.path.canonicalString();return null!==n.collectionGroup&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(r=t).field.canonicalString()} ${r.op} ${jn(r.value)}`;var r}).join(", ")}]`),Bi(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>{return`${(r=t).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>jn(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>jn(t)).join(",")),`Target(${e})`}(bt(n))}; limitType=${n.limitType})`}function ia(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):q.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of t.explicitOrderBy)if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,u){const l=eo(i,s,u);return i.inclusive?l<=0:l<0}(t.startAt,zr(t),r)||t.endAt&&!function(i,s,u){const l=eo(i,s,u);return i.inclusive?l>=0:l>0}(t.endAt,zr(t),r)));var t,r}function hu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function du(n){return(e,t)=>{let r=!1;for(const i of zr(n)){const s=Pc(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function Pc(n,e,t){const r=n.field.isKeyField()?q.comparator(e.key,t.key):function(i,s,u){const l=s.data.field(i),d=u.data.field(i);return null!==l&&null!==d?hn(l,d):z()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return z()}}function fu(n,e){if(n.gt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:qi(e)?"-0":e}}function sa(n){return{integerValue:""+n}}function pu(n,e){return Ws(e)?sa(e):fu(n,e)}class no{constructor(){this._=void 0}}function Lc(n,e,t){return n instanceof Wr?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof En?mu(n,e):n instanceof gr?Fc(n,e):function(r,i){const s=oa(r,i),u=Uc(s)+Uc(r.yt);return fr(s)&&fr(r.yt)?sa(u):fu(r.It,u)}(n,e)}function Mc(n,e,t){return n instanceof En?mu(n,e):n instanceof gr?Fc(n,e):t}function oa(n,e){return n instanceof yr?fr(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class Wr extends no{}class En extends no{constructor(e){super(),this.elements=e}}function mu(n,e){const t=aa(e);for(const r of n.elements)t.some(i=>Zt(i,r))||t.push(r);return{arrayValue:{values:t}}}class gr extends no{constructor(e){super(),this.elements=e}}function Fc(n,e){let t=aa(e);for(const r of n.elements)t=t.filter(i=>!Zt(i,r));return{arrayValue:{values:t}}}class yr extends no{constructor(e,t){super(),this.It=e,this.yt=t}}function Uc(n){return Be(n.integerValue||n.doubleValue)}function aa(n){return ji(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Hr{constructor(e,t){this.field=e,this.transform=t}}class Bc{constructor(e,t){this.version=e,this.transformResults=t}}class qe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new qe}static exists(e){return new qe(void 0,e)}static updateTime(e){return new qe(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ro(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class io{}function ua(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new R(n.key,qe.none()):new a(n.key,n.data,qe.none());{const t=n.data,r=ht.empty();let i=new Ie(ke.comparator);for(let s of e.fields)if(!i.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?r.delete(s):r.set(s,u),i=i.add(s)}return new h(n.key,r,new Ht(i.toArray()),qe.none())}}function qc(n,e,t){n instanceof a?function(r,i,s){const u=r.value.clone(),l=m(r.fieldTransforms,i,s.transformResults);u.setAll(l),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof h?function(r,i,s){if(!ro(r.precondition,i))return void i.convertToUnknownDocument(s.version);const u=m(r.fieldTransforms,i,s.transformResults),l=i.data;l.setAll(p(r)),l.setAll(u),i.convertToFoundDocument(s.version,l).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Wi(n,e,t,r){return n instanceof a?function(i,s,u,l){if(!ro(i.precondition,s))return u;const d=i.value.clone(),f=E(i.fieldTransforms,l,s);return d.setAll(f),s.convertToFoundDocument(s.version,d).setHasLocalMutations(),null}(n,e,t,r):n instanceof h?function(i,s,u,l){if(!ro(i.precondition,s))return u;const d=E(i.fieldTransforms,l,s),f=s.data;return f.setAll(p(i)),f.setAll(d),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):(u=t,ro(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function c(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=oa(r.transform,i||null);null!=s&&(null===t&&(t=ht.empty()),t.set(r.field,s))}return t||null}function o(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Un(t,r,(i,s)=>function Vc(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof En&&r instanceof En||t instanceof gr&&r instanceof gr?Un(t.elements,r.elements,Zt):t instanceof yr&&r instanceof yr?Zt(t.yt,r.yt):t instanceof Wr&&r instanceof Wr);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class a extends io{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class h extends io{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function p(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function m(n,e,t){const r=new Map;re(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],u=s.transform,l=e.data.field(s.field);r.set(s.field,Mc(u,l,t[i]))}return r}function E(n,e,t){const r=new Map;for(const i of n){const s=i.transform,u=t.data.field(i.field);r.set(i.field,Lc(s,u,e))}return r}class R extends io{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class j extends io{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Y{constructor(e){this.count=e}}var Z,Q;function nn(n){switch(n){default:return z();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0}}function Tn(n){if(void 0===n)return He("GRPC error has no .code"),D.UNKNOWN;switch(n){case Z.OK:return D.OK;case Z.CANCELLED:return D.CANCELLED;case Z.UNKNOWN:return D.UNKNOWN;case Z.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case Z.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case Z.INTERNAL:return D.INTERNAL;case Z.UNAVAILABLE:return D.UNAVAILABLE;case Z.UNAUTHENTICATED:return D.UNAUTHENTICATED;case Z.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case Z.NOT_FOUND:return D.NOT_FOUND;case Z.ALREADY_EXISTS:return D.ALREADY_EXISTS;case Z.PERMISSION_DENIED:return D.PERMISSION_DENIED;case Z.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case Z.ABORTED:return D.ABORTED;case Z.OUT_OF_RANGE:return D.OUT_OF_RANGE;case Z.UNIMPLEMENTED:return D.UNIMPLEMENTED;case Z.DATA_LOSS:return D.DATA_LOSS;default:return z()}}(Q=Z||(Z={}))[Q.OK=0]="OK",Q[Q.CANCELLED=1]="CANCELLED",Q[Q.UNKNOWN=2]="UNKNOWN",Q[Q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Q[Q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Q[Q.NOT_FOUND=5]="NOT_FOUND",Q[Q.ALREADY_EXISTS=6]="ALREADY_EXISTS",Q[Q.PERMISSION_DENIED=7]="PERMISSION_DENIED",Q[Q.UNAUTHENTICATED=16]="UNAUTHENTICATED",Q[Q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Q[Q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Q[Q.ABORTED=10]="ABORTED",Q[Q.OUT_OF_RANGE=11]="OUT_OF_RANGE",Q[Q.UNIMPLEMENTED=12]="UNIMPLEMENTED",Q[Q.INTERNAL=13]="INTERNAL",Q[Q.UNAVAILABLE=14]="UNAVAILABLE",Q[Q.DATA_LOSS=15]="DATA_LOSS";class rn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){lr(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return jo(this.inner)}size(){return this.innerSize}}const gu=new We(q.comparator);function pt(){return gu}const ca=new We(q.comparator);function Zr(...n){let e=ca;for(const t of n)e=e.insert(t.key,t);return e}function so(n){let e=ca;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function sn(){return _r()}function la(){return _r()}function _r(){return new rn(n=>n.toString(),(n,e)=>n.isEqual(e))}const yu=new We(q.comparator),Gc=new Ie(q.comparator);function ue(...n){let e=Gc;for(const t of n)e=e.add(t);return e}const jc=new Ie(se);function _u(){return jc}class ha{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,da.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ha(ee.min(),i,_u(),pt(),ue())}}class da{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new da(r,t,ue(),ue(),ue())}}class vu{constructor(e,t,r,i){this.Tt=e,this.removedTargetIds=t,this.key=r,this.Et=i}}class jh{constructor(e,t){this.targetId=e,this.At=t}}class $h{constructor(e,t,r=st.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Kh{constructor(){this.Rt=0,this.bt=Wh(),this.Pt=st.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}get current(){return this.vt}get resumeToken(){return this.Pt}get St(){return 0!==this.Rt}get Dt(){return this.Vt}Ct(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}xt(){let e=ue(),t=ue(),r=ue();return this.bt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:z()}}),new da(this.Pt,this.vt,e,t,r)}Nt(){this.Vt=!1,this.bt=Wh()}kt(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}Ot(e){this.Vt=!0,this.bt=this.bt.remove(e)}Mt(){this.Rt+=1}Ft(){this.Rt-=1}$t(){this.Vt=!0,this.vt=!0}}class dp{constructor(e){this.Bt=e,this.Lt=new Map,this.Ut=pt(),this.qt=zh(),this.Kt=new Ie(se)}Gt(e){for(const t of e.Tt)e.Et&&e.Et.isFoundDocument()?this.Qt(t,e.Et):this.jt(t,e.key,e.Et);for(const t of e.removedTargetIds)this.jt(t,e.key,e.Et)}Wt(e){this.forEachTarget(e,t=>{const r=this.zt(t);switch(e.state){case 0:this.Ht(t)&&r.Ct(e.resumeToken);break;case 1:r.Ft(),r.St||r.Nt(),r.Ct(e.resumeToken);break;case 2:r.Ft(),r.St||this.removeTarget(t);break;case 3:this.Ht(t)&&(r.$t(),r.Ct(e.resumeToken));break;case 4:this.Ht(t)&&(this.Jt(t),r.Ct(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Lt.forEach((r,i)=>{this.Ht(i)&&t(i)})}Yt(e){const t=e.targetId,r=e.At.count,i=this.Xt(t);if(i){const s=i.target;if(Zo(s))if(0===r){const u=new q(s.path);this.jt(t,u,Pe.newNoDocument(u,ee.min()))}else re(1===r);else this.Zt(t)!==r&&(this.Jt(t),this.Kt=this.Kt.add(t))}}te(e){const t=new Map;this.Lt.forEach((s,u)=>{const l=this.Xt(u);if(l){if(s.current&&Zo(l.target)){const d=new q(l.target.path);null!==this.Ut.get(d)||this.ee(u,d)||this.jt(u,d,Pe.newNoDocument(d,e))}s.Dt&&(t.set(u,s.xt()),s.Nt())}});let r=ue();this.qt.forEach((s,u)=>{let l=!0;u.forEachWhile(d=>{const f=this.Xt(d);return!f||2===f.purpose||(l=!1,!1)}),l&&(r=r.add(s))}),this.Ut.forEach((s,u)=>u.setReadTime(e));const i=new ha(e,t,this.Kt,this.Ut,r);return this.Ut=pt(),this.qt=zh(),this.Kt=new Ie(se),i}Qt(e,t){if(!this.Ht(e))return;const r=this.ee(e,t.key)?2:0;this.zt(e).kt(t.key,r),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e))}jt(e,t,r){if(!this.Ht(e))return;const i=this.zt(e);this.ee(e,t)?i.kt(t,1):i.Ot(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),r&&(this.Ut=this.Ut.insert(t,r))}removeTarget(e){this.Lt.delete(e)}Zt(e){const t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Mt(e){this.zt(e).Mt()}zt(e){let t=this.Lt.get(e);return t||(t=new Kh,this.Lt.set(e,t)),t}ne(e){let t=this.qt.get(e);return t||(t=new Ie(se),this.qt=this.qt.insert(e,t)),t}Ht(e){const t=null!==this.Xt(e);return t||U("WatchChangeAggregator","Detected inactive target",e),t}Xt(e){const t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}Jt(e){this.Lt.set(e,new Kh),this.Bt.getRemoteKeysForTarget(e).forEach(t=>{this.jt(e,t,null)})}ee(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}function zh(){return new We(q.comparator)}function Wh(){return new We(q.comparator)}const fp={asc:"ASCENDING",desc:"DESCENDING"},pp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class mp{constructor(e,t){this.databaseId=e,this.gt=t}}function fa(n,e){return n.gt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Hh(n,e){return n.gt?e.toBase64():e.toUint8Array()}function gp(n,e){return fa(n,e.toTimestamp())}function mt(n){return re(!!n),ee.fromTimestamp(function(e){const t=ln(e);return new Ve(t.seconds,t.nanos)}(n))}function $c(n,e){return(t=n,new de(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Zh(n){const e=de.fromString(n);return re(rd(e)),e}function pa(n,e){return $c(n.databaseId,e.path)}function Kn(n,e){const t=Zh(e);if(t.get(1)!==n.databaseId.projectId)throw new F(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new F(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new q(Yh(t))}function Kc(n,e){return $c(n.databaseId,e)}function Qh(n){const e=Zh(n);return 4===e.length?de.emptyPath():Yh(e)}function ma(n){return new de(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Yh(n){return re(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Xh(n,e,t){return{name:pa(n,e),fields:t.value.mapValue.fields}}function Jh(n,e,t){const r=Kn(n,e.name),i=mt(e.updateTime),s=new ht({mapValue:{fields:e.fields}}),u=Pe.newFoundDocument(r,i,s);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function ga(n,e){let t;if(e instanceof a)t={update:Xh(n,e.key,e.value)};else if(e instanceof R)t={delete:pa(n,e.key)};else if(e instanceof h)t={update:Xh(n,e.key,e.data),updateMask:Sp(e.fieldMask)};else{if(!(e instanceof j))return z();t={verify:pa(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const u=s.transform;if(u instanceof Wr)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof En)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof gr)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof yr)return{fieldPath:s.field.canonicalString(),increment:u.yt};throw z()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:gp(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:z()),t;var i}function zc(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?qe.updateTime(mt(i.updateTime)):void 0!==i.exists?qe.exists(i.exists):qe.none():qe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let l=null;"setToServerValue"in u?(re("REQUEST_TIME"===u.setToServerValue),l=new Wr):"appendMissingElements"in u?l=new En(u.appendMissingElements.values||[]):"removeAllFromArray"in u?l=new gr(u.removeAllFromArray.values||[]):"increment"in u?l=new yr(s,u.increment):z();const d=ke.fromServerFormat(u.fieldPath);return new Hr(d,l)}(n,i)):[];var i;if(e.update){const i=Kn(n,e.update.name),s=new ht({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new Ht((e.updateMask.fieldPaths||[]).map(f=>ke.fromServerFormat(f)));return new h(i,s,u,t,r)}return new a(i,s,t,r)}if(e.delete){const i=Kn(n,e.delete);return new R(i,t)}if(e.verify){const i=Kn(n,e.verify);return new j(i,t)}return z()}function ed(n,e){return{documents:[Kc(n,e.path)]}}function Wc(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Kc(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Kc(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(d){if(0===d.length)return;const f=d.map(g=>function(_){if("=="===_.op){if(Qs(_.value))return{unaryFilter:{field:oo(_.field),op:"IS_NAN"}};if(ou(_.value))return{unaryFilter:{field:oo(_.field),op:"IS_NULL"}}}else if("!="===_.op){if(Qs(_.value))return{unaryFilter:{field:oo(_.field),op:"IS_NOT_NAN"}};if(ou(_.value))return{unaryFilter:{field:oo(_.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:oo(_.field),op:Ep(_.op),value:_.value}}}(g));return 1===f.length?f[0]:{compositeFilter:{op:"AND",filters:f}}}(e.filters);i&&(t.structuredQuery.where=i);const s=function(d){if(0!==d.length)return d.map(f=>{return{field:oo((g=f).field),direction:wp(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(f=e.limit,n.gt||Bi(f)?f:{value:f});var f,l,d;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(l=e.startAt).inclusive,values:l.position}),e.endAt&&(t.structuredQuery.endAt={before:!(d=e.endAt).inclusive,values:d.position}),t}function td(n){let e=Qh(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){re(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=nd(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new $r(ao((_=g).field),function(T){switch(T){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let l=null;t.limit&&(l=function(g){let _;return _="object"==typeof g?g.value:g,Bi(_)?null:_}(t.limit));let d=null;var g;t.startAt&&(d=new $n((g=t.startAt).values||[],!!g.before));let f=null;return t.endAt&&(f=function(g){return new $n(g.values||[],!g.before)}(t.endAt)),ea(e,i,u,s,l,"F",d,f)}function nd(n){return n?void 0!==n.unaryFilter?[bp(n)]:void 0!==n.fieldFilter?[Tp(n)]:void 0!==n.compositeFilter?n.compositeFilter.filters.map(e=>nd(e)).reduce((e,t)=>e.concat(t)):z():[]}function wp(n){return fp[n]}function Ep(n){return pp[n]}function oo(n){return{fieldPath:n.canonicalString()}}function ao(n){return ke.fromServerFormat(n.fieldPath)}function Tp(n){return ot.create(ao(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(n.fieldFilter.op),n.fieldFilter.value)}function bp(n){switch(n.unaryFilter.op){case"IS_NAN":const e=ao(n.unaryFilter.field);return ot.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=ao(n.unaryFilter.field);return ot.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=ao(n.unaryFilter.field);return ot.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=ao(n.unaryFilter.field);return ot.create(i,"!=",{nullValue:"NULL_VALUE"});default:return z()}}function Sp(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function rd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function Ut(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=id(e)),e=Ap(n.get(t),e);return id(e)}function Ap(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function id(n){return n+"\x01\x01"}function zn(n){const e=n.length;if(re(e>=2),2===e)return re("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),de.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&z(),n.charAt(u+1)){case"\x01":const l=n.substring(s,u);let d;0===i.length?d=l:(i+=l,d=i,i=""),r.push(d);break;case"\x10":i+=n.substring(s,u),i+="\0";break;case"\x11":i+=n.substring(s,u+1);break;default:z()}s=u+2}return new de(r)}const sd=["userId","batchId"];function Iu(n,e){return[n,Ut(e)]}function od(n,e,t){return[n,Ut(e),t]}const xp={},Dp=["prefixPath","collectionGroup","readTime","documentId"],Np=["prefixPath","collectionGroup","documentId"],kp=["collectionGroup","readTime","prefixPath","documentId"],Cp=["canonicalId","targetId"],Rp=["targetId","path"],Op=["path","targetId"],Pp=["collectionId","parent"],Lp=["indexId","uid"],Mp=["uid","sequenceNumber"],Fp=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Up=["indexId","uid","orderedDocumentKey"],Vp=["userId","collectionPath","documentId"],Bp=["userId","collectionPath","largestBatchId"],qp=["userId","collectionGroup","largestBatchId"],ad=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Gp=[...ad,"documentOverlays"],ud=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],cd=ud,jp=[...cd,"indexConfiguration","indexState","indexEntries"];class Hc extends ru{constructor(e,t){super(),this.ie=e,this.currentSequenceNumber=t}}function gt(n,e){const t=G(n);return Wt.M(t.ie,e)}class Zc{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&qc(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Wi(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Wi(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=la();return this.mutations.forEach(i=>{const s=e.get(i.key),u=s.overlayedDocument;let l=this.applyToLocalView(u,s.mutatedFields);l=t.has(i.key)?null:l;const d=ua(u,l);null!==d&&r.set(i.key,d),u.isValidDocument()||u.convertToNoDocument(ee.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ue())}isEqual(e){return this.batchId===e.batchId&&Un(this.mutations,e.mutations,(t,r)=>o(t,r))&&Un(this.baseMutations,e.baseMutations,(t,r)=>o(t,r))}}class Qc{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){re(e.mutations.length===r.length);let i=yu;const s=e.mutations;for(let u=0;u<s.length;u++)i=i.insert(s[u].key,r[u].version);return new Qc(e,t,r,i)}}class Yc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Qr{constructor(e,t,r,i,s=ee.min(),u=ee.min(),l=st.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=l}withSequenceNumber(e){return new Qr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Qr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Qr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ld{constructor(e){this.re=e}}function hd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:wu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:pa(i=n.re,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:fa(i,s.version.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Hi(e.version)};else{if(!e.isUnknownDocument())return z();r.unknownDocument={path:t.path.toArray(),version:Hi(e.version)}}var i,s;return r}function wu(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Zi(n){const e=new Ve(n.seconds,n.nanoseconds);return ee.fromTimestamp(e)}function Qi(n,e){const t=(e.baseMutations||[]).map(s=>zc(n.re,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const r=e.mutations.map(s=>zc(n.re,s)),i=Ve.fromMillis(e.localWriteTimeMs);return new Zc(e.batchId,i,t,r)}function ya(n){const e=Zi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Zi(n.lastLimboFreeSnapshotVersion):ee.min();let r;var i;return void 0!==n.query.documents?(re(1===(i=n.query).documents.length),r=bt(Kr(Qh(i.documents[0])))):r=bt(td(n.query)),new Qr(r,n.targetId,0,n.lastListenSequenceNumber,e,t,st.fromBase64String(n.resumeToken))}function dd(n,e){const t=Hi(e.snapshotVersion),r=Hi(e.lastLimboFreeSnapshotVersion);let i;i=Zo(e.target)?ed(n.re,e.target):Wc(n.re,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Xc(n){const e=td({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?to(e,e.limit,"L"):e}function Jc(n,e){return new Yc(e.largestBatchId,zc(n.re,e.overlayMutation))}function fd(n,e){const t=e.path.lastSegment();return[n,Ut(e.path.popLast()),t]}function pd(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Hi(r.readTime),documentKey:Ut(r.documentKey.path),largestBatchId:r.largestBatchId}}class Kp{getBundleMetadata(e,t){return md(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Zi(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return md(e).put({bundleId:(r=t).id,createTime:Hi(mt(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return gd(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:Xc(i.bundledQuery),readTime:Zi(i.readTime)};var i})}saveNamedQuery(e,t){return gd(e).put({name:(r=t).name,readTime:Hi(mt(r.readTime)),bundledQuery:r.bundledQuery});var r}}function md(n){return gt(n,"bundles")}function gd(n){return gt(n,"namedQueries")}class Eu{constructor(e,t){this.It=e,this.userId=t}static oe(e,t){return new Eu(e,t.uid||"")}getOverlay(e,t){return _a(e).get(fd(this.userId,t)).next(r=>r?Jc(this.It,r):null)}getOverlays(e,t){const r=sn();return A.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,u)=>{const l=new Yc(t,u);i.push(this.ue(e,l))}),A.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(Ut(u.getCollectionPath())));const s=[];return i.forEach(u=>{const l=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);s.push(_a(e).Y("collectionPathOverlayIndex",l))}),A.waitFor(s)}getOverlaysForCollection(e,t,r){const i=sn(),s=Ut(t),u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return _a(e).W("collectionPathOverlayIndex",u).next(l=>{for(const d of l){const f=Jc(this.It,d);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=sn();let u;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return _a(e).Z({index:"collectionGroupOverlayIndex",range:l},(d,f,g)=>{const _=Jc(this.It,f);s.size()<i||_.largestBatchId===u?(s.set(_.getKey(),_),u=_.largestBatchId):g.done()}).next(()=>s)}ue(e,t){return _a(e).put(function(r,i,s){const[u,l,d]=fd(i,s.mutation.key);return{userId:i,collectionPath:l,documentId:d,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:ga(r.re,s.mutation)}}(this.It,this.userId,t))}}function _a(n){return gt(n,"documentOverlays")}class Yi{constructor(){}ce(e,t){this.ae(e,t),t.he()}ae(e,t){if("nullValue"in e)this.le(t,5);else if("booleanValue"in e)this.le(t,10),t.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(t,15),t.fe(Be(e.integerValue));else if("doubleValue"in e){const r=Be(e.doubleValue);isNaN(r)?this.le(t,13):(this.le(t,15),qi(r)?t.fe(0):t.fe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.le(t,20),"string"==typeof r?t.de(r):(t.de(`${r.seconds||""}`),t.fe(r.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,t),this.we(t);else if("bytesValue"in e)this.le(t,30),t.me(Br(e.bytesValue)),this.we(t);else if("referenceValue"in e)this.ge(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.le(t,45),t.fe(r.latitude||0),t.fe(r.longitude||0)}else"mapValue"in e?bc(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):z()}_e(e,t){this.le(t,25),this.Ie(e,t)}Ie(e,t){t.de(e)}ye(e,t){const r=e.fields||{};this.le(t,55);for(const i of Object.keys(r))this._e(i,t),this.ae(r[i],t)}pe(e,t){const r=e.values||[];this.le(t,50);for(const i of r)this.ae(i,t)}ge(e,t){this.le(t,37),q.fromName(e).path.forEach(r=>{this.le(t,60),this.Ie(r,t)})}le(e,t){e.fe(t)}we(e){e.fe(2)}}function zp(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function yd(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=zp(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Yi.Te=new Yi;class Wp{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ee(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ae(r.value),r=t.next();this.Re()}be(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Pe(r.value),r=t.next();this.ve()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ae(r);else if(r<2048)this.Ae(960|r>>>6),this.Ae(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ae(480|r>>>12),this.Ae(128|63&r>>>6),this.Ae(128|63&r);else{const i=t.codePointAt(0);this.Ae(240|i>>>18),this.Ae(128|63&i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i)}}this.Re()}Se(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Pe(r);else if(r<2048)this.Pe(960|r>>>6),this.Pe(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Pe(480|r>>>12),this.Pe(128|63&r>>>6),this.Pe(128|63&r);else{const i=t.codePointAt(0);this.Pe(240|i>>>18),this.Pe(128|63&i>>>12),this.Pe(128|63&i>>>6),this.Pe(128|63&i)}}this.ve()}De(e){const t=this.Ce(e),r=yd(t);this.xe(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Ne(e){const t=this.Ce(e),r=yd(t);this.xe(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}ke(){this.Oe(255),this.Oe(255)}Me(){this.Fe(255),this.Fe(255)}reset(){this.position=0}seed(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}$e(){return this.buffer.slice(0,this.position)}Ce(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ae(e){const t=255&e;0===t?(this.Oe(0),this.Oe(255)):255===t?(this.Oe(255),this.Oe(0)):this.Oe(t)}Pe(e){const t=255&e;0===t?(this.Fe(0),this.Fe(255)):255===t?(this.Fe(255),this.Fe(0)):this.Fe(e)}Re(){this.Oe(0),this.Oe(1)}ve(){this.Fe(0),this.Fe(1)}Oe(e){this.xe(1),this.buffer[this.position++]=e}Fe(e){this.xe(1),this.buffer[this.position++]=~e}xe(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class Hp{constructor(e){this.Be=e}me(e){this.Be.Ee(e)}de(e){this.Be.Ve(e)}fe(e){this.Be.De(e)}he(){this.Be.ke()}}class Zp{constructor(e){this.Be=e}me(e){this.Be.be(e)}de(e){this.Be.Se(e)}fe(e){this.Be.Ne(e)}he(){this.Be.Me()}}class va{constructor(){this.Be=new Wp,this.Le=new Hp(this.Be),this.Ue=new Zp(this.Be)}seed(e){this.Be.seed(e)}qe(e){return 0===e?this.Le:this.Ue}$e(){return this.Be.$e()}reset(){this.Be.reset()}}class Xi{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Xi(this.indexId,this.documentKey,this.arrayValue,r)}}function Ji(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=_d(n.arrayValue,e.arrayValue),0!==t?t:(t=_d(n.directionalValue,e.directionalValue),0!==t?t:q.comparator(n.documentKey,e.documentKey)))}function _d(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class Qp{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ge=e.orderBy,this.Qe=[];for(const t of e.filters){const r=t;r.dt()?this.je=r:this.Qe.push(r)}}We(e){const t=Pi(e);if(void 0!==t&&!this.ze(t))return!1;const r=Vn(e);let i=0,s=0;for(;i<r.length&&this.ze(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.je){const u=r[i];if(!this.He(this.je,u)||!this.Je(this.Ge[s++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(s>=this.Ge.length||!this.Je(this.Ge[s++],u))return!1}return!0}ze(e){for(const t of this.Qe)if(this.He(t,e))return!0;return!1}He(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}Je(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class Yp{constructor(){this.Ye=new el}addToCollectionParentIndex(e,t){return this.Ye.add(t),A.resolve()}getCollectionParents(e,t){return A.resolve(this.Ye.getEntries(t))}addFieldIndex(e,t){return A.resolve()}deleteFieldIndex(e,t){return A.resolve()}getDocumentsMatchingTarget(e,t){return A.resolve(null)}getIndexType(e,t){return A.resolve(0)}getFieldIndexes(e,t){return A.resolve([])}getNextCollectionGroupToUpdate(e){return A.resolve(null)}getMinOffset(e,t){return A.resolve(zt.min())}getMinOffsetFromCollectionGroup(e,t){return A.resolve(zt.min())}updateCollectionGroup(e,t,r){return A.resolve()}updateIndexEntries(e,t){return A.resolve()}}class el{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Ie(de.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Ie(de.comparator)).toArray()}}const Tu=new Uint8Array(0);class Xp{constructor(e,t){this.user=e,this.databaseId=t,this.Xe=new el,this.Ze=new rn(r=>Gr(r),(r,i)=>mr(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Xe.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Xe.add(t)});const s={collectionId:r,parent:Ut(i)};return vd(e).put(s)}return A.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Xa(t),""],!1,!0);return vd(e).W(i).next(s=>{for(const u of s){if(u.collectionId!==t)break;r.push(zn(u.parent))}return r})}addFieldIndex(e,t){const r=bu(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])};var u;delete i.indexId;const s=r.add(i);if(t.indexState){const u=wa(e);return s.next(l=>{u.put(pd(l,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=bu(e),i=wa(e),s=Ia(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=Ia(e);let i=!0;const s=new Map;return A.forEach(this.tn(t),u=>this.en(e,u).next(l=>{i&&(i=!!l),s.set(u,l)})).next(()=>{if(i){let u=ue();const l=[];return A.forEach(s,(d,f)=>{var g;U("IndexedDbIndexManager",`Using index ${g=d,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(Ne=>`${Ne.fieldPath}:${Ne.kind}`).join(",")}`} to execute ${Gr(t)}`);const _=function(Ne,_t){const Le=Pi(_t);if(void 0===Le)return null;for(const De of jr(Ne,Le.fieldPath))switch(De.op){case"array-contains-any":return De.value.arrayValue.values||[];case"array-contains":return[De.value]}return null}(f,d),T=function(Ne,_t){const Le=new Map;for(const De of Vn(_t))for(const St of jr(Ne,De.fieldPath))switch(St.op){case"==":case"in":Le.set(De.fieldPath.canonicalString(),St.value);break;case"not-in":case"!=":return Le.set(De.fieldPath.canonicalString(),St.value),Array.from(Le.values())}return null}(f,d),C=function(Ne,_t){const Le=[];let De=!0;for(const St of Vn(_t)){const Ma=0===St.kind?Qo(Ne,St.fieldPath,Ne.startAt):Js(Ne,St.fieldPath,Ne.startAt);Le.push(Ma.value),De&&(De=Ma.inclusive)}return new $n(Le,De)}(f,d),P=function(Ne,_t){const Le=[];let De=!0;for(const St of Vn(_t)){const Ma=0===St.kind?Js(Ne,St.fieldPath,Ne.endAt):Qo(Ne,St.fieldPath,Ne.endAt);Le.push(Ma.value),De&&(De=Ma.inclusive)}return new $n(Le,De)}(f,d),$=this.nn(d,f,C),H=this.nn(d,f,P),be=this.sn(d,f,T),Ge=this.rn(d.indexId,_,$,C.inclusive,H,P.inclusive,be);return A.forEach(Ge,Ne=>r.J(Ne,t.limit).next(_t=>{_t.forEach(Le=>{const De=q.fromSegments(Le.documentKey);u.has(De)||(u=u.add(De),l.push(De))})}))}).next(()=>l)}return A.resolve(null)})}tn(e){let t=this.Ze.get(e);return t||(t=[e],this.Ze.set(e,t),t)}rn(e,t,r,i,s,u,l){const d=(null!=t?t.length:1)*Math.max(r.length,s.length),f=d/(null!=t?t.length:1),g=[];for(let _=0;_<d;++_){const T=t?this.on(t[_/f]):Tu,C=this.un(e,T,r[_%f],i),P=this.cn(e,T,s[_%f],u),$=l.map(H=>this.un(e,T,H,!0));g.push(...this.createRange(C,P,$))}return g}un(e,t,r,i){const s=new Xi(e,q.empty(),t,r);return i?s:s.Ke()}cn(e,t,r,i){const s=new Xi(e,q.empty(),t,r);return i?s.Ke():s}en(e,t){const r=new Qp(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let u=null;for(const l of s)r.We(l)&&(!u||l.fields.length>u.fields.length)&&(u=l);return u})}getIndexType(e,t){let r=2;return A.forEach(this.tn(t),i=>this.en(e,i).next(s=>{s?0!==r&&s.fields.length<function(u){let l=new Ie(ke.comparator),d=!1;for(const f of u.filters){const g=f;g.field.isKeyField()||("array-contains"===g.op||"array-contains-any"===g.op?d=!0:l=l.add(g.field))}for(const f of u.orderBy)f.field.isKeyField()||(l=l.add(f.field));return l.size+(d?1:0)}(i)&&(r=1):r=0})).next(()=>r)}an(e,t){const r=new va;for(const i of Vn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const u=r.qe(i.kind);Yi.Te.ce(s,u)}return r.$e()}on(e){const t=new va;return Yi.Te.ce(e,t.qe(0)),t.$e()}hn(e,t){const r=new va;return Yi.Te.ce(dr(this.databaseId,t),r.qe(function(i){const s=Vn(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.$e()}sn(e,t,r){if(null===r)return[];let i=[];i.push(new va);let s=0;for(const u of Vn(e)){const l=r[s++];for(const d of i)if(this.ln(t,u.fieldPath)&&ji(l))i=this.fn(i,u,l);else{const f=d.qe(u.kind);Yi.Te.ce(l,f)}}return this.dn(i)}nn(e,t,r){return this.sn(e,t,r.position)}dn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].$e();return t}fn(e,t,r){const i=[...e],s=[];for(const u of r.arrayValue.values||[])for(const l of i){const d=new va;d.seed(l.$e()),Yi.Te.ce(u,d.qe(t.kind)),s.push(d)}return s}ln(e,t){return!!e.filters.find(r=>r instanceof ot&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=bu(e),i=wa(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const u=[];return A.forEach(s,l=>i.get([l.indexId,this.uid]).next(d=>{u.push(function(f,g){const _=g?new Vr(g.sequenceNumber,new zt(Zi(g.readTime),new q(zn(g.documentKey)),g.largestBatchId)):Vr.empty(),T=f.fields.map(([C,P])=>new zs(ke.fromServerFormat(C),P));return new Ks(f.indexId,f.collectionGroup,T,_)}(l,d))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:se(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=bu(e),s=wa(e);return this._n(e).next(u=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>A.forEach(l,d=>s.put(pd(d.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return A.forEach(t,(i,s)=>{const u=r.get(i.collectionGroup);return(u?A.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),A.forEach(l,d=>this.wn(e,i,d).next(f=>{const g=this.mn(s,d);return f.isEqual(g)?A.resolve():this.gn(e,s,d,f,g)}))))})}yn(e,t,r,i){return Ia(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.hn(r,t.key),documentKey:t.key.path.toArray()})}pn(e,t,r,i){return Ia(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.hn(r,t.key),t.key.path.toArray()])}wn(e,t,r){const i=Ia(e);let s=new Ie(Ji);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.hn(r,t)])},(u,l)=>{s=s.add(new Xi(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}mn(e,t){let r=new Ie(Ji);const i=this.an(t,e);if(null==i)return r;const s=Pi(t);if(null!=s){const u=e.data.field(s.fieldPath);if(ji(u))for(const l of u.arrayValue.values||[])r=r.add(new Xi(t.indexId,e.key,this.on(l),i))}else r=r.add(new Xi(t.indexId,e.key,Tu,i));return r}gn(e,t,r,i,s){U("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(l,d,f,g,_){const T=l.getIterator(),C=d.getIterator();let P=qn(T),$=qn(C);for(;P||$;){let H=!1,be=!1;if(P&&$){const Ge=f(P,$);Ge<0?be=!0:Ge>0&&(H=!0)}else null!=P?be=!0:H=!0;H?(g($),$=qn(C)):be?(_(P),P=qn(T)):(P=qn(T),$=qn(C))}}(i,s,Ji,l=>{u.push(this.yn(e,t,r,l))},l=>{u.push(this.pn(e,t,r,l))}),A.waitFor(u)}_n(e){let t=1;return wa(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,l)=>Ji(u,l)).filter((u,l,d)=>!l||0!==Ji(u,d[l-1]));const i=[];i.push(e);for(const u of r){const l=Ji(u,e),d=Ji(u,t);if(0===l)i[0]=e.Ke();else if(l>0&&d<0)i.push(u),i.push(u.Ke());else if(d>0)break}i.push(t);const s=[];for(let u=0;u<i.length;u+=2)s.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,Tu,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,Tu,[]]));return s}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Id)}getMinOffset(e,t){return A.mapArray(this.tn(t),r=>this.en(e,r).next(i=>i||z())).next(Id)}}function vd(n){return gt(n,"collectionParents")}function Ia(n){return gt(n,"indexEntries")}function bu(n){return gt(n,"indexConfiguration")}function wa(n){return gt(n,"indexState")}function Id(n){re(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Go(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new zt(e.readTime,e.documentKey,t)}const wd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Qt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Qt(e,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ed(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let l=0;const d=r.Z({range:u},(g,_,T)=>(l++,T.delete()));s.push(d.next(()=>{re(1===l)}));const f=[];for(const g of t.mutations){const _=od(e,g.key.path,t.batchId);s.push(i.delete(_)),f.push(g.key)}return A.waitFor(s).next(()=>f)}function Su(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw z();e=n.noDocument}return JSON.stringify(e).length}Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(41943040,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);class Au{constructor(e,t,r,i){this.userId=e,this.It=t,this.indexManager=r,this.referenceDelegate=i,this.In={}}static oe(e,t,r,i){re(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Au(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Yr(e).Z({index:"userMutationsIndex",range:r},(i,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=uo(e),u=Yr(e);return u.add({}).next(l=>{re("number"==typeof l);const d=new Zc(l,t,r,i),f=function(T,C,P){const $=P.baseMutations.map(be=>ga(T.re,be)),H=P.mutations.map(be=>ga(T.re,be));return{userId:C,batchId:P.batchId,localWriteTimeMs:P.localWriteTime.toMillis(),baseMutations:$,mutations:H}}(this.It,this.userId,d),g=[];let _=new Ie((T,C)=>se(T.canonicalString(),C.canonicalString()));for(const T of i){const C=od(this.userId,T.key.path,l);_=_.add(T.key.path.popLast()),g.push(u.put(f)),g.push(s.put(C,xp))}return _.forEach(T=>{g.push(this.indexManager.addToCollectionParentIndex(e,T))}),e.addOnCommittedListener(()=>{this.In[l]=d.keys()}),A.waitFor(g).next(()=>d)})}lookupMutationBatch(e,t){return Yr(e).get(t).next(r=>r?(re(r.userId===this.userId),Qi(this.It,r)):null)}Tn(e,t){return this.In[t]?A.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.In[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Yr(e).Z({index:"userMutationsIndex",range:i},(u,l,d)=>{l.userId===this.userId&&(re(l.batchId>=r),s=Qi(this.It,l)),d.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Yr(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,s,u)=>{r=s.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Yr(e).W("userMutationsIndex",t).next(r=>r.map(i=>Qi(this.It,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Iu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return uo(e).Z({range:i},(u,l,d)=>{const[f,g,_]=u,T=zn(g);if(f===this.userId&&t.path.isEqual(T))return Yr(e).get(_).next(C=>{if(!C)throw z();re(C.userId===this.userId),s.push(Qi(this.It,C))});d.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ie(se);const i=[];return t.forEach(s=>{const u=Iu(this.userId,s.path),l=IDBKeyRange.lowerBound(u),d=uo(e).Z({range:l},(f,g,_)=>{const[T,C,P]=f,$=zn(C);T===this.userId&&s.path.isEqual($)?r=r.add(P):_.done()});i.push(d)}),A.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Iu(this.userId,r),u=IDBKeyRange.lowerBound(s);let l=new Ie(se);return uo(e).Z({range:u},(d,f,g)=>{const[_,T,C]=d,P=zn(T);_===this.userId&&r.isPrefixOf(P)?P.length===i&&(l=l.add(C)):g.done()}).next(()=>this.En(e,l))}En(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Yr(e).get(s).next(u=>{if(null===u)throw z();re(u.userId===this.userId),r.push(Qi(this.It,u))}))}),A.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Ed(e.ie,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),A.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return A.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return uo(e).Z({range:r},(s,u,l)=>{if(s[0]===this.userId){const d=zn(s[1]);i.push(d)}else l.done()}).next(()=>{re(0===i.length)})})}containsKey(e,t){return Td(e,this.userId,t)}Rn(e){return bd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Td(n,e,t){const r=Iu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let u=!1;return uo(n).Z({range:s,X:!0},(l,d,f)=>{const[g,_,T]=l;g===e&&_===i&&(u=!0),f.done()}).next(()=>u)}function Yr(n){return gt(n,"mutations")}function uo(n){return gt(n,"documentMutations")}function bd(n){return gt(n,"mutationQueues")}class es{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new es(0)}static vn(){return new es(-1)}}class Jp{constructor(e,t){this.referenceDelegate=e,this.It=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new es(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>ee.fromTimestamp(new Ve(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Sn(e,i)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>co(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(re(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return co(e).Z((u,l)=>{const d=ya(l);d.sequenceNumber<=t&&null===r.get(d.targetId)&&(i++,s.push(this.removeTargetData(e,d)))}).next(()=>A.waitFor(s)).next(()=>i)}forEachTarget(e,t){return co(e).Z((r,i)=>{const s=ya(i);t(s)})}Vn(e){return Sd(e).get("targetGlobalKey").next(t=>(re(null!==t),t))}Sn(e,t){return Sd(e).put("targetGlobalKey",t)}Dn(e,t){return co(e).put(dd(this.It,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Gr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return co(e).Z({range:i,index:"queryTargetsIndex"},(u,l,d)=>{const f=ya(l);mr(t,f.target)&&(s=f,d.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Xr(e);return t.forEach(u=>{const l=Ut(u.path);i.push(s.put({targetId:r,path:l})),i.push(this.referenceDelegate.addReference(e,r,u))}),A.waitFor(i)}removeMatchingKeys(e,t,r){const i=Xr(e);return A.forEach(t,s=>{const u=Ut(s.path);return A.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Xr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Xr(e);let s=ue();return i.Z({range:r,X:!0},(u,l,d)=>{const f=zn(u[1]),g=new q(f);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=Ut(t.path),i=IDBKeyRange.bound([r],[Xa(r)],!1,!0);let s=0;return Xr(e).Z({index:"documentTargetsIndex",X:!0,range:i},([u,l],d,f)=>{0!==u&&(s++,f.done())}).next(()=>s>0)}se(e,t){return co(e).get(t).next(r=>r?ya(r):null)}}function co(n){return gt(n,"targets")}function Sd(n){return gt(n,"targetGlobal")}function Xr(n){return gt(n,"targetDocuments")}function Ad([n,e],[t,r]){const i=se(n,t);return 0===i?se(e,r):i}class em{constructor(e){this.xn=e,this.buffer=new Ie(Ad),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ad(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class tm{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;U("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,I.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){en(r)?U("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Bn(r)}yield t.Fn(3e5)}))}}class nm{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return A.resolve(Ot.at);const r=new em(t);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector","Garbage collection skipped; disabled"),A.resolve(wd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(U("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wd):this.Un(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}Un(e,t){let r,i,s,u,l,d,f;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(U("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,u=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,l=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,d=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(f=Date.now(),ki()<=Ce.in.DEBUG&&U("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${i} in `+(l-u)+`ms\n\tRemoved ${s} targets in `+(d-l)+`ms\n\tRemoved ${_} documents in `+(f-d)+`ms\nTotal Duration: ${f-g}ms`),A.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}class rm{constructor(e,t){this.db=e,this.garbageCollector=new nm(this,t)}Bn(e){const t=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}qn(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,i)=>t(i))}addReference(e,t,r){return xu(e,r)}removeReference(e,t,r){return xu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return xu(e,t)}Gn(e,t){return function(r,i){let s=!1;return bd(r).tt(u=>Td(r,u,i).next(l=>(l&&(s=!0),A.resolve(!l)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Kn(e,(u,l)=>{if(l<=t){const d=this.Gn(e,u).next(f=>{if(!f)return s++,r.getEntry(e,u).next(()=>(r.removeEntry(u,ee.min()),Xr(e).delete([0,Ut(u.path)])))});i.push(d)}}).next(()=>A.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return xu(e,t)}Kn(e,t){const r=Xr(e);let i,s=Ot.at;return r.Z({index:"documentTargetsIndex"},([u,l],{path:d,sequenceNumber:f})=>{0===u?(s!==Ot.at&&t(new q(zn(i)),s),s=f,i=d):s=Ot.at}).next(()=>{s!==Ot.at&&t(new q(zn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function xu(n,e){return Xr(n).put((r=n.currentSequenceNumber,{targetId:0,path:Ut(e.path),sequenceNumber:r}));var r}class xd{constructor(){this.changes=new rn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Pe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?A.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class im{constructor(e){this.It=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ts(e).put(r)}removeEntry(e,t,r){return ts(e).delete(function(i,s){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],wu(s),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=Pe.newInvalidDocument(t);return ts(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ea(t))},(i,s)=>{r=this.jn(t,s)}).next(()=>r)}Wn(e,t){let r={size:0,document:Pe.newInvalidDocument(t)};return ts(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Ea(t))},(i,s)=>{r={document:this.jn(t,s),size:Su(s)}}).next(()=>r)}getEntries(e,t){let r=pt();return this.zn(e,t,(i,s)=>{const u=this.jn(i,s);r=r.insert(i,u)}).next(()=>r)}Hn(e,t){let r=pt(),i=new We(q.comparator);return this.zn(e,t,(s,u)=>{const l=this.jn(s,u);r=r.insert(s,l),i=i.insert(s,Su(u))}).next(()=>({documents:r,Jn:i}))}zn(e,t,r){if(t.isEmpty())return A.resolve();let i=new Ie(Cd);t.forEach(d=>i=i.add(d));const s=IDBKeyRange.bound(Ea(i.first()),Ea(i.last())),u=i.getIterator();let l=u.getNext();return ts(e).Z({index:"documentKeyIndex",range:s},(d,f,g)=>{const _=q.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;l&&Cd(l,_)<0;)r(l,null),l=u.getNext();l&&l.isEqual(_)&&(r(l,f),l=u.hasNext()?u.getNext():null),l?g.j(Ea(l)):g.done()}).next(()=>{for(;l;)r(l,null),l=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,r){const i=[t.popLast().toArray(),t.lastSegment(),wu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ts(e).W(IDBKeyRange.bound(i,s,!0)).next(u=>{let l=pt();for(const d of u){const f=this.jn(q.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);l=l.insert(f.key,f)}return l})}getAllFromCollectionGroup(e,t,r,i){let s=pt();const u=kd(t,r),l=kd(t,zt.max());return ts(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,l,!0)},(d,f,g)=>{const _=this.jn(q.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(_.key,_),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new sm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Nd(e).get("remoteDocumentGlobalKey").next(t=>(re(!!t),t))}Qn(e,t){return Nd(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function $p(n,e){let t;if(e.document)t=Jh(n.re,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=q.fromSegments(e.noDocument.path),i=Zi(e.noDocument.readTime);t=Pe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return z();{const r=q.fromSegments(e.unknownDocument.path),i=Zi(e.unknownDocument.version);t=Pe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new Ve(r[0],r[1]);return ee.fromTimestamp(i)}(e.readTime)),t}(this.It,t);if(!r.isNoDocument()||!r.version.isEqual(ee.min()))return r}return Pe.newInvalidDocument(e)}}function Dd(n){return new im(n)}class sm extends xd{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new rn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Ie((s,u)=>se(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const l=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,l.readTime)),u.isValidDocument()){const d=hd(this.Yn.It,u);i=i.add(s.path.popLast()),r+=Su(d)-l.size,t.push(this.Yn.addEntry(e,s,d))}else if(r-=l.size,this.trackRemovals){const d=hd(this.Yn.It,u.convertToNoDocument(ee.min()));t.push(this.Yn.addEntry(e,s,d))}}),i.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,r)),A.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:i})=>(i.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:r.get(s).readTime})}),r))}}function Nd(n){return gt(n,"remoteDocumentGlobal")}function ts(n){return gt(n,"remoteDocumentsV14")}function Ea(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function kd(n,e){const t=e.documentKey.path.toArray();return[n,wu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Cd(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=se(t[s],r[s]),i)return i;return i=se(t.length,r.length),i||(i=se(t[t.length-2],r[r.length-2]),i||se(t[t.length-1],r[r.length-1]))}class om{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Rd{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.getBaseDocument(e,t,r))).next(i=>(null!==r&&Wi(r.mutation,i,Ht.empty(),Ve.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,ue()).next(()=>r))}getLocalViewOfDocuments(e,t,r=ue()){const i=sn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let u=Zr();return s.forEach((l,d)=>{u=u.insert(l,d.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=sn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,ue()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((u,l)=>{t.set(u,l)})})}computeViews(e,t,r,i){let s=pt();const u=_r(),l=_r();return t.forEach((d,f)=>{const g=r.get(f.key);i.has(f.key)&&(void 0===g||g.mutation instanceof h)?s=s.insert(f.key,f):void 0!==g&&(u.set(f.key,g.mutation.getFieldMask()),Wi(g.mutation,f,g.mutation.getFieldMask(),Ve.now()))}),this.recalculateAndSaveOverlays(e,s).next(d=>(d.forEach((f,g)=>u.set(f,g)),t.forEach((f,g)=>{var _;return l.set(f,new om(g,null!==(_=u.get(f))&&void 0!==_?_:null))}),l))}recalculateAndSaveOverlays(e,t){const r=_r();let i=new We((u,l)=>u-l),s=ue();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const l of u)l.keys().forEach(d=>{const f=t.get(d);if(null===f)return;let g=r.get(d)||Ht.empty();g=l.applyToLocalView(f,g),r.set(d,g);const _=(i.get(l.batchId)||ue()).add(d);i=i.insert(l.batchId,_)})}).next(()=>{const u=[],l=i.getReverseIterator();for(;l.hasNext();){const d=l.getNext(),f=d.key,g=d.value,_=la();g.forEach(T=>{if(!s.has(T)){const C=ua(t.get(T),r.get(T));null!==C&&_.set(T,C),s=s.add(T)}}),u.push(this.documentOverlayCache.saveOverlays(e,f,_))}return A.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return q.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ra(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const u=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):A.resolve(sn());let l=-1,d=s;return u.next(f=>A.forEach(f,(g,_)=>(l<_.largestBatchId&&(l=_.largestBatchId),s.get(g)?A.resolve():this.getBaseDocument(e,g,_).next(T=>{d=d.insert(g,T)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,d,f,ue())).next(g=>({batchId:l,changes:so(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new q(t)).next(r=>{let i=Zr();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=Zr();return this.indexManager.getCollectionParents(e,i).next(u=>A.forEach(u,l=>{const d=(f=t,g=l.child(i),new wn(g,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt));var f,g;return this.getDocumentsMatchingCollectionQuery(e,d,r).next(f=>{f.forEach((g,_)=>{s=s.insert(g,_)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(s=>{s.forEach((l,d)=>{const f=d.getKey();null===i.get(f)&&(i=i.insert(f,Pe.newInvalidDocument(f)))});let u=Zr();return i.forEach((l,d)=>{const f=s.get(l);void 0!==f&&Wi(f.mutation,d,Ht.empty(),Ve.now()),ia(t,d)&&(u=u.insert(l,d))}),u})}getBaseDocument(e,t,r){return null===r||1===r.mutation.type?this.remoteDocumentCache.getEntry(e,t):A.resolve(Pe.newInvalidDocument(t))}}class am{constructor(e){this.It=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return A.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:mt(r.createTime)}),A.resolve()}getNamedQuery(e,t){return A.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:Xc(r.bundledQuery),readTime:mt(r.readTime)}),A.resolve();var r}}class um{constructor(){this.overlays=new We(q.comparator),this.es=new Map}getOverlay(e,t){return A.resolve(this.overlays.get(t))}getOverlays(e,t){const r=sn();return A.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ue(e,t,s)}),A.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.es.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(r)),A.resolve()}getOverlaysForCollection(e,t,r){const i=sn(),s=t.length+1,u=new q(t.child("")),l=this.overlays.getIteratorFrom(u);for(;l.hasNext();){const d=l.getNext().value,f=d.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&d.largestBatchId>r&&i.set(d.getKey(),d)}return A.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new We((f,g)=>f-g);const u=this.overlays.getIterator();for(;u.hasNext();){const f=u.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let g=s.get(f.largestBatchId);null===g&&(g=sn(),s=s.insert(f.largestBatchId,g)),g.set(f.getKey(),f)}}const l=sn(),d=s.getIterator();for(;d.hasNext()&&(d.getNext().value.forEach((f,g)=>l.set(f,g)),!(l.size()>=i)););return A.resolve(l)}ue(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new Yc(t,r));let s=this.es.get(t);void 0===s&&(s=ue(),this.es.set(t,s)),this.es.set(t,s.add(r.key))}}class tl{constructor(){this.ns=new Ie(yt.ss),this.rs=new Ie(yt.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new yt(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new yt(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new q(new de([])),r=new yt(t,e),i=new yt(t,e+1),s=[];return this.rs.forEachInRange([r,i],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new q(new de([])),r=new yt(t,e),i=new yt(t,e+1);let s=ue();return this.rs.forEachInRange([r,i],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new yt(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class yt{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return q.comparator(e.key,t.key)||se(e._s,t._s)}static os(e,t){return se(e._s,t._s)||q.comparator(e.key,t.key)}}class cm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new Ie(yt.ss)}checkEmpty(e){return A.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.ws;this.ws++;const u=new Zc(s,t,r,i);this.mutationQueue.push(u);for(const l of i)this.gs=this.gs.add(new yt(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return A.resolve(u)}lookupMutationBatch(e,t){return A.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ps(t+1),s=i<0?0:i;return A.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return A.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return A.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new yt(t,0),i=new yt(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([r,i],u=>{const l=this.ys(u._s);s.push(l)}),A.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Ie(se);return t.forEach(i=>{const s=new yt(i,0),u=new yt(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],l=>{r=r.add(l._s)})}),A.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;q.isDocumentKey(s)||(s=s.child(""));const u=new yt(new q(s),0);let l=new Ie(se);return this.gs.forEachWhile(d=>{const f=d.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(d._s)),!0)},u),A.resolve(this.Is(l))}Is(e){const t=[];return e.forEach(r=>{const i=this.ys(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){re(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return A.forEach(t.mutations,i=>{const s=new yt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new yt(t,0),i=this.gs.firstAfterOrEqual(r);return A.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return A.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class lm{constructor(e){this.Es=e,this.docs=new We(q.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,u=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return A.resolve(r?r.document.mutableCopy():Pe.newInvalidDocument(t))}getEntries(e,t){let r=pt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Pe.newInvalidDocument(i))}),A.resolve(r)}getAllFromCollection(e,t,r){let i=pt();const s=new q(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:l,value:{document:d}}=u.getNext();if(!t.isPrefixOf(l.path))break;l.path.length>t.length+1||Go(tu(d),r)<=0||(i=i.insert(d.key,d.mutableCopy()))}return A.resolve(i)}getAllFromCollectionGroup(e,t,r,i){z()}As(e,t){return A.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new hm(this)}getSize(e){return A.resolve(this.size)}}class hm extends xd{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),A.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class dm{constructor(e){this.persistence=e,this.Rs=new rn(t=>Gr(t),mr),this.lastRemoteSnapshotVersion=ee.min(),this.highestTargetId=0,this.bs=0,this.Ps=new tl,this.targetCount=0,this.vs=es.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,i)=>t(i)),A.resolve()}getLastRemoteSnapshotVersion(e){return A.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return A.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),A.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),A.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new es(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,A.resolve()}updateTargetData(e,t){return this.Dn(t),A.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,A.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Rs.forEach((u,l)=>{l.sequenceNumber<=t&&null===r.get(l.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),A.waitFor(s).next(()=>i)}getTargetCount(e){return A.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return A.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),A.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(u=>{s.push(i.markPotentiallyOrphaned(e,u))}),A.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),A.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return A.resolve(r)}containsKey(e,t){return A.resolve(this.Ps.containsKey(t))}}class Od{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new Ot(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new dm(this),this.indexManager=new Yp,this.remoteDocumentCache=new lm(r=>this.referenceDelegate.xs(r)),this.It=new ld(t),this.Ns=new am(this.It)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new um,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new cm(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){U("MemoryPersistence","Starting transaction:",e);const i=new fm(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(s=>this.referenceDelegate.Os(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ms(e,t){return A.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class fm extends ru{constructor(e){super(),this.currentSequenceNumber=e}}class Du{constructor(e){this.persistence=e,this.Fs=new tl,this.$s=null}static Bs(e){return new Du(e)}get Ls(){if(this.$s)return this.$s;throw z()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),A.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),A.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),A.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ls.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return A.forEach(this.Ls,r=>{const i=q.fromPath(r);return this.Us(e,i).next(s=>{s||t.removeEntry(i,ee.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.Us(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}Us(e,t){return A.or([()=>A.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class pm{constructor(e){this.It=e}$(e,t,r,i){const s=new Mi("createOrUpgrade",t);var l;r<1&&i>=1&&(e.createObjectStore("owner"),(l=e).createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sd,{unique:!0}),l.createObjectStore("documentMutations"),Pd(e),function(l){l.createObjectStore("remoteDocuments")}(e));let u=A.resolve();return r<3&&i>=3&&(0!==r&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(e),Pd(e)),u=u.next(()=>function(l){const d=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ee.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(l,d){return d.store("mutations").W().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",sd,{unique:!0});const g=d.store("mutations"),_=f.map(T=>g.put(T));return A.waitFor(_)})}(e,s))),u=u.next(()=>{!function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.qs(s))),r<6&&i>=6&&(u=u.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),r<7&&i>=7&&(u=u.next(()=>this.Gs(s))),r<8&&i>=8&&(u=u.next(()=>this.Qs(e,s))),r<9&&i>=9&&(u=u.next(()=>{!function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.js(s))),r<11&&i>=11&&(u=u.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(l){const d=l.createObjectStore("documentOverlays",{keyPath:Vp});d.createIndex("collectionPathOverlayIndex",Bp,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",qp,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(l){const d=l.createObjectStore("remoteDocumentsV14",{keyPath:Dp});d.createIndex("documentKeyIndex",Np),d.createIndex("collectionGroupIndex",kp)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.zs(e,s))),r<15&&i>=15&&(u=u.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:Lp}).createIndex("sequenceNumberIndex",Mp,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:Fp}).createIndex("documentKeyIndex",Up,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=Su(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}qs(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>A.forEach(i,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",u).next(l=>A.forEach(l,d=>{re(d.userId===s.userId);const f=Qi(this.It,d);return Ed(e,s.userId,f).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((u,l)=>{const d=new de(u),f=[0,Ut(d)];s.push(t.get(f).next(g=>g?A.resolve():t.put({targetId:0,path:Ut(d),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>A.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:Pp});const r=t.store("collectionParents"),i=new el,s=u=>{if(i.add(u)){const l=u.lastSegment(),d=u.popLast();return r.put({collectionId:l,parent:Ut(d)})}};return t.store("remoteDocuments").Z({X:!0},(u,l)=>{const d=new de(u);return s(d.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,l,d],f)=>{const g=zn(l);return s(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,i)=>{const s=ya(i),u=dd(this.It,s);return t.put(u)})}Ws(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((s,u)=>{const l=t.store("remoteDocumentsV14"),d=(f=u,f.document?new q(de.fromString(f.document.name).popFirst(5)):f.noDocument?q.fromSegments(f.noDocument.path):f.unknownDocument?q.fromSegments(f.unknownDocument.path):z()).path.toArray();var f;const g={prefixPath:d.slice(0,d.length-2),collectionGroup:d[d.length-2],documentId:d[d.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(l.put(g))}).next(()=>A.waitFor(i))}zs(e,t){const r=t.store("mutations"),i=Dd(this.It),s=new Od(Du.Bs,this.It.re);return r.W().next(u=>{const l=new Map;return u.forEach(d=>{var f;let g=null!==(f=l.get(d.userId))&&void 0!==f?f:ue();Qi(this.It,d).keys().forEach(_=>g=g.add(_)),l.set(d.userId,g)}),A.forEach(l,(d,f)=>{const g=new ct(f),_=Eu.oe(this.It,g),T=s.getIndexManager(g),C=Au.oe(g,this.It,T,s.referenceDelegate);return new Rd(i,C,_,T).recalculateAndSaveOverlaysForDocumentKeys(new Hc(t,Ot.at),d).next()})})}}function Pd(n){n.createObjectStore("targetDocuments",{keyPath:Rp}).createIndex("documentTargetsIndex",Op,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Cp,{unique:!0}),n.createObjectStore("targetGlobal")}const nl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class rl{constructor(e,t,r,i,s,u,l,d,f,g,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=s,this.window=u,this.document=l,this.Js=f,this.Ys=g,this.Xs=_,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=T=>Promise.resolve(),!rl.C())throw new F(D.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new rm(this,i),this.ii=t+"main",this.It=new ld(d),this.ri=new Wt(this.ii,this.Xs,new pm(this.It)),this.Cs=new Jp(this.referenceDelegate,this.It),this.remoteDocumentCache=Dd(this.It),this.Ns=new Kp,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&He("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new F(D.FAILED_PRECONDITION,nl);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new Ot(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,I.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,I.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,I.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Nu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(en(e))return U("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return U("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Ta(e).get("owner").next(t=>A.resolve(this.mi(t)))}gi(e){return Nu(e).delete(this.clientId)}yi(){var e=this;return(0,I.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=gt(r,"clientMetadata");return i.W().next(s=>{const u=e.Ii(s,18e5),l=s.filter(d=>-1===u.indexOf(d));return A.forEach(l,d=>i.delete(d.clientId)).next(()=>l)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?A.resolve(!0):Ta(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new F(D.FAILED_PRECONDITION,nl);return!1}}return!(!this.networkEnabled||!this.inForeground)||Nu(e).W().next(r=>void 0===this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,l=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&l)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&U("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,I.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Hc(t,Ot.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Nu(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Au.oe(e,this.It,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Xp(e,this.It.re.databaseId)}getDocumentOverlayCache(e){return Eu.oe(this.It,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){U("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?jp:14===u?cd:13===u?ud:12===u?Gp:11===u?ad:void z();var u;let l;return this.ri.runTransaction(e,i,s,d=>(l=new Hc(d,this.Ss?this.Ss.next():Ot.at),"readwrite-primary"===t?this.fi(l).next(f=>!!f||this.di(l)).next(f=>{if(!f)throw He(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new F(D.FAILED_PRECONDITION,nu);return r(l)}).next(f=>this.wi(l).next(()=>f)):this.Vi(l).next(()=>r(l)))).then(d=>(l.raiseOnCommittedEvent(),d))}Vi(e){return Ta(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new F(D.FAILED_PRECONDITION,nl)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ta(e).put("owner",t)}static C(){return Wt.C()}_i(e){const t=Ta(e);return t.get("owner").next(r=>this.mi(r)?(U("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):A.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(He(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,ie.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return U("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return He("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){He("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ta(n){return gt(n,"owner")}function Nu(n){return gt(n,"clientMetadata")}function il(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class sl{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=i}static Ci(e,t){let r=ue(),i=ue();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new sl(e,t.fromCache,r,i)}}class Ld{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.ki(e,t).next(s=>s||this.Oi(e,t,i,r)).next(s=>s||this.Mi(e,t))}ki(e,t){if($i(t))return A.resolve(null);let r=bt(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=to(t,null,"F"),r=bt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const u=ue(...s);return this.Ni.getDocuments(e,u).next(l=>this.indexManager.getMinOffset(e,r).next(d=>{const f=this.Fi(t,l);return this.$i(t,f,u,d.readTime)?this.ki(e,to(t,null,"F")):this.Bi(e,f,t,d)}))})))}Oi(e,t,r,i){return $i(t)||i.isEqual(ee.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,r,i)?this.Mi(e,t):(ki()<=Ce.in.DEBUG&&U("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zi(t)),this.Bi(e,u,t,eu(i,-1)))})}Fi(e,t){let r=new Ie(du(e));return t.forEach((i,s)=>{ia(e,s)&&(r=r.add(s))}),r}$i(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mi(e,t){return ki()<=Ce.in.DEBUG&&U("QueryEngine","Using full collection scan to execute query:",zi(t)),this.Ni.getDocumentsMatchingQuery(e,t,zt.min())}Bi(e,t,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class mm{constructor(e,t,r,i){this.persistence=e,this.Li=t,this.It=i,this.Ui=new We(se),this.qi=new rn(s=>Gr(s),mr),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Rd(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ui))}}function Md(n,e,t,r){return new mm(n,e,t,r)}function Fd(n,e){return ol.apply(this,arguments)}function ol(){return ol=(0,I.Z)(function*(n,e){const t=G(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const u=[],l=[];let d=ue();for(const f of i){u.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}for(const f of s){l.push(f.batchId);for(const g of f.mutations)d=d.add(g.key)}return t.localDocuments.getDocuments(r,d).next(f=>({ji:f,removedBatchIds:u,addedBatchIds:l}))})})}),ol.apply(this,arguments)}function gm(n,e){const t=G(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){const g=d.batch,_=g.keys();let T=A.resolve();return _.forEach(C=>{T=T.next(()=>f.getEntry(l,C)).next(P=>{const $=d.docVersions.get(C);re(null!==$),P.version.compareTo($)<0&&(g.applyToRemoteDocument(P,d),P.isValidDocument()&&(P.setReadTime(d.commitVersion),f.addEntry(P)))})}),T.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let l=ue();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Ud(n){const e=G(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function ym(n,e){const t=G(n),r=e.snapshotVersion;let i=t.Ui;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});i=t.Ui;const l=[];e.targetChanges.forEach((g,_)=>{const T=i.get(_);if(!T)return;l.push(t.Cs.removeMatchingKeys(s,g.removedDocuments,_).next(()=>t.Cs.addMatchingKeys(s,g.addedDocuments,_)));let C=T.withSequenceNumber(s.currentSequenceNumber);var P,$,H;e.targetMismatches.has(_)?C=C.withResumeToken(st.EMPTY_BYTE_STRING,ee.min()).withLastLimboFreeSnapshotVersion(ee.min()):g.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(g.resumeToken,r)),i=i.insert(_,C),$=C,H=g,(0===(P=T).resumeToken.approximateByteSize()||$.snapshotVersion.toMicroseconds()-P.snapshotVersion.toMicroseconds()>=3e8||H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0)&&l.push(t.Cs.updateTargetData(s,C))});let d=pt(),f=ue();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),l.push(Vd(s,u,e.documentUpdates).next(g=>{d=g.Wi,f=g.zi})),!r.isEqual(ee.min())){const g=t.Cs.getLastRemoteSnapshotVersion(s).next(_=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(g)}return A.waitFor(l).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,d,f)).next(()=>d)}).then(s=>(t.Ui=i,s))}function Vd(n,e,t){let r=ue(),i=ue();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let u=pt();return t.forEach((l,d)=>{const f=s.get(l);d.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),d.isNoDocument()&&d.version.isEqual(ee.min())?(e.removeEntry(l,d.readTime),u=u.insert(l,d)):!f.isValidDocument()||d.version.compareTo(f.version)>0||0===d.version.compareTo(f.version)&&f.hasPendingWrites?(e.addEntry(d),u=u.insert(l,d)):U("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",d.version)}),{Wi:u,zi:i}})}function _m(n,e){const t=G(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function lo(n,e){const t=G(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Cs.getTargetData(r,e).next(s=>s?(i=s,A.resolve(i)):t.Cs.allocateTargetId(r).next(u=>(i=new Qr(e,u,0,r.currentSequenceNumber),t.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.Ui.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Ui=t.Ui.insert(r.targetId,r),t.qi.set(e,r.targetId)),r})}function ho(n,e,t){return al.apply(this,arguments)}function al(){return al=(0,I.Z)(function*(n,e,t){const r=G(n),i=r.Ui.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!en(u))throw u;U("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ui=r.Ui.remove(e),r.qi.delete(i.target)}),al.apply(this,arguments)}function ku(n,e,t){const r=G(n);let i=ee.min(),s=ue();return r.persistence.runTransaction("Execute query","readonly",u=>function(l,d,f){const g=G(l),_=g.qi.get(f);return void 0!==_?A.resolve(g.Ui.get(_)):g.Cs.getTargetData(d,f)}(r,u,bt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(u,l.targetId).next(d=>{s=d})}).next(()=>r.Li.getDocumentsMatchingQuery(u,e,t?i:ee.min(),t?s:ue())).next(l=>(Gd(r,hu(e),l),{documents:l,Hi:s})))}function Bd(n,e){const t=G(n),r=G(t.Cs),i=t.Ui.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.se(s,e).next(u=>u?u.target:null))}function qd(n,e){const t=G(n),r=t.Ki.get(e)||ee.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Gi.getAllFromCollectionGroup(i,e,eu(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Gd(t,e,i),i))}function Gd(n,e,t){let r=n.Ki.get(e)||ee.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Ki.set(e,r)}function ul(){return ul=(0,I.Z)(function*(n,e,t,r){const i=G(n);let s=ue(),u=pt();for(const f of t){const g=e.Ji(f.metadata.name);f.document&&(s=s.add(g));const _=e.Yi(f);_.setReadTime(e.Xi(f.metadata.readTime)),u=u.insert(g,_)}const l=i.Gi.newChangeBuffer({trackRemovals:!0}),d=yield lo(i,(f=r,bt(Kr(de.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",f=>Vd(f,l,u).next(g=>(l.apply(f),g)).next(g=>i.Cs.removeMatchingKeysForTargetId(f,d.targetId).next(()=>i.Cs.addMatchingKeys(f,s,d.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(f,g.Wi,g.zi)).next(()=>g.Wi)))}),ul.apply(this,arguments)}function Im(n,e){return cl.apply(this,arguments)}function cl(){return cl=(0,I.Z)(function*(n,e,t=ue()){const r=yield lo(n,bt(Xc(e.bundledQuery))),i=G(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const u=mt(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ns.saveNamedQuery(s,e);const l=r.withResumeToken(st.EMPTY_BYTE_STRING,u);return i.Ui=i.Ui.insert(l.targetId,l),i.Cs.updateTargetData(s,l).next(()=>i.Cs.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Cs.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ns.saveNamedQuery(s,e))})}),cl.apply(this,arguments)}function jd(n,e){return`firestore_clients_${n}_${e}`}function $d(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function ll(n,e){return`firestore_targets_${n}_${e}`}class Cu{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Zi(e,t,r){const i=JSON.parse(r);let s,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(s=new F(i.error.code,i.error.message))),u?new Cu(e,t,i.state,s):(He("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ba{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new F(r.error.code,r.error.message))),s?new ba(e,r.state,i):(He("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ru{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=_u();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=Ws(r.activeTargetIds[u]),s=s.add(r.activeTargetIds[u]);return i?new Ru(e,s):(He("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class hl{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hl(t.clientId,t.onlineState):(He("SharedClientState",`Failed to parse online state: ${e}`),null)}}class dl{constructor(){this.activeTargetIds=_u()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fl{constructor(e,t,r,i,s){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new We(se),this.started=!1,this.cr=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=jd(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new dl),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,I.Z)(function*(){const t=yield e.syncEngine.vi();for(const i of t){if(i===e.sr)continue;const s=e.getItem(jd(e.persistenceKey,i));if(s){const u=Ru.Zi(i,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const i=e.yr(r);i&&e.pr(i)}for(const i of e.cr)e.rr(i);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(ll(this.persistenceKey,e));if(r){const i=ba.Zi(e,r);i&&(t=i.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ll(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Er(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return U("SharedClientState","READ",e,t),t}setItem(e,t){U("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){U("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(U("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void He("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,I.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const i=t.vr(r.key);return t.Vr(i,null)}{const i=t.Sr(r.key,r.newValue);if(i)return t.Vr(i.clientId,i)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const i=t.Dr(r.key,r.newValue);if(i)return t.Cr(i)}}else if(t._r.test(r.key)){if(null!==r.newValue){const i=t.Nr(r.key,r.newValue);if(i)return t.kr(i)}}else if(r.key===t.wr){if(null!==r.newValue){const i=t.yr(r.newValue);if(i)return t.pr(i)}}else if(r.key===t.hr){const i=function(s){let u=Ot.at;if(null!=s)try{const l=JSON.parse(s);re("number"==typeof l),u=l}catch(l){He("SharedClientState","Failed to read sequence number from WebStorage",l)}return u}(r.newValue);i!==Ot.at&&t.sequenceNumberHandler(i)}else if(r.key===t.mr){const i=t.Or(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const i=new Cu(this.currentUser,e,t,r),s=$d(this.persistenceKey,this.currentUser,e);this.setItem(s,i.tr())}Er(e){const t=$d(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const i=ll(this.persistenceKey,e),s=new ba(e,t,r);this.setItem(i,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return Ru.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),i=Number(r[1]);return Cu.Zi(new ct(void 0!==r[2]?r[2]:null),i,t)}Nr(e,t){const r=this._r.exec(e),i=Number(r[1]);return ba.Zi(i,t)}yr(e){return hl.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,I.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);U("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),i=this.Ir(this.ur),s=this.Ir(r),u=[],l=[];return s.forEach(d=>{i.has(d)||u.push(d)}),i.forEach(d=>{s.has(d)||l.push(d)}),this.syncEngine.Br(u,l).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=_u();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Kd{constructor(){this.Lr=new dl,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.Ur[e]||"not-current"}updateQueryState(e,t,r){this.Ur[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.Ur[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new dl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class wm{qr(e){}shutdown(){}}class zd{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}qr(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){U("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){U("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Em={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Tm{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class bm extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,i,s){const u=this.ho(e,t);U("RestConnection","Sending: ",u,r);const l={};return this.lo(l,i,s),this.fo(e,u,l,r).then(d=>(U("RestConnection","Received: ",d),d),d=>{throw ur("RestConnection",`${e} failed with error: `,d,"url: ",u,"request:",r),d})}_o(e,t,r,i,s,u){return this.ao(e,t,r,i,s)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Fn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}ho(e,t){return`${this.oo}/v1/${t}:${Em[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,i){return new Promise((s,u)=>{const l=new Bh;l.setWithCredentials(!0),l.listenOnce(Uh.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Za.NO_ERROR:const f=l.getResponseJson();U("Connection","XHR received:",JSON.stringify(f)),s(f);break;case Za.TIMEOUT:U("Connection",'RPC "'+e+'" timed out'),u(new F(D.DEADLINE_EXCEEDED,"Request time out"));break;case Za.HTTP_ERROR:const g=l.getStatus();if(U("Connection",'RPC "'+e+'" failed with status:',g,"response text:",l.getResponseText()),g>0){const _=l.getResponseJson().error;if(_&&_.status&&_.message){const T=function(C){const P=C.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(P)>=0?P:D.UNKNOWN}(_.status);u(new F(T,_.message))}else u(new F(D.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new F(D.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{U("Connection",'RPC "'+e+'" completed.')}});const d=JSON.stringify(i);l.send(t,"POST",d,r,15)})}wo(e,t,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=ac(),u=uc(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(l.xmlHttpFactory=new Vh({})),this.lo(l.initMessageHeaders,t,r),l.encodeInitMessageHeaders=!0;const d=i.join("");U("Connection","Creating WebChannel: "+d,l);const f=s.createWebChannel(d,l);let g=!1,_=!1;const T=new Tm({Hr:P=>{_?U("Connection","Not sending because WebChannel is closed:",P):(g||(U("Connection","Opening WebChannel transport."),f.open(),g=!0),U("Connection","WebChannel sending:",P),f.send(P))},Jr:()=>f.close()}),C=(P,$,H)=>{P.listen($,be=>{try{H(be)}catch(Ge){setTimeout(()=>{throw Ge},0)}})};return C(f,Vo.EventType.OPEN,()=>{_||U("Connection","WebChannel transport opened.")}),C(f,Vo.EventType.CLOSE,()=>{_||(_=!0,U("Connection","WebChannel transport closed"),T.io())}),C(f,Vo.EventType.ERROR,P=>{_||(_=!0,ur("Connection","WebChannel transport errored:",P),T.io(new F(D.UNAVAILABLE,"The operation could not be completed")))}),C(f,Vo.EventType.MESSAGE,P=>{var $;if(!_){const H=P.data[0];re(!!H);const be=H,Ge=be.error||(null===($=be[0])||void 0===$?void 0:$.error);if(Ge){U("Connection","WebChannel received error:",Ge);const Ne=Ge.status;let _t=function(De){const St=Z[De];if(void 0!==St)return Tn(St)}(Ne),Le=Ge.message;void 0===_t&&(_t=D.INTERNAL,Le="Unknown error status: "+Ne+" with message "+Ge.message),_=!0,T.io(new F(_t,Le)),f.close()}else U("Connection","WebChannel received:",H),T.ro(H)}}),C(u,cc.STAT_EVENT,P=>{P.stat===Qa.PROXY?U("Connection","Detected buffering proxy"):P.stat===Qa.NOPROXY&&U("Connection","Detected no buffering proxy")}),setTimeout(()=>{T.so()},0),T}}function Wd(){return"undefined"!=typeof window?window:null}function Ou(){return"undefined"!=typeof document?document:null}function Sa(n){return new mp(n,!0)}class pl{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-r);i>0&&U("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Hd{constructor(e,t,r,i,s,u,l,d){this.Hs=e,this.vo=r,this.Vo=i,this.So=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=l,this.listener=d,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new pl(e,t)}ko(){return 1===this.state||5===this.state||this.Oo()}Oo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Mo()}stop(){var e=this;return(0,I.Z)(function*(){e.ko()&&(yield e.close(0))})()}Fo(){this.state=0,this.No.reset()}$o(){this.Oo()&&null===this.Co&&(this.Co=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.Bo()))}Lo(e){this.Uo(),this.stream.send(e)}Bo(){var e=this;return(0,I.Z)(function*(){if(e.Oo())return e.close(0)})()}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}close(e,t){var r=this;return(0,I.Z)(function*(){r.Uo(),r.qo(),r.No.cancel(),r.Do++,4!==e?r.No.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(He(t.toString()),He("Using maximum backoff delay to prevent overloading the backend."),r.No.Ao()):t&&t.code===D.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Ko(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),t=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Do===t&&this.Qo(r,i)},r=>{e(()=>{const i=new F(D.UNKNOWN,"Fetching auth token failed: "+r.message);return this.jo(i)})})}Qo(e,t){const r=this.Go(this.Do);this.stream=this.Wo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.xo=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.Oo()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.jo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Mo(){var e=this;this.state=5,this.No.Ro((0,I.Z)(function*(){e.state=0,e.start()}))}jo(e){return U("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return t=>{this.Hs.enqueueAndForget(()=>this.Do===e?t():(U("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Sm extends Hd{constructor(e,t,r,i,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.It=s}Wo(e,t){return this.So.wo("Listen",e,t)}onMessage(e){this.No.reset();const t=function _p(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(d=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===d?1:"REMOVE"===d?2:"CURRENT"===d?3:"RESET"===d?4:z(),i=e.targetChange.targetIds||[],s=function(d,f){return d.gt?(re(void 0===f||"string"==typeof f),st.fromBase64String(f||"")):(re(void 0===f||f instanceof Uint8Array),st.fromUint8Array(f||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,l=u&&function(d){const f=void 0===d.code?D.UNKNOWN:Tn(d.code);return new F(f,d.message||"")}(u);t=new $h(r,i,s,l||null)}else if("documentChange"in e){const r=e.documentChange,i=Kn(n,r.document.name),s=mt(r.document.updateTime),u=new ht({mapValue:{fields:r.document.fields}}),l=Pe.newFoundDocument(i,s,u);t=new vu(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in e){const r=e.documentDelete,i=Kn(n,r.document),s=r.readTime?mt(r.readTime):ee.min(),u=Pe.newNoDocument(i,s);t=new vu([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=Kn(n,r.document);t=new vu([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return z();{const r=e.filter,s=new Y(r.count||0);t=new jh(r.targetId,s)}}var d;return t}(this.It,e),r=function(i){if(!("targetChange"in i))return ee.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?ee.min():s.readTime?mt(s.readTime):ee.min()}(e);return this.listener.zo(t,r)}Ho(e){const t={};t.database=ma(this.It),t.addTarget=function(i,s){let u;const l=s.target;return u=Zo(l)?{documents:ed(i,l)}:{query:Wc(i,l)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Hh(i,s.resumeToken):s.snapshotVersion.compareTo(ee.min())>0&&(u.readTime=fa(i,s.snapshotVersion.toTimestamp())),u}(this.It,e);const r=function Ip(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return z()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Lo(t)}Jo(e){const t={};t.database=ma(this.It),t.removeTarget=e,this.Lo(t)}}class Am extends Hd{constructor(e,t,r,i,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.It=s,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,t){return this.So.wo("Write",e,t)}onMessage(e){if(re(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const t=function vp(n,e){return n&&n.length>0?(re(void 0!==e),n.map(t=>function(r,i){let s=mt(r.updateTime?r.updateTime:i);return s.isEqual(ee.min())&&(s=mt(i)),new Bc(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=mt(e.commitTime);return this.listener.tu(r,t)}return re(!e.writeResults||0===e.writeResults.length),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=ma(this.It),this.Lo(e)}Zo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>ga(this.It,r))};this.Lo(t)}}class xm extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.So=r,this.It=i,this.su=!1}iu(){if(this.su)throw new F(D.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.So.ao(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new F(D.UNKNOWN,i.toString())})}_o(e,t,r,i){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.So._o(e,t,r,s,u,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new F(D.UNKNOWN,s.toString())})}terminate(){this.su=!0}}class Nm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}cu(){0===this.ru&&(this.au("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.au("Offline"),Promise.resolve())))}lu(e){"Online"===this.state?this.au("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.au("Offline")))}set(e){this.fu(),this.ru=0,"Online"===e&&(this.uu=!1),this.au(e)}au(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(He(t),this.uu=!1):U("OnlineStateTracker",t)}fu(){null!==this.ou&&(this.ou.cancel(),this.ou=null)}}class km{constructor(e,t,r,i,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=s,this.gu.qr(l=>{r.enqueueAndForget((0,I.Z)(function*(){var d;vr(u)&&(U("RemoteStore","Restarting streams for network reachability change."),yield(d=(0,I.Z)(function*(f){const g=G(f);g.wu.add(4),yield fo(g),g.yu.set("Unknown"),g.wu.delete(4),yield Aa(g)}),function(f){return d.apply(this,arguments)})(u))}))}),this.yu=new Nm(r,i)}}function Aa(n){return gl.apply(this,arguments)}function gl(){return gl=(0,I.Z)(function*(n){if(vr(n))for(const e of n.mu)yield e(!0)}),gl.apply(this,arguments)}function fo(n){return yl.apply(this,arguments)}function yl(){return yl=(0,I.Z)(function*(n){for(const e of n.mu)yield e(!1)}),yl.apply(this,arguments)}function Pu(n,e){const t=G(n);t._u.has(e.targetId)||(t._u.set(e.targetId,e),Il(t)?vl(t):mo(t).Oo()&&_l(t,e))}function xa(n,e){const t=G(n),r=mo(t);t._u.delete(e),r.Oo()&&Zd(t,e),0===t._u.size&&(r.Oo()?r.$o():vr(t)&&t.yu.set("Unknown"))}function _l(n,e){n.pu.Mt(e.targetId),mo(n).Ho(e)}function Zd(n,e){n.pu.Mt(e),mo(n).Jo(e)}function vl(n){n.pu=new dp({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),se:e=>n._u.get(e)||null}),mo(n).start(),n.yu.cu()}function Il(n){return vr(n)&&!mo(n).ko()&&n._u.size>0}function vr(n){return 0===G(n).wu.size}function Qd(n){n.pu=void 0}function Cm(n){return wl.apply(this,arguments)}function wl(){return wl=(0,I.Z)(function*(n){n._u.forEach((e,t)=>{_l(n,e)})}),wl.apply(this,arguments)}function Rm(n,e){return El.apply(this,arguments)}function El(){return El=(0,I.Z)(function*(n,e){Qd(n),Il(n)?(n.yu.lu(e),vl(n)):n.yu.set("Unknown")}),El.apply(this,arguments)}function Om(n,e,t){return Tl.apply(this,arguments)}function Tl(){return Tl=(0,I.Z)(function*(n,e,t){if(n.yu.set("Online"),e instanceof $h&&2===e.state&&e.cause)try{yield(r=(0,I.Z)(function*(i,s){const u=s.cause;for(const l of s.targetIds)i._u.has(l)&&(yield i.remoteSyncer.rejectListen(l,u),i._u.delete(l),i.pu.removeTarget(l))}),function(i,s){return r.apply(this,arguments)})(n,e)}catch(r){U("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Lu(n,r)}else if(e instanceof vu?n.pu.Gt(e):e instanceof jh?n.pu.Yt(e):n.pu.Wt(e),!t.isEqual(ee.min()))try{const r=yield Ud(n.localStore);t.compareTo(r)>=0&&(yield function(i,s){const u=i.pu.te(s);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){const f=i._u.get(d);f&&i._u.set(d,f.withResumeToken(l.resumeToken,s))}}),u.targetMismatches.forEach(l=>{const d=i._u.get(l);if(!d)return;i._u.set(l,d.withResumeToken(st.EMPTY_BYTE_STRING,d.snapshotVersion)),Zd(i,l);const f=new Qr(d.target,l,1,d.sequenceNumber);_l(i,f)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){U("RemoteStore","Failed to raise snapshot:",r),yield Lu(n,r)}var r}),Tl.apply(this,arguments)}function Lu(n,e,t){return bl.apply(this,arguments)}function bl(){return bl=(0,I.Z)(function*(n,e,t){if(!en(e))throw e;n.wu.add(1),yield fo(n),n.yu.set("Offline"),t||(t=()=>Ud(n.localStore)),n.asyncQueue.enqueueRetryable((0,I.Z)(function*(){U("RemoteStore","Retrying IndexedDB access"),yield t(),n.wu.delete(1),yield Aa(n)}))}),bl.apply(this,arguments)}function Yd(n,e){return e().catch(t=>Lu(n,t,e))}function po(n){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,I.Z)(function*(n){const e=G(n),t=Jr(e);let r=e.du.length>0?e.du[e.du.length-1].batchId:-1;for(;Pm(e);)try{const i=yield _m(e.localStore,r);if(null===i){0===e.du.length&&t.$o();break}r=i.batchId,Lm(e,i)}catch(i){yield Lu(e,i)}Xd(e)&&Jd(e)}),Sl.apply(this,arguments)}function Pm(n){return vr(n)&&n.du.length<10}function Lm(n,e){n.du.push(e);const t=Jr(n);t.Oo()&&t.Xo&&t.Zo(e.mutations)}function Xd(n){return vr(n)&&!Jr(n).ko()&&n.du.length>0}function Jd(n){Jr(n).start()}function Mm(n){return Al.apply(this,arguments)}function Al(){return Al=(0,I.Z)(function*(n){Jr(n).nu()}),Al.apply(this,arguments)}function Fm(n){return xl.apply(this,arguments)}function xl(){return xl=(0,I.Z)(function*(n){const e=Jr(n);for(const t of n.du)e.Zo(t.mutations)}),xl.apply(this,arguments)}function Um(n,e,t){return Dl.apply(this,arguments)}function Dl(){return Dl=(0,I.Z)(function*(n,e,t){const r=n.du.shift(),i=Qc.from(r,e,t);yield Yd(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield po(n)}),Dl.apply(this,arguments)}function Vm(n,e){return Nl.apply(this,arguments)}function Nl(){return Nl=(0,I.Z)(function*(n,e){var t;e&&Jr(n).Xo&&(yield(t=(0,I.Z)(function*(r,i){if(nn(s=i.code)&&s!==D.ABORTED){const u=r.du.shift();Jr(r).Fo(),yield Yd(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield po(r)}var s}),function(r,i){return t.apply(this,arguments)})(n,e)),Xd(n)&&Jd(n)}),Nl.apply(this,arguments)}function ef(n,e){return kl.apply(this,arguments)}function kl(){return kl=(0,I.Z)(function*(n,e){const t=G(n);t.asyncQueue.verifyOperationInProgress(),U("RemoteStore","RemoteStore received new credentials");const r=vr(t);t.wu.add(3),yield fo(t),r&&t.yu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.wu.delete(3),yield Aa(t)}),kl.apply(this,arguments)}function Cl(n,e){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,I.Z)(function*(n,e){const t=G(n);e?(t.wu.delete(2),yield Aa(t)):e||(t.wu.add(2),yield fo(t),t.yu.set("Unknown"))}),Rl.apply(this,arguments)}function mo(n){return n.Iu||(n.Iu=function(e,t,r){const i=G(e);return i.iu(),new Sm(t,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(n.datastore,n.asyncQueue,{Yr:Cm.bind(null,n),Zr:Rm.bind(null,n),zo:Om.bind(null,n)}),n.mu.push(function(){var e=(0,I.Z)(function*(t){t?(n.Iu.Fo(),Il(n)?vl(n):n.yu.set("Unknown")):(yield n.Iu.stop(),Qd(n))});return function(t){return e.apply(this,arguments)}}())),n.Iu}function Jr(n){return n.Tu||(n.Tu=function(e,t,r){const i=G(e);return i.iu(),new Am(t,i.So,i.authCredentials,i.appCheckCredentials,i.It,r)}(n.datastore,n.asyncQueue,{Yr:Mm.bind(null,n),Zr:Vm.bind(null,n),eu:Fm.bind(null,n),tu:Um.bind(null,n)}),n.mu.push(function(){var e=(0,I.Z)(function*(t){t?(n.Tu.Fo(),yield po(n)):(yield n.Tu.stop(),n.du.length>0&&(U("RemoteStore",`Stopping write stream with ${n.du.length} pending writes`),n.du=[]))});return function(t){return e.apply(this,arguments)}}())),n.Tu}class Ol{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,s){const u=Date.now()+r,l=new Ol(e,t,u,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new F(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function go(n,e){if(He("AsyncQueue",`${e}: ${n}`),en(n))return new F(D.UNAVAILABLE,`${e}: ${n}`);throw n}class yo{constructor(e){this.comparator=e?(t,r)=>e(t,r)||q.comparator(t.key,r.key):(t,r)=>q.comparator(t.key,r.key),this.keyedMap=Zr(),this.sortedSet=new We(this.comparator)}static emptySet(e){return new yo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof yo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new yo;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class tf{constructor(){this.Eu=new We(q.comparator)}track(e){const t=e.doc.key,r=this.Eu.get(t);r?0!==e.type&&3===r.type?this.Eu=this.Eu.insert(t,e):3===e.type&&1!==r.type?this.Eu=this.Eu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Eu=this.Eu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Eu=this.Eu.remove(t):1===e.type&&2===r.type?this.Eu=this.Eu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):z():this.Eu=this.Eu.insert(t,e)}Au(){const e=[];return this.Eu.inorderTraversal((t,r)=>{e.push(r)}),e}}class _o{constructor(e,t,r,i,s,u,l,d,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=l,this.excludesMetadataChanges=d,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const u=[];return t.forEach(l=>{u.push({type:0,doc:l})}),new _o(e,t,yo.emptySet(t),u,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ki(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Bm{constructor(){this.Ru=void 0,this.listeners=[]}}class qm{constructor(){this.queries=new rn(e=>lu(e),Ki),this.onlineState="Unknown",this.bu=new Set}}function Pl(n,e){return Ll.apply(this,arguments)}function Ll(){return Ll=(0,I.Z)(function*(n,e){const t=G(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new Bm),i)try{s.Ru=yield t.onListen(r)}catch(u){const l=go(u,`Initialization of query '${zi(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.listeners.push(e),e.Pu(t.onlineState),s.Ru&&e.vu(s.Ru)&&Ul(t)}),Ll.apply(this,arguments)}function Ml(n,e){return Fl.apply(this,arguments)}function Fl(){return Fl=(0,I.Z)(function*(n,e){const t=G(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Fl.apply(this,arguments)}function Gm(n,e){const t=G(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const l of u.listeners)l.vu(i)&&(r=!0);u.Ru=i}}r&&Ul(t)}function jm(n,e,t){const r=G(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Ul(n){n.bu.forEach(e=>{e.next()})}class Vl{constructor(e,t,r){this.query=e,this.Vu=t,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=r||{}}vu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new _o(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Su?this.Cu(e)&&(this.Vu.next(e),t=!0):this.xu(e,this.onlineState)&&(this.Nu(e),t=!0),this.Du=e,t}onError(e){this.Vu.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),t=!0),t}xu(e,t){return!e.fromCache||(!this.options.ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Cu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Nu(e){e=_o.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Su=!0,this.Vu.next(e)}}class $m{constructor(e,t){this.payload=e,this.byteLength=t}Ou(){return"metadata"in this.payload}}class nf{constructor(e){this.It=e}Ji(e){return Kn(this.It,e)}Yi(e){return e.metadata.exists?Jh(this.It,e.document,!1):Pe.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return mt(e)}}class Km{constructor(e,t,r){this.Mu=e,this.localStore=t,this.It=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=rf(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const r=de.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new nf(this.It);for(const i of e)if(i.metadata.queries){const s=r.Ji(i.metadata.name);for(const u of i.metadata.queries){const l=(t.get(u)||ue()).add(s);t.set(u,l)}}return t}complete(){var e=this;return(0,I.Z)(function*(){const t=yield function vm(n,e,t,r){return ul.apply(this,arguments)}(e.localStore,new nf(e.It),e.documents,e.Mu.id),r=e.$u(e.documents);for(const i of e.queries)yield Im(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function rf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class sf{constructor(e){this.key=e}}class of{constructor(e){this.key=e}}class af{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=ue(),this.mutatedKeys=ue(),this.Gu=du(e),this.Qu=new yo(this.Gu)}get ju(){return this.Uu}Wu(e,t){const r=t?t.zu:new tf,i=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=i,l=!1;const d="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,f="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,_)=>{const T=i.get(g),C=ia(this.query,_)?_:null,P=!!T&&this.mutatedKeys.has(T.key),$=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations);let H=!1;T&&C?T.data.isEqual(C.data)?P!==$&&(r.track({type:3,doc:C}),H=!0):this.Hu(T,C)||(r.track({type:2,doc:C}),H=!0,(d&&this.Gu(C,d)>0||f&&this.Gu(C,f)<0)&&(l=!0)):!T&&C?(r.track({type:0,doc:C}),H=!0):T&&!C&&(r.track({type:1,doc:T}),H=!0,(d||f)&&(l=!0)),H&&(C?(u=u.add(C),s=$?s.add(g):s.delete(g)):(u=u.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{Qu:u,zu:r,$i:l,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Au();s.sort((f,g)=>function(_,T){const C=P=>{switch(P){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return C(_)-C(T)}(f.type,g.type)||this.Gu(f.doc,g.doc)),this.Ju(r);const u=t?this.Yu():[],l=0===this.Ku.size&&this.current?1:0,d=l!==this.qu;return this.qu=l,0!==s.length||d?{snapshot:new _o(this.query,e.Qu,i,s,e.mutatedKeys,0===l,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new tf,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.Uu=this.Uu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Uu=this.Uu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=ue(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new of(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new sf(r))}),t}tc(e){this.Uu=e.Hi,this.Ku=ue();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return _o.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu,this.hasCachedResults)}}class zm{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Wm{constructor(e){this.key=e,this.nc=!1}}class Hm{constructor(e,t,r,i,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new rn(l=>lu(l),Ki),this.rc=new Map,this.oc=new Set,this.uc=new We(q.comparator),this.cc=new Map,this.ac=new tl,this.hc={},this.lc=new Map,this.fc=es.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Zm(n,e){return Bl.apply(this,arguments)}function Bl(){return Bl=(0,I.Z)(function*(n,e){const t=ch(n);let r,i;const s=t.ic.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const u=yield lo(t.localStore,bt(e));t.isPrimaryClient&&Pu(t.remoteStore,u);const l=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield ql(t,e,r,"current"===l,u.resumeToken)}return i}),Bl.apply(this,arguments)}function ql(n,e,t,r,i){return Gl.apply(this,arguments)}function Gl(){return Gl=(0,I.Z)(function*(n,e,t,r,i){n._c=(_,T,C)=>{return(P=(0,I.Z)(function*($,H,be,Ge){let Ne=H.view.Wu(be);Ne.$i&&(Ne=yield ku($.localStore,H.query,!1).then(({documents:De})=>H.view.Wu(De,Ne)));const _t=Ge&&Ge.targetChanges.get(H.targetId),Le=H.view.applyChanges(Ne,$.isPrimaryClient,_t);return Xl($,H.targetId,Le.Xu),Le.snapshot}),function($,H,be,Ge){return P.apply(this,arguments)})(n,_,T,C);var P};const s=yield ku(n.localStore,e,!0),u=new af(e,s.Hi),l=u.Wu(s.documents),d=da.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),f=u.applyChanges(l,n.isPrimaryClient,d);Xl(n,t,f.Xu);const g=new zm(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),f.snapshot}),Gl.apply(this,arguments)}function Qm(n,e){return jl.apply(this,arguments)}function jl(){return jl=(0,I.Z)(function*(n,e){const t=G(n),r=t.ic.get(e),i=t.rc.get(r.targetId);if(i.length>1)return t.rc.set(r.targetId,i.filter(s=>!Ki(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield ho(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),xa(t.remoteStore,r.targetId),vo(t,r.targetId)}).catch(Bn))):(vo(t,r.targetId),yield ho(t.localStore,r.targetId,!0))}),jl.apply(this,arguments)}function $l(){return $l=(0,I.Z)(function*(n,e,t){const r=lh(n);try{const i=yield function(s,u){const l=G(s),d=Ve.now(),f=u.reduce((T,C)=>T.add(C.key),ue());let g,_;return l.persistence.runTransaction("Locally write mutations","readwrite",T=>{let C=pt(),P=ue();return l.Gi.getEntries(T,f).next($=>{C=$,C.forEach((H,be)=>{be.isValidDocument()||(P=P.add(H))})}).next(()=>l.localDocuments.getOverlayedDocuments(T,C)).next($=>{g=$;const H=[];for(const be of u){const Ge=c(be,g.get(be.key).overlayedDocument);null!=Ge&&H.push(new h(be.key,Ge,Ys(Ge.value.mapValue),qe.exists(!0)))}return l.mutationQueue.addMutationBatch(T,d,H,u)}).next($=>{_=$;const H=$.applyToLocalDocumentSet(g,P);return l.documentOverlayCache.saveOverlays(T,$.batchId,H)})}).then(()=>({batchId:_.batchId,changes:so(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,u,l){let d=s.hc[s.currentUser.toKey()];d||(d=new We(se)),d=d.insert(u,l),s.hc[s.currentUser.toKey()]=d}(r,i.batchId,t),yield Ir(r,i.changes),yield po(r.remoteStore)}catch(i){const s=go(i,"Failed to persist write");t.reject(s)}}),$l.apply(this,arguments)}function uf(n,e){return Kl.apply(this,arguments)}function Kl(){return Kl=(0,I.Z)(function*(n,e){const t=G(n);try{const r=yield ym(t.localStore,e);e.targetChanges.forEach((i,s)=>{const u=t.cc.get(s);u&&(re(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.nc=!0:i.modifiedDocuments.size>0?re(u.nc):i.removedDocuments.size>0&&(re(u.nc),u.nc=!1))}),yield Ir(t,r,e)}catch(r){yield Bn(r)}}),Kl.apply(this,arguments)}function cf(n,e,t){const r=G(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ic.forEach((s,u)=>{const l=u.view.Pu(e);l.snapshot&&i.push(l.snapshot)}),function(s,u){const l=G(s);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(const _ of g.listeners)_.Pu(u)&&(d=!0)}),d&&Ul(l)}(r.eventManager,e),i.length&&r.sc.zo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Xm(n,e,t){return zl.apply(this,arguments)}function zl(){return zl=(0,I.Z)(function*(n,e,t){const r=G(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.cc.get(e),s=i&&i.key;if(s){let u=new We(q.comparator);u=u.insert(s,Pe.newNoDocument(s,ee.min()));const l=ue().add(s),d=new ha(ee.min(),new Map,new Ie(se),u,l);yield uf(r,d),r.uc=r.uc.remove(s),r.cc.delete(e),Jl(r)}else yield ho(r.localStore,e,!1).then(()=>vo(r,e,t)).catch(Bn)}),zl.apply(this,arguments)}function Jm(n,e){return Wl.apply(this,arguments)}function Wl(){return Wl=(0,I.Z)(function*(n,e){const t=G(n),r=e.batch.batchId;try{const i=yield gm(t.localStore,e);Yl(t,r,null),Ql(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Ir(t,i)}catch(i){yield Bn(i)}}),Wl.apply(this,arguments)}function eg(n,e,t){return Hl.apply(this,arguments)}function Hl(){return Hl=(0,I.Z)(function*(n,e,t){const r=G(n);try{const i=yield function(s,u){const l=G(s);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(re(null!==g),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(r.localStore,e);Yl(r,e,t),Ql(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Ir(r,i)}catch(i){yield Bn(i)}}),Hl.apply(this,arguments)}function Zl(){return Zl=(0,I.Z)(function*(n,e){const t=G(n);vr(t.remoteStore)||U("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(s){const u=G(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(t.localStore);if(-1===r)return void e.resolve();const i=t.lc.get(r)||[];i.push(e),t.lc.set(r,i)}catch(r){const i=go(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),Zl.apply(this,arguments)}function Ql(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Yl(n,e,t){const r=G(n);let i=r.hc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function vo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||lf(n,r)})}function lf(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(xa(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),Jl(n))}function Xl(n,e,t){for(const r of t)r instanceof sf?(n.ac.addReference(r.key,e),ng(n,r)):r instanceof of?(U("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||lf(n,r.key)):z()}function ng(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(U("SyncEngine","New document in limbo: "+t),n.oc.add(r),Jl(n))}function Jl(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new q(de.fromString(e)),r=n.fc.next();n.cc.set(r,new Wm(t)),n.uc=n.uc.insert(t,r),Pu(n.remoteStore,new Qr(bt(Kr(t.path)),r,2,Ot.at))}}function Ir(n,e,t){return eh.apply(this,arguments)}function eh(){return eh=(0,I.Z)(function*(n,e,t){const r=G(n),i=[],s=[],u=[];var l;r.ic.isEmpty()||(r.ic.forEach((l,d)=>{u.push(r._c(d,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(d.targetId,(null==f?void 0:f.fromCache)?"not-current":"current"),f){i.push(f);const g=sl.Ci(d.targetId,f);s.push(g)}}))}),yield Promise.all(u),r.sc.zo(i),yield(l=(0,I.Z)(function*(d,f){const g=G(d);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>A.forEach(f,T=>A.forEach(T.Si,C=>g.persistence.referenceDelegate.addReference(_,T.targetId,C)).next(()=>A.forEach(T.Di,C=>g.persistence.referenceDelegate.removeReference(_,T.targetId,C)))))}catch(_){if(!en(_))throw _;U("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of f){const T=_.targetId;if(!_.fromCache){const C=g.Ui.get(T),$=C.withLastLimboFreeSnapshotVersion(C.snapshotVersion);g.Ui=g.Ui.insert(T,$)}}}),function(d,f){return l.apply(this,arguments)})(r.localStore,s))}),eh.apply(this,arguments)}function rg(n,e){return th.apply(this,arguments)}function th(){return th=(0,I.Z)(function*(n,e){const t=G(n);if(!t.currentUser.isEqual(e)){U("SyncEngine","User change. New user:",e.toKey());const r=yield Fd(t.localStore,e);t.currentUser=e,(i=t).lc.forEach(u=>{u.forEach(l=>{l.reject(new F(D.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Ir(t,r.ji)}var i}),th.apply(this,arguments)}function ig(n,e){const t=G(n),r=t.cc.get(e);if(r&&r.nc)return ue().add(r.key);{let i=ue();const s=t.rc.get(e);if(!s)return i;for(const u of s){const l=t.ic.get(u);i=i.unionWith(l.view.ju)}return i}}function sg(n,e){return nh.apply(this,arguments)}function nh(){return nh=(0,I.Z)(function*(n,e){const t=G(n),r=yield ku(t.localStore,e.query,!0),i=e.view.tc(r);return t.isPrimaryClient&&Xl(t,e.targetId,i.Xu),i}),nh.apply(this,arguments)}function og(n,e){return rh.apply(this,arguments)}function rh(){return rh=(0,I.Z)(function*(n,e){const t=G(n);return qd(t.localStore,e).then(r=>Ir(t,r))}),rh.apply(this,arguments)}function ag(n,e,t,r){return ih.apply(this,arguments)}function ih(){return ih=(0,I.Z)(function*(n,e,t,r){const i=G(n),s=yield function(u,l){const d=G(u),f=G(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Tn(g,l).next(_=>_?d.localDocuments.getDocuments(g,_):A.resolve(null)))}(i.localStore,e);var l;null!==s?("pending"===t?yield po(i.remoteStore):"acknowledged"===t||"rejected"===t?(Yl(i,e,r||null),Ql(i,e),l=e,G(G(i.localStore).mutationQueue).An(l)):z(),yield Ir(i,s)):U("SyncEngine","Cannot apply mutation batch with id: "+e)}),ih.apply(this,arguments)}function sh(){return sh=(0,I.Z)(function*(n,e){const t=G(n);if(ch(t),lh(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield hf(t,r.toArray());t.dc=!0,yield Cl(t.remoteStore,!0);for(const s of i)Pu(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const r=[];let i=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?r.push(u):i=i.then(()=>(vo(t,u),ho(t.localStore,u,!0))),xa(t.remoteStore,u)}),yield i,yield hf(t,r),function(s){const u=G(s);u.cc.forEach((l,d)=>{xa(u.remoteStore,d)}),u.ac.fs(),u.cc=new Map,u.uc=new We(q.comparator)}(t),t.dc=!1,yield Cl(t.remoteStore,!1)}}),sh.apply(this,arguments)}function hf(n,e,t){return oh.apply(this,arguments)}function oh(){return oh=(0,I.Z)(function*(n,e,t){const r=G(n),i=[],s=[];for(const u of e){let l;const d=r.rc.get(u);if(d&&0!==d.length){l=yield lo(r.localStore,bt(d[0]));for(const f of d){const g=r.ic.get(f),_=yield sg(r,g);_.snapshot&&s.push(_.snapshot)}}else{const f=yield Bd(r.localStore,u);l=yield lo(r.localStore,f),yield ql(r,df(f),u,!1,l.resumeToken)}i.push(l)}return r.sc.zo(s),i}),oh.apply(this,arguments)}function df(n){return ea(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function cg(n){const e=G(n);return G(G(e.localStore).persistence).vi()}function lg(n,e,t,r){return ah.apply(this,arguments)}function ah(){return ah=(0,I.Z)(function*(n,e,t,r){const i=G(n);if(i.dc)return void U("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield qd(i.localStore,hu(s[0])),l=ha.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,st.EMPTY_BYTE_STRING);yield Ir(i,u,l);break}case"rejected":yield ho(i.localStore,e,!0),vo(i,e,r);break;default:z()}}),ah.apply(this,arguments)}function hg(n,e,t){return uh.apply(this,arguments)}function uh(){return uh=(0,I.Z)(function*(n,e,t){const r=ch(n);if(r.dc){for(const i of e){if(r.rc.has(i)){U("SyncEngine","Adding an already active target "+i);continue}const s=yield Bd(r.localStore,i),u=yield lo(r.localStore,s);yield ql(r,df(s),u.targetId,!1,u.resumeToken),Pu(r.remoteStore,u)}for(const i of t)r.rc.has(i)&&(yield ho(r.localStore,i,!1).then(()=>{xa(r.remoteStore,i),vo(r,i)}).catch(Bn))}}),uh.apply(this,arguments)}function ch(n){const e=G(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=uf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ig.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Xm.bind(null,e),e.sc.zo=Gm.bind(null,e.eventManager),e.sc.wc=jm.bind(null,e.eventManager),e}function lh(n){const e=G(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Jm.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=eg.bind(null,e),e}class ff{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,I.Z)(function*(){t.It=Sa(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Md(this.persistence,new Ld,e.initialUser,this.It)}yc(e){return new Od(Du.Bs,this.It)}gc(e){return new Kd}terminate(){var e=this;return(0,I.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class pf extends ff{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,I.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield lh(r.Ac.syncEngine),yield po(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Md(this.persistence,new Ld,e.initialUser,this.It)}Tc(e,t){return new tm(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Ic(t,this.persistence);return new vc(e.asyncQueue,r)}yc(e){const t=il(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new rl(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Wd(),Ou(),this.It,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Kd}}class fg extends pf{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,I.Z)(function*(){yield t().call(r,e);const i=r.Ac.syncEngine;r.sharedClientState instanceof fl&&(r.sharedClientState.syncEngine={Fr:ag.bind(null,i),$r:lg.bind(null,i),Br:hg.bind(null,i),vi:cg.bind(null,i),Mr:og.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var s=(0,I.Z)(function*(u){yield function ug(n,e){return sh.apply(this,arguments)}(r.Ac.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start():u||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(u&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():u||r.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Wd();if(!fl.C(t))throw new F(D.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=il(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new fl(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class hh{initialize(e,t){var r=this;return(0,I.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>cf(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=rg.bind(null,r.syncEngine),yield Cl(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new qm}createDatastore(e){const t=Sa(e.databaseInfo.databaseId),r=new bm(e.databaseInfo);return new xm(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=l=>cf(this.syncEngine,l,0),u=zd.C()?new zd:new wm,new km(t,r,i,s,u);var t,r,i,s,u}createSyncEngine(e,t){return function(r,i,s,u,l,d,f){const g=new Hm(r,i,s,u,l,d);return f&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,I.Z)(function*(t){const r=G(t);U("RemoteStore","RemoteStore shutting down."),r.wu.add(5),yield fo(r),r.gu.shutdown(),r.yu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function dh(n,e,t){if(!t)throw new F(D.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function mf(n,e,t,r){if(!0===e&&!0===r)throw new F(D.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gf(n){if(!q.isDocumentKey(n))throw new F(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function yf(n){if(q.isDocumentKey(n))throw new F(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Mu(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":z()}function ge(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new F(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Mu(n);throw new F(D.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function _f(n,e){if(e<=0)throw new F(D.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const vf=new Map;class If{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new F(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new F(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,mf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Da{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new If({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new F(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new F(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new If(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new dc;switch(t.type){case"gapi":return new pc(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new F(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=vf.get(e);t&&(U("ComponentProvider","Removing Datastore"),vf.delete(e),t.terminate())}(this),Promise.resolve()}}class Ke{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Wn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ke(this.firestore,e,this._key)}}class Pt{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Pt(this.firestore,e,this._query)}}class Wn extends Pt{constructor(e,t,r){super(e,t,Kr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ke(this.firestore,null,new q(e))}withConverter(e){return new Wn(this.firestore,e,this._path)}}function Ef(n,e,...t){if(n=(0,ie.m9)(n),dh("collection","path",e),n instanceof Da){const r=de.fromString(e,...t);return yf(r),new Wn(n,null,r)}{if(!(n instanceof Ke||n instanceof Wn))throw new F(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return yf(r),new Wn(n.firestore,null,r)}}function Fu(n,e,...t){if(n=(0,ie.m9)(n),1===arguments.length&&(e=$s.R()),dh("doc","path",e),n instanceof Da){const r=de.fromString(e,...t);return gf(r),new Ke(n,null,new q(r))}{if(!(n instanceof Ke||n instanceof Wn))throw new F(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(de.fromString(e,...t));return gf(r),new Ke(n.firestore,n instanceof Wn?n.converter:null,new q(r))}}function Tf(n,e){return n=(0,ie.m9)(n),e=(0,ie.m9)(e),(n instanceof Ke||n instanceof Wn)&&(e instanceof Ke||e instanceof Wn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function fh(n,e){return n=(0,ie.m9)(n),e=(0,ie.m9)(e),n instanceof Pt&&e instanceof Pt&&n.firestore===e.firestore&&Ki(n._query,e._query)&&n.converter===e.converter}function bf(n,e=10240){let t=0;return{read:()=>(0,I.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,I.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Uu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):He("Uncaught Error in snapshot listener:",e)}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class mg{constructor(e,t){this.Pc=e,this.It=t,this.metadata=new et,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.payload)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,I.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,I.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,I.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),i=Number(r);isNaN(i)&&e.Dc(`length string (${r}) is not valid number`);const s=yield e.Cc(i);return new $m(JSON.parse(s),t.length+i)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,I.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,I.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,I.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class _g{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,I.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new F(D.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,I.Z)(function*(s,u){const l=G(s),d=ma(l.It)+"/documents",f={documents:u.map(C=>pa(l.It,C))},g=yield l._o("BatchGetDocuments",d,f,u.length),_=new Map;g.forEach(C=>{const P=function yp(n,e){return"found"in e?function(t,r){re(!!r.found);const i=Kn(t,r.found.name),s=mt(r.found.updateTime),u=new ht({mapValue:{fields:r.found.fields}});return Pe.newFoundDocument(i,s,u)}(n,e):"missing"in e?function(t,r){re(!!r.missing),re(!!r.readTime);const i=Kn(t,r.missing),s=mt(r.readTime);return Pe.newNoDocument(i,s)}(n,e):z()}(l.It,C);_.set(P.key.toString(),P)});const T=[];return u.forEach(C=>{const P=_.get(C.toString());re(!!P),T.push(P)}),T}),function(s,u){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new R(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,I.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=q.fromPath(i);e.mutations.push(new j(s,e.precondition(s)))}),yield(r=(0,I.Z)(function*(i,s){const u=G(i),l=ma(u.It)+"/documents",d={writes:s.map(f=>ga(u.It,f))};yield u.ao("Commit",l,d)}),function(i,s){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=ee.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new F(D.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ee.min())?qe.exists(!1):qe.updateTime(t):qe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ee.min()))throw new F(D.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return qe.updateTime(t)}return qe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class vg{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.kc=r.maxAttempts,this.No=new pl(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.No.Ro((0,I.Z)(function*(){const t=new _g(e.datastore),r=e.Mc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Fc(s)}))}).catch(i=>{e.Fc(i)})}))}Mc(e){try{const t=this.updateFunction(e);return!Bi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!nn(t)}return!1}}class Ig{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=ct.UNAUTHENTICATED,this.clientId=$s.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,I.Z)(function*(l){U("FirestoreClient","Received user=",l.uid),yield s.authCredentialListener(l),s.user=l});return function(l){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(U("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,I.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new F(D.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,I.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=go(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function Sf(n,e){return ph.apply(this,arguments)}function ph(){return ph=(0,I.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),U("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,I.Z)(function*(s){r.isEqual(s)||(yield Fd(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),ph.apply(this,arguments)}function Af(n,e){return mh.apply(this,arguments)}function mh(){return mh=(0,I.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield gh(n);U("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>ef(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>ef(e.remoteStore,s)),n.onlineComponents=e}),mh.apply(this,arguments)}function gh(n){return yh.apply(this,arguments)}function yh(){return yh=(0,I.Z)(function*(n){return n.offlineComponents||(U("FirestoreClient","Using default OfflineComponentProvider"),yield Sf(n,new ff)),n.offlineComponents}),yh.apply(this,arguments)}function Vu(n){return _h.apply(this,arguments)}function _h(){return _h=(0,I.Z)(function*(n){return n.onlineComponents||(U("FirestoreClient","Using default OnlineComponentProvider"),yield Af(n,new hh)),n.onlineComponents}),_h.apply(this,arguments)}function xf(n){return gh(n).then(e=>e.persistence)}function Bu(n){return gh(n).then(e=>e.localStore)}function vh(n){return Vu(n).then(e=>e.remoteStore)}function Ih(n){return Vu(n).then(e=>e.syncEngine)}function Io(n){return wh.apply(this,arguments)}function wh(){return wh=(0,I.Z)(function*(n){const e=yield Vu(n),t=e.eventManager;return t.onListen=Zm.bind(null,e.syncEngine),t.onUnlisten=Qm.bind(null,e.syncEngine),t}),wh.apply(this,arguments)}function Nf(n,e,t={}){const r=new et;return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(i,s,u,l,d){const f=new Uu({next:_=>{s.enqueueAndForget(()=>Ml(i,g));const T=_.docs.has(u);!T&&_.fromCache?d.reject(new F(D.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&_.fromCache&&l&&"server"===l.source?d.reject(new F(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Vl(Kr(u.path),f,{includeMetadataChanges:!0,ku:!0});return Pl(i,g)}(yield Io(n),n.asyncQueue,e,t,r)})),r.promise}function kf(n,e,t={}){const r=new et;return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function(i,s,u,l,d){const f=new Uu({next:_=>{s.enqueueAndForget(()=>Ml(i,g)),_.fromCache&&"server"===l.source?d.reject(new F(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(_)},error:_=>d.reject(_)}),g=new Vl(u,f,{includeMetadataChanges:!0,ku:!0});return Pl(i,g)}(yield Io(n),n.asyncQueue,e,t,r)})),r.promise}class Dg{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.Uc=!1,this.qc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.No=new pl(this,"async_queue_retry"),this.Wc=()=>{const t=Ou();t&&U("AsyncQueue","Visibility state changed to "+t.visibilityState),this.No.Po()};const e=Ou();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.Uc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.Uc){this.Uc=!0,this.Qc=e||!1;const t=Ou();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.Uc)return new Promise(()=>{});const t=new et;return this.Hc(()=>this.Uc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,I.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.No.reset()}catch(t){if(!en(t))throw t;U("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.No.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,He("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const i=Ol.createAndSchedule(this,e,t,r,s=>this.Yc(s));return this.qc.push(i),i}zc(){this.Kc&&z()}verifyOperationInProgress(){}Xc(){var e=this;return(0,I.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.qc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.qc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.qc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.qc.indexOf(e);this.qc.splice(t,1)}}function Eh(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class Ng{constructor(){this._progressObserver={},this._taskCompletionResolver=new et,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ze extends Da{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Dg,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Cf(this),this._firestoreClient.terminate()}}function tt(n){return n._firestoreClient||Cf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Cf(n){var e;const t=n._freezeSettings(),r=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Wo(n._databaseId,s,n._persistenceKey,(l=t).host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,l.useFetchStreams));var s,l;n._firestoreClient=new Ig(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Rf(n,e,t){const r=new et;return n.asyncQueue.enqueue((0,I.Z)(function*(){try{yield Sf(n,t),yield Af(n,e),r.resolve()}catch(i){const s=i;if(!("FirebaseError"===(u=s).name?u.code===D.FAILED_PRECONDITION||u.code===D.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;ur("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var u})).then(()=>r.promise)}function Of(n){if(n._initialized||n._terminated)throw new F(D.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Hn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hn(st.fromBase64String(e))}catch(t){throw new F(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Hn(st.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new F(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ke(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ns{constructor(e){this._methodName=e}}class qu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new F(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new F(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return se(this._lat,e._lat)||se(this._long,e._long)}}const Vg=/^__.*__$/;class Bg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new h(e,this.data,this.fieldMask,t,this.fieldTransforms):new a(e,this.data,t,this.fieldTransforms)}}class Pf{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new h(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Lf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}class Gu{constructor(e,t,r,i,s,u){this.settings=e,this.databaseId=t,this.It=r,this.ignoreUndefinedProperties=i,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Gu(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Ku(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Lf(this.sa)&&Vg.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class qg{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.It=r||Sa(e)}da(e,t,r,i=!1){return new Gu({sa:e,methodName:t,fa:r,path:ke.emptyPath(),oa:!1,la:i},this.databaseId,this.It,this.ignoreUndefinedProperties)}}function rs(n){const e=n._freezeSettings(),t=Sa(n._databaseId);return new qg(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ju(n,e,t,r,i,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,i);Ah("Data must be an object, but it was:",u,r);const l=Uf(r,u);let d,f;if(s.merge)d=new Ht(u.fieldMask),f=u.fieldTransforms;else if(s.mergeFields){const g=[];for(const _ of s.mergeFields){const T=xh(e,_,t);if(!u.contains(T))throw new F(D.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);Bf(g,T)||g.push(T)}d=new Ht(g),f=u.fieldTransforms.filter(_=>d.covers(_.field))}else d=null,f=u.fieldTransforms;return new Bg(new ht(l),d,f)}class Na extends ns{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Na}}function Mf(n,e,t){return new Gu({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.It,e.ignoreUndefinedProperties)}class Th extends ns{_toFieldTransform(e){return new Hr(e.path,new Wr)}isEqual(e){return e instanceof Th}}class Gg extends ns{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Mf(this,e,!0),r=this._a.map(s=>is(s,t)),i=new En(r);return new Hr(e.path,i)}isEqual(e){return this===e}}class jg extends ns{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Mf(this,e,!0),r=this._a.map(s=>is(s,t)),i=new gr(r);return new Hr(e.path,i)}isEqual(e){return this===e}}class $g extends ns{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new yr(e.It,pu(e.It,this.wa));return new Hr(e.path,t)}isEqual(e){return this===e}}function bh(n,e,t,r){const i=n.da(1,e,t);Ah("Data must be an object, but it was:",i,r);const s=[],u=ht.empty();lr(r,(d,f)=>{const g=$u(e,d,t);f=(0,ie.m9)(f);const _=i.ca(g);if(f instanceof Na)s.push(g);else{const T=is(f,_);null!=T&&(s.push(g),u.set(g,T))}});const l=new Ht(s);return new Pf(u,l,i.fieldTransforms)}function Sh(n,e,t,r,i,s){const u=n.da(1,e,t),l=[xh(e,r,t)],d=[i];if(s.length%2!=0)throw new F(D.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<s.length;T+=2)l.push(xh(e,s[T])),d.push(s[T+1]);const f=[],g=ht.empty();for(let T=l.length-1;T>=0;--T)if(!Bf(f,l[T])){const C=l[T];let P=d[T];P=(0,ie.m9)(P);const $=u.ca(C);if(P instanceof Na)f.push(C);else{const H=is(P,$);null!=H&&(f.push(C),g.set(C,H))}}const _=new Ht(f);return new Pf(g,_,u.fieldTransforms)}function Ff(n,e,t,r=!1){return is(t,n.da(r?4:3,e))}function is(n,e){if(Vf(n=(0,ie.m9)(n)))return Ah("Unsupported field value:",e,n),Uf(n,e);if(n instanceof ns)return function(t,r){if(!Lf(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const u of t){let l=is(u,r.aa(s));null==l&&(l={nullValue:"NULL_VALUE"}),i.push(l),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,ie.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return pu(r.It,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=Ve.fromDate(t);return{timestampValue:fa(r.It,i)}}if(t instanceof Ve){const i=new Ve(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:fa(r.It,i)}}if(t instanceof qu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hn)return{bytesValue:Hh(r.It,t._byteString)};if(t instanceof Ke){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:$c(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${Mu(t)}`)}(n,e)}function Uf(n,e){const t={};return jo(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):lr(n,(r,i)=>{const s=is(i,e.ra(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Vf(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Ve||n instanceof qu||n instanceof Hn||n instanceof Ke||n instanceof ns)}function Ah(n,e,t){if(!Vf(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Mu(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function xh(n,e,t){if((e=(0,ie.m9)(e))instanceof wr)return e._internalPath;if("string"==typeof e)return $u(n,e);throw Ku("Field path arguments must be of type string or ",n,!1,void 0,t)}const Kg=new RegExp("[~\\*/\\[\\]]");function $u(n,e,t){if(e.search(Kg)>=0)throw Ku(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new wr(...e.split("."))._internalPath}catch(r){throw Ku(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ku(n,e,t,r,i){const s=r&&!r.isEmpty(),u=void 0!==i;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let d="";return(s||u)&&(d+=" (found",s&&(d+=` in field ${r}`),u&&(d+=` in document ${i}`),d+=")"),new F(D.INVALID_ARGUMENT,l+n+d)}function Bf(n,e){return n.some(t=>t.isEqual(e))}class ka{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ke(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new zg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(zu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class zg extends ka{data(){return super.data()}}function zu(n,e){return"string"==typeof e?$u(n,e):e instanceof wr?e._internalPath:e._delegate._internalPath}function qf(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new F(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ca{}function ei(n,...e){for(const t of e)n=t._apply(n);return n}class Wg extends Ca{constructor(e,t,r){super(),this.ma=e,this.ga=t,this.ya=r,this.type="where"}_apply(e){const t=rs(e.firestore),r=function(i,s,u,l,d,f,g){let _;if(d.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new F(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){Wf(g,f);const C=[];for(const P of g)C.push(zf(l,i,P));_={arrayValue:{values:C}}}else _=zf(l,i,g)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||Wf(g,f),_=Ff(u,"where",g,"in"===f||"not-in"===f);const T=ot.create(d,f,_);return function(C,P){if(P.dt()){const H=na(C);if(null!==H&&!H.isEqual(P.field))throw new F(D.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${H.toString()}' and '${P.field.toString()}'`);const be=ta(C);null!==be&&Hf(0,P.field,be)}const $=function(H,be){for(const Ge of H.filters)if(be.indexOf(Ge.op)>=0)return Ge.op;return null}(C,function(H){switch(H){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(P.op));if(null!==$)throw new F(D.INVALID_ARGUMENT,$===P.op?`Invalid query. You cannot use more than one '${P.op.toString()}' filter.`:`Invalid query. You cannot use '${P.op.toString()}' filters with '${$.toString()}' filters.`)}(i,T),T}(e._query,0,t,e.firestore._databaseId,this.ma,this.ga,this.ya);return new Pt(e.firestore,e.converter,function(i,s){const u=i.filters.concat([s]);return new wn(i.path,i.collectionGroup,i.explicitOrderBy.slice(),u,i.limit,i.limitType,i.startAt,i.endAt)}(e._query,r))}}class Zg extends Ca{constructor(e,t){super(),this.ma=e,this.pa=t,this.type="orderBy"}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new F(D.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new F(D.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new $r(i,s);return function(l,d){if(null===ta(l)){const f=na(l);null!==f&&Hf(0,f,d.field)}}(r,u),u}(e._query,this.ma,this.pa);return new Pt(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new wn(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Gf extends Ca{constructor(e,t,r){super(),this.type=e,this.Ia=t,this.Ta=r}_apply(e){return new Pt(e.firestore,e.converter,to(e._query,this.Ia,this.Ta))}}class jf extends Ca{constructor(e,t,r){super(),this.type=e,this.Ea=t,this.Aa=r}_apply(e){const t=Kf(e,this.type,this.Ea,this.Aa);return new Pt(e.firestore,e.converter,(i=t,new wn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class $f extends Ca{constructor(e,t,r){super(),this.type=e,this.Ea=t,this.Aa=r}_apply(e){const t=Kf(e,this.type,this.Ea,this.Aa);return new Pt(e.firestore,e.converter,(i=t,new wn((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function Kf(n,e,t,r){if(t[0]=(0,ie.m9)(t[0]),t[0]instanceof ka)return function(i,s,u,l,d){if(!l)throw new F(D.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const g of zr(i))if(g.field.isKeyField())f.push(dr(s,l.key));else{const _=l.data.field(g.field);if(Vi(_))throw new F(D.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const T=g.field.canonicalString();throw new F(D.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(_)}return new $n(f,d)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=rs(n.firestore);return function(s,u,l,d,f,g){const _=s.explicitOrderBy;if(f.length>_.length)throw new F(D.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const T=[];for(let C=0;C<f.length;C++){const P=f[C];if(_[C].field.isKeyField()){if("string"!=typeof P)throw new F(D.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof P}`);if(!ra(s)&&-1!==P.indexOf("/"))throw new F(D.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${P}' contains a slash.`);const $=s.path.child(de.fromString(P));if(!q.isDocumentKey($))throw new F(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${$}' is not because it contains an odd number of segments.`);const H=new q($);T.push(dr(u,H))}else{const $=Ff(l,d,P);T.push($)}}return new $n(T,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function zf(n,e,t){if("string"==typeof(t=(0,ie.m9)(t))){if(""===t)throw new F(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ra(e)&&-1!==t.indexOf("/"))throw new F(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(de.fromString(t));if(!q.isDocumentKey(r))throw new F(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return dr(n,new q(r))}if(t instanceof Ke)return dr(n,t._key);throw new F(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Mu(t)}.`)}function Wf(n,e){if(!Array.isArray(n)||0===n.length)throw new F(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new F(D.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Hf(n,e,t){if(!t.isEqual(e))throw new F(D.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Dh{convertValue(e,t="none"){switch(hr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Br(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw z()}}convertObject(e,t){const r={};return lr(e.fields,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new qu(Be(e.latitude),Be(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Ec(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(tn(e));default:return null}}convertTimestamp(e){const t=ln(e);return new Ve(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=de.fromString(e);re(rd(r));const i=new Gn(r.get(1),r.get(3)),s=new q(r.popFirst(5));return i.isEqual(t)||He(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Wu(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class ry extends Dh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ke(this.firestore,null,t)}}class ss{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Er extends ka{constructor(e,t,r,i,s,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ra(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(zu("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Ra extends Er{data(e={}){return super.data(e)}}class ti{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ss(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ra(this._firestore,this._userDataWriter,r.key,r,new ss(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new F(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Ra(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ss(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const l=new Ra(r._firestore,r._userDataWriter,u.doc.key,u.doc,new ss(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let d=-1,f=-1;return 0!==u.type&&(d=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),f=s.indexOf(u.doc.key)),{type:iy(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function iy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function Zf(n,e){return n instanceof Er&&e instanceof Er?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof ti&&e instanceof ti&&n._firestore===e._firestore&&fh(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class ni extends Dh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ke(this.firestore,null,t)}}function Qf(n,e,t){n=ge(n,Ke);const r=ge(n.firestore,ze),i=Wu(n.converter,e,t);return wo(r,[ju(rs(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,qe.none())])}function Yf(n,e,t,...r){n=ge(n,Ke);const i=ge(n.firestore,ze),s=rs(i);let u;return u="string"==typeof(e=(0,ie.m9)(e))||e instanceof wr?Sh(s,"updateDoc",n._key,e,t,r):bh(s,"updateDoc",n._key,e),wo(i,[u.toMutation(n._key,qe.exists(!0))])}function Xf(n,...e){var t,r,i;n=(0,ie.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Eh(e[u])||(s=e[u],u++);const l={includeMetadataChanges:s.includeMetadataChanges};if(Eh(e[u])){const _=e[u];e[u]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[u+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[u+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let d,f,g;if(n instanceof Ke)f=ge(n.firestore,ze),g=Kr(n._key.path),d={next:_=>{e[u]&&e[u](Nh(f,n,_))},error:e[u+1],complete:e[u+2]};else{const _=ge(n,Pt);f=ge(_.firestore,ze),g=_._query;const T=new ni(f);d={next:C=>{e[u]&&e[u](new ti(f,T,_,C))},error:e[u+1],complete:e[u+2]},qf(n._query)}return function(_,T,C,P){const $=new Uu(P),H=new Vl(T,$,C);return _.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return Pl(yield Io(_),H)})),()=>{$.bc(),_.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return Ml(yield Io(_),H)}))}}(tt(f),g,l,d)}function wo(n,e){return function(t,r){const i=new et;return t.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function Ym(n,e,t){return $l.apply(this,arguments)}(yield Ih(t),r,i)})),i.promise}(tt(n),e)}function Nh(n,e,t){const r=t.docs.get(e._key),i=new ni(n);return new Er(n,i,e._key,r,new ss(t.hasPendingWrites,t.fromCache),e.converter)}const py={maxAttempts:5};class Jf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rs(e)}set(e,t,r){this._verifyNotCommitted();const i=ri(e,this._firestore),s=Wu(i.converter,t,r),u=ju(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,qe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=ri(e,this._firestore);let u;return u="string"==typeof(t=(0,ie.m9)(t))||t instanceof wr?Sh(this._dataReader,"WriteBatch.update",s._key,t,r,i):bh(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,qe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ri(e,this._firestore);return this._mutations=this._mutations.concat(new R(t._key,qe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new F(D.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ri(n,e){if((n=(0,ie.m9)(n)).firestore!==e)throw new F(D.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class my extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=rs(e)}get(e){const t=ri(e,this._firestore),r=new ry(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return z();const s=i[0];if(s.isFoundDocument())return new ka(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new ka(this._firestore,r,t._key,null,t.converter);throw z()})}set(e,t,r){const i=ri(e,this._firestore),s=Wu(i.converter,t,r),u=ju(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const s=ri(e,this._firestore);let u;return u="string"==typeof(t=(0,ie.m9)(t))||t instanceof wr?Sh(this._dataReader,"Transaction.update",s._key,t,r,i):bh(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=ri(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ri(e,this._firestore),r=new ni(this._firestore);return super.get(e).then(i=>new Er(this._firestore,r,t._key,i._document,new ss(!1,!1),t.converter))}}function kh(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new F("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function tp(){if("undefined"==typeof Uint8Array)throw new F("unimplemented","Uint8Arrays are not available in this environment.")}function np(){if(!function Ko(){return"undefined"!=typeof atob}())throw new F("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Fn=ne.SDK_VERSION,(0,ne._registerComponent)(new le.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),u=new ze(new Ya(t.getProvider("auth-internal")),new mc(t.getProvider("app-check-internal")),function(l,d){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new F(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Gn(l.options.projectId,d)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,ne.registerVersion)(lc,"3.7.1",n),(0,ne.registerVersion)(lc,"3.7.1","esm2017")}();class Oa{constructor(e){this._delegate=e}static fromBase64String(e){return np(),new Oa(Hn.fromBase64String(e))}static fromUint8Array(e){return tp(),new Oa(Hn.fromUint8Array(e))}toBase64(){return np(),this._delegate.toBase64()}toUint8Array(){return tp(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ch(n){return function by(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class Sy{enableIndexedDbPersistence(e,t){return function Cg(n,e){Of(n=ge(n,ze));const t=tt(n),r=n._freezeSettings(),i=new hh;return Rf(t,i,new pf(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Rg(n){Of(n=ge(n,ze));const e=tt(n),t=n._freezeSettings(),r=new hh;return Rf(e,r,new fg(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Og(n){if(n._initialized&&!n._terminated)throw new F(D.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new et;return n._queue.enqueueAndForgetEvenWhileRestricted((0,I.Z)(function*(){try{yield(t=(0,I.Z)(function*(r){if(!Wt.C())return Promise.resolve();const i=r+"main";yield Wt.delete(i)}),function(r){return t.apply(this,arguments)})(il(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class rp{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Gn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&ur("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function wf(n,e,t,r={}){var i;const s=(n=ge(n,Da))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,l;if("string"==typeof r.mockUserToken)u=r.mockUserToken,l=ct.MOCK_USER;else{u=(0,ie.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new F(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new ct(d)}n._authCredentials=new Gh(new hc(u,l))}}(this._delegate,e,t,r)}enableNetwork(){return function Lg(n){return function wg(n){return n.asyncQueue.enqueue((0,I.Z)(function*(){const e=yield xf(n),t=yield vh(n);return e.setNetworkEnabled(!0),function(r){const i=G(r);return i.wu.delete(0),Aa(i)}(t)}))}(tt(n=ge(n,ze)))}(this._delegate)}disableNetwork(){return function Mg(n){return function Eg(n){return n.asyncQueue.enqueue((0,I.Z)(function*(){const e=yield xf(n),t=yield vh(n);return e.setNetworkEnabled(!1),(r=(0,I.Z)(function*(i){const s=G(i);s.wu.add(0),yield fo(s),s.yu.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(tt(n=ge(n,ze)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,mf("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Pg(n){return function(e){const t=new et;return e.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return function tg(n,e){return Zl.apply(this,arguments)}(yield Ih(e),t)})),t.promise}(tt(n=ge(n,ze)))}(this._delegate)}onSnapshotsInSync(e){return function fy(n,e){return function Sg(n,e){const t=new Uu(e);return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return r=yield Io(n),i=t,G(r).bu.add(i),void i.next();var r,i})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return r=yield Io(n),i=t,void G(r).bu.delete(i);var r,i}))}}(tt(n=ge(n,ze)),Eh(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new F("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Eo(this,Ef(this._delegate,e))}catch(t){throw Vt(t,"collection()","Firestore.collection()")}}doc(e){try{return new dn(this,Fu(this._delegate,e))}catch(t){throw Vt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Bt(this,function pg(n,e){if(n=ge(n,Da),dh("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new F(D.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Pt(n,null,(t=e,new wn(de.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Vt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function gy(n,e,t){n=ge(n,ze);const r=Object.assign(Object.assign({},py),t);return function(i){if(i.maxAttempts<1)throw new F(D.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,u){const l=new et;return i.asyncQueue.enqueueAndForget((0,I.Z)(function*(){const d=yield function Df(n){return Vu(n).then(e=>e.datastore)}(i);new vg(i.asyncQueue,d,u,s,l).run()})),l.promise}(tt(n),i=>e(new my(n,i)),r)}(this._delegate,t=>e(new ip(this,t)))}batch(){return tt(this._delegate),new sp(new Jf(this._delegate,e=>wo(this._delegate,e)))}loadBundle(e){return function Fg(n,e){const t=tt(n=ge(n,ze)),r=new Ng;return function Ag(n,e,t,r){const i=function(s,u){let l;return l="string"==typeof s?(new TextEncoder).encode(s):s,d=function(d,f){if(d instanceof Uint8Array)return bf(d,f);if(d instanceof ArrayBuffer)return bf(new Uint8Array(d),f);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),new mg(d,u);var d}(t,Sa(e));n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){!function dg(n,e,t){const r=G(n);var i;(i=(0,I.Z)(function*(s,u,l){try{const d=yield u.getMetadata();if(yield function(T,C){const P=G(T),$=mt(C.createTime);return P.persistence.runTransaction("hasNewerBundle","readonly",H=>P.Ns.getBundleMetadata(H,C.id)).then(H=>!!H&&H.createTime.compareTo($)>=0)}(s.localStore,d))return yield u.close(),l._completeWith({taskState:"Success",documentsLoaded:(T=d).totalDocuments,bytesLoaded:T.totalBytes,totalDocuments:T.totalDocuments,totalBytes:T.totalBytes}),Promise.resolve(new Set);l._updateProgress(rf(d));const f=new Km(d,s.localStore,u.It);let g=yield u.mc();for(;g;){const T=yield f.Fu(g);T&&l._updateProgress(T),g=yield u.mc()}const _=yield f.complete();return yield Ir(s,_.Lu,void 0),yield function(T,C){const P=G(T);return P.persistence.runTransaction("Save bundle","readwrite",$=>P.Ns.saveBundleMetadata($,C))}(s.localStore,d),l._completeWith(_.progress),Promise.resolve(_.Bu)}catch(d){return ur("SyncEngine",`Loading bundle failed with ${d}`),l._failWith(d),Promise.resolve(new Set)}var T}),function(s,u,l){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Ih(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Ug(n,e){return function xg(n,e){return n.asyncQueue.enqueue((0,I.Z)(function*(){return function(t,r){const i=G(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.Ns.getNamedQuery(s,r))}(yield Bu(n),e)}))}(tt(n=ge(n,ze)),e).then(t=>t?new Pt(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Bt(this,t):null)}}class Hu extends Dh{constructor(e){super(),this.firestore=e}convertBytes(e){return new Oa(new Hn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return dn.forKey(t,this.firestore,null)}}class ip{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Hu(e)}get(e){const t=as(e);return this._delegate.get(t).then(r=>new Pa(this._firestore,new Er(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=as(e);return r?(kh("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=as(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=as(e);return this._delegate.delete(t),this}}class sp{constructor(e){this._delegate=e}set(e,t,r){const i=as(e);return r?(kh("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=as(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=as(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class os{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Ra(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new La(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=os.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new os(e,new Hu(e),t),i.set(t,s)),s}}os.INSTANCES=new WeakMap;class dn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Hu(e)}static forPath(e,t,r){if(e.length%2!=0)throw new F("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new dn(t,new Ke(t._delegate,r,new q(e)))}static forKey(e,t,r){return new dn(t,new Ke(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Eo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Eo(this.firestore,Ef(this._delegate,e))}catch(t){throw Vt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ie.m9)(e))instanceof Ke&&Tf(this._delegate,e)}set(e,t){t=kh("DocumentReference.set",t);try{return t?Qf(this._delegate,e,t):Qf(this._delegate,e)}catch(r){throw Vt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Yf(this._delegate,e):Yf(this._delegate,e,t,...r)}catch(i){throw Vt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function hy(n){return wo(ge(n.firestore,ze),[new R(n._key,qe.none())])}(this._delegate)}onSnapshot(...e){const t=op(e),r=ap(e,i=>new Pa(this.firestore,new Er(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Xf(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function oy(n){n=ge(n,Ke);const e=ge(n.firestore,ze),t=tt(e),r=new ni(e);return function Tg(n,e){const t=new et;return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return(r=(0,I.Z)(function*(i,s,u){try{const l=yield function(d,f){const g=G(d);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,f))}(i,s);l.isFoundDocument()?u.resolve(l):l.isNoDocument()?u.resolve(null):u.reject(new F(D.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const d=go(l,`Failed to get document '${s} from cache`);u.reject(d)}}),function(i,s,u){return r.apply(this,arguments)})(yield Bu(n),e,t);var r})),t.promise}(t,n._key).then(i=>new Er(e,r,n._key,i,new ss(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function ay(n){n=ge(n,Ke);const e=ge(n.firestore,ze);return Nf(tt(e),n._key,{source:"server"}).then(t=>Nh(e,n,t))}(this._delegate):function sy(n){n=ge(n,Ke);const e=ge(n.firestore,ze);return Nf(tt(e),n._key).then(t=>Nh(e,n,t))}(this._delegate),t.then(r=>new Pa(this.firestore,new Er(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new dn(this.firestore,this._delegate.withConverter(e?os.getInstance(this.firestore,e):null))}}function Vt(n,e,t){return n.message=n.message.replace(e,t),n}function op(n){for(const e of n)if("object"==typeof e&&!Ch(e))return e;return{}}function ap(n,e){var t,r;let i;return i=Ch(n[0])?n[0]:Ch(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Pa{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new dn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Zf(this._delegate,e._delegate)}}class La extends Pa{data(e){const t=this._delegate.data(e);return function js(n,e){n||z()}(void 0!==t),t}}class Bt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Hu(e)}where(e,t,r){try{return new Bt(this.firestore,ei(this._delegate,function Hg(n,e,t){const r=e,i=zu("where",n);return new Wg(i,r,t)}(e,t,r)))}catch(i){throw Vt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Bt(this.firestore,ei(this._delegate,function Qg(n,e="asc"){const t=e,r=zu("orderBy",n);return new Zg(r,t)}(e,t)))}catch(r){throw Vt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Bt(this.firestore,ei(this._delegate,function Yg(n){return _f("limit",n),new Gf("limit",n,"F")}(e)))}catch(t){throw Vt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Bt(this.firestore,ei(this._delegate,function Xg(n){return _f("limitToLast",n),new Gf("limitToLast",n,"L")}(e)))}catch(t){throw Vt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Bt(this.firestore,ei(this._delegate,function Jg(...n){return new jf("startAt",n,!0)}(...e)))}catch(t){throw Vt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Bt(this.firestore,ei(this._delegate,function ey(...n){return new jf("startAfter",n,!1)}(...e)))}catch(t){throw Vt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Bt(this.firestore,ei(this._delegate,function ty(...n){return new $f("endBefore",n,!1)}(...e)))}catch(t){throw Vt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Bt(this.firestore,ei(this._delegate,function ny(...n){return new $f("endAt",n,!0)}(...e)))}catch(t){throw Vt(t,"endAt()","Query.endAt()")}}isEqual(e){return fh(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function cy(n){n=ge(n,Pt);const e=ge(n.firestore,ze),t=tt(e),r=new ni(e);return function bg(n,e){const t=new et;return n.asyncQueue.enqueueAndForget((0,I.Z)(function*(){return(r=(0,I.Z)(function*(i,s,u){try{const l=yield ku(i,s,!0),d=new af(s,l.Hi),f=d.Wu(l.documents),g=d.applyChanges(f,!1);u.resolve(g.snapshot)}catch(l){const d=go(l,`Failed to execute query '${s} against cache`);u.reject(d)}}),function(i,s,u){return r.apply(this,arguments)})(yield Bu(n),e,t);var r})),t.promise}(t,n._query).then(i=>new ti(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function ly(n){n=ge(n,Pt);const e=ge(n.firestore,ze),t=tt(e),r=new ni(e);return kf(t,n._query,{source:"server"}).then(i=>new ti(e,r,n,i))}(this._delegate):function uy(n){n=ge(n,Pt);const e=ge(n.firestore,ze),t=tt(e),r=new ni(e);return qf(n._query),kf(t,n._query).then(i=>new ti(e,r,n,i))}(this._delegate),t.then(r=>new Rh(this.firestore,new ti(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=op(e),r=ap(e,i=>new Rh(this.firestore,new ti(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Xf(this._delegate,t,r)}withConverter(e){return new Bt(this.firestore,this._delegate.withConverter(e?os.getInstance(this.firestore,e):null))}}class xy{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new La(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Rh{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Bt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new La(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new xy(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new La(this._firestore,r))})}isEqual(e){return Zf(this._delegate,e._delegate)}}class Eo extends Bt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new dn(this.firestore,e):null}doc(e){try{return new dn(this.firestore,void 0===e?Fu(this._delegate):Fu(this._delegate,e))}catch(t){throw Vt(t,"doc()","CollectionReference.doc()")}}add(e){return function dy(n,e){const t=ge(n.firestore,ze),r=Fu(n),i=Wu(n.converter,e);return wo(t,[ju(rs(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,qe.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new dn(this.firestore,t))}isEqual(e){return Tf(this._delegate,e._delegate)}withConverter(e){return new Eo(this.firestore,this._delegate.withConverter(e?os.getInstance(this.firestore,e):null))}}function as(n){return ge(n,Ke)}class Oh{constructor(...e){this._delegate=new wr(...e)}static documentId(){return new Oh(ke.keyField().canonicalString())}isEqual(e){return(e=(0,ie.m9)(e))instanceof wr&&this._delegate._internalPath.isEqual(e._internalPath)}}class us{constructor(e){this._delegate=e}static serverTimestamp(){const e=function _y(){return new Th("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new us(e)}static delete(){const e=function yy(){return new Na("deleteField")}();return e._methodName="FieldValue.delete",new us(e)}static arrayUnion(...e){const t=function vy(...n){return new Gg("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new us(t)}static arrayRemove(...e){const t=function Iy(...n){return new jg("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new us(t)}static increment(e){const t=function wy(n){return new $g("increment",n)}(e);return t._methodName="FieldValue.increment",new us(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Dy={Firestore:rp,GeoPoint:qu,Timestamp:Ve,Blob:Oa,Transaction:ip,WriteBatch:sp,DocumentReference:dn,DocumentSnapshot:Pa,Query:Bt,QueryDocumentSnapshot:La,QuerySnapshot:Rh,CollectionReference:Eo,FieldPath:Oh,FieldValue:us,setLogLevel:function Ay(n){!function qh(n){Rt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function ky(n){(function Ny(n,e){n.INTERNAL.registerComponent(new le.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},Dy)))})(n,(e,t)=>new rp(e,t,new Sy)),n.registerVersion("@firebase/firestore-compat","0.2.1")}(x.Z)},3942:(nt,_e,X)=>{X.d(_e,{Z:()=>vt});var x=X(2090),I=X(4859),ne=X(6881),le=X(1877);class Ce{constructor(pe,me){this._delegate=pe,this.firebase=me,(0,ne._addComponent)(pe,new I.wA("app-compat",()=>this,"PUBLIC")),this.container=pe.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(pe){this._delegate.automaticDataCollectionEnabled=pe}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(pe=>{this._delegate.checkDestroyed(),pe()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),(0,ne.deleteApp)(this._delegate)))}_getService(pe,me=ne._DEFAULT_ENTRY_NAME){var At;this._delegate.checkDestroyed();const ce=this._delegate.container.getProvider(pe);return!ce.isInitialized()&&"EXPLICIT"===(null===(At=ce.getComponent())||void 0===At?void 0:At.instantiationMode)&&ce.initialize(),ce.getImmediate({identifier:me})}_removeServiceInstance(pe,me=ne._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(pe).clearInstance(me)}_addComponent(pe){(0,ne._addComponent)(this._delegate,pe)}_addOrOverwriteComponent(pe){(0,ne._addOrOverwriteComponent)(this._delegate,pe)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const at=new x.LL("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),L=function B(){const Se=function Re(Se){const pe={},me={__esModule:!0,initializeApp:function Ae(M,je={}){const we=ne.initializeApp(M,je);if((0,x.r3)(pe,we.name))return pe[we.name];const xt=new Se(we,me);return pe[we.name]=xt,xt},app:ce,registerVersion:ne.registerVersion,setLogLevel:ne.setLogLevel,onLog:ne.onLog,apps:null,SDK_VERSION:ne.SDK_VERSION,INTERNAL:{registerComponent:function Xe(M){const je=M.name,we=je.replace("-compat","");if(ne._registerComponent(M)&&"PUBLIC"===M.type){const xt=(ye=ce())=>{if("function"!=typeof ye[we])throw at.create("invalid-app-argument",{appName:je});return ye[we]()};void 0!==M.serviceProps&&(0,x.ZB)(xt,M.serviceProps),me[we]=xt,Se.prototype[we]=function(...ye){return this._getService.bind(this,je).apply(this,M.multipleInstances?ye:[])}}return"PUBLIC"===M.type?me[we]:null},removeApp:function At(M){delete pe[M]},useAsService:function bn(M,je){return"serverAuth"===je?null:je},modularAPIs:ne}};function ce(M){if(!(0,x.r3)(pe,M=M||ne._DEFAULT_ENTRY_NAME))throw at.create("no-app",{appName:M});return pe[M]}return me.default=me,Object.defineProperty(me,"apps",{get:function Oe(){return Object.keys(pe).map(M=>pe[M])}}),ce.App=Se,me}(Ce);return Se.INTERNAL=Object.assign(Object.assign({},Se.INTERNAL),{createFirebaseNamespace:B,extendNamespace:function pe(me){(0,x.ZB)(Se,me)},createSubscribe:x.ne,ErrorFactory:x.LL,deepExtend:x.ZB}),Se}(),N=new le.Yd("@firebase/app-compat");if((0,x.jU)()&&void 0!==self.firebase){N.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const Se=self.firebase.SDK_VERSION;Se&&Se.indexOf("LITE")>=0&&N.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const vt=L;!function ve(Se){(0,ne.registerVersion)("@firebase/app-compat","0.1.37",Se)}()},6881:(nt,_e,X)=>{X.r(_e),X.d(_e,{FirebaseError:()=>le.ZR,SDK_VERSION:()=>oi,_DEFAULT_ENTRY_NAME:()=>un,_addComponent:()=>mn,_addOrOverwriteComponent:()=>Cn,_apps:()=>It,_clearComponents:()=>xr,_components:()=>$t,_getProvider:()=>gn,_registerComponent:()=>Ze,_removeServiceInstance:()=>yn,deleteApp:()=>ai,getApp:()=>er,getApps:()=>kr,initializeApp:()=>Rn,onLog:()=>Mt,registerVersion:()=>Lt,setLogLevel:()=>xe});var x=X(5861),I=X(4859),ne=X(1877),le=X(2090);let ie,at;const L=new WeakMap,N=new WeakMap,J=new WeakMap,oe=new WeakMap,ve=new WeakMap;let pe={get(k,b,V){if(k instanceof IDBTransaction){if("done"===b)return N.get(k);if("objectStoreNames"===b)return k.objectStoreNames||J.get(k);if("store"===b)return V.objectStoreNames[1]?void 0:V.objectStore(V.objectStoreNames[0])}return Ae(k[b])},set:(k,b,V)=>(k[b]=V,!0),has:(k,b)=>k instanceof IDBTransaction&&("done"===b||"store"===b)||b in k};function ce(k){return"function"==typeof k?function At(k){return k!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function B(){return at||(at=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(k)?function(...b){return k.apply(Oe(this),b),Ae(L.get(this))}:function(...b){return Ae(k.apply(Oe(this),b))}:function(b,...V){const K=k.call(Oe(this),b,...V);return J.set(K,b.sort?b.sort():[b]),Ae(K)}}(k):(k instanceof IDBTransaction&&function Se(k){if(N.has(k))return;const b=new Promise((V,K)=>{const te=()=>{k.removeEventListener("complete",he),k.removeEventListener("error",Te),k.removeEventListener("abort",Te)},he=()=>{V(),te()},Te=()=>{K(k.error||new DOMException("AbortError","AbortError")),te()};k.addEventListener("complete",he),k.addEventListener("error",Te),k.addEventListener("abort",Te)});N.set(k,b)}(k),((k,b)=>b.some(V=>k instanceof V))(k,function Re(){return ie||(ie=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(k,pe):k)}function Ae(k){if(k instanceof IDBRequest)return function vt(k){const b=new Promise((V,K)=>{const te=()=>{k.removeEventListener("success",he),k.removeEventListener("error",Te)},he=()=>{V(Ae(k.result)),te()},Te=()=>{K(k.error),te()};k.addEventListener("success",he),k.addEventListener("error",Te)});return b.then(V=>{V instanceof IDBCursor&&L.set(V,k)}).catch(()=>{}),ve.set(b,k),b}(k);if(oe.has(k))return oe.get(k);const b=ce(k);return b!==k&&(oe.set(k,b),ve.set(b,k)),b}const Oe=k=>ve.get(k),M=["get","getKey","getAll","getAllKeys","count"],je=["put","add","delete","clear"],we=new Map;function xt(k,b){if(!(k instanceof IDBDatabase)||b in k||"string"!=typeof b)return;if(we.get(b))return we.get(b);const V=b.replace(/FromIndex$/,""),K=b!==V,te=je.includes(V);if(!(V in(K?IDBIndex:IDBObjectStore).prototype)||!te&&!M.includes(V))return;const he=function(){var Te=(0,x.Z)(function*(dt,...Ye){const ls=this.transaction(dt,te?"readwrite":"readonly");let Cr=ls.store;return K&&(Cr=Cr.index(Ye.shift())),(yield Promise.all([Cr[V](...Ye),te&&ls.done]))[0]});return function(Ye){return Te.apply(this,arguments)}}();return we.set(b,he),he}!function me(k){pe=k(pe)}(k=>hp(lp({},k),{get:(b,V,K)=>xt(b,V)||k.get(b,V,K),has:(b,V)=>!!xt(b,V)||k.has(b,V)}));class ye{constructor(b){this.container=b}getPlatformInfoString(){return this.container.getProviders().map(V=>{if(function Tr(k){const b=k.getComponent();return"VERSION"===(null==b?void 0:b.type)}(V)){const K=V.getImmediate();return`${K.library}/${K.version}`}return null}).filter(V=>V).join(" ")}}const qt="@firebase/app",Dt=new ne.Yd("@firebase/app"),un="[DEFAULT]",Ar={[qt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},It=new Map,$t=new Map;function mn(k,b){try{k.container.addComponent(b)}catch(V){Dt.debug(`Component ${b.name} failed to register with FirebaseApp ${k.name}`,V)}}function Cn(k,b){k.container.addOrOverwriteComponent(b)}function Ze(k){const b=k.name;if($t.has(b))return Dt.debug(`There were multiple attempts to register component ${b}.`),!1;$t.set(b,k);for(const V of It.values())mn(V,k);return!0}function gn(k,b){const V=k.container.getProvider("heartbeat").getImmediate({optional:!0});return V&&V.triggerHeartbeat(),k.container.getProvider(b)}function yn(k,b,V=un){gn(k,b).clearInstance(V)}function xr(){$t.clear()}const ut=new le.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Nr{constructor(b,V,K){this._isDeleted=!1,this._options=Object.assign({},b),this._config=Object.assign({},V),this._name=V.name,this._automaticDataCollectionEnabled=V.automaticDataCollectionEnabled,this._container=K,this.container.addComponent(new I.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(b){this.checkDestroyed(),this._automaticDataCollectionEnabled=b}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(b){this._isDeleted=b}checkDestroyed(){if(this.isDeleted)throw ut.create("app-deleted",{appName:this._name})}}const oi="9.12.1";function Rn(k,b={}){let V=k;"object"!=typeof b&&(b={name:b});const K=Object.assign({name:un,automaticDataCollectionEnabled:!1},b),te=K.name;if("string"!=typeof te||!te)throw ut.create("bad-app-name",{appName:String(te)});if(V||(V=(0,le.aH)()),!V)throw ut.create("no-options");const he=It.get(te);if(he){if((0,le.vZ)(V,he.options)&&(0,le.vZ)(K,he.config))return he;throw ut.create("duplicate-app",{appName:te})}const Te=new I.H0(te);for(const Ye of $t.values())Te.addComponent(Ye);const dt=new Nr(V,K,Te);return It.set(te,dt),dt}function er(k=un){const b=It.get(k);if(!b&&k===un)return Rn();if(!b)throw ut.create("no-app",{appName:k});return b}function kr(){return Array.from(It.values())}function ai(k){return Yt.apply(this,arguments)}function Yt(){return(Yt=(0,x.Z)(function*(k){const b=k.name;It.has(b)&&(It.delete(b),yield Promise.all(k.container.getProviders().map(V=>V.delete())),k.isDeleted=!0)})).apply(this,arguments)}function Lt(k,b,V){var K;let te=null!==(K=Ar[k])&&void 0!==K?K:k;V&&(te+=`-${V}`);const he=te.match(/\s|\//),Te=b.match(/\s|\//);if(he||Te){const dt=[`Unable to register library "${te}" with version "${b}":`];return he&&dt.push(`library name "${te}" contains illegal characters (whitespace or "/")`),he&&Te&&dt.push("and"),Te&&dt.push(`version name "${b}" contains illegal characters (whitespace or "/")`),void Dt.warn(dt.join(" "))}Ze(new I.wA(`${te}-version`,()=>({library:te,version:b}),"VERSION"))}function Mt(k,b){if(null!==k&&"function"!=typeof k)throw ut.create("invalid-log-argument");(0,ne.Am)(k,b)}function xe(k){(0,ne.Ub)(k)}const y="firebase-heartbeat-store";let w=null;function O(){return w||(w=function Xe(k,b,{blocked:V,upgrade:K,blocking:te,terminated:he}={}){const Te=indexedDB.open(k,b),dt=Ae(Te);return K&&Te.addEventListener("upgradeneeded",Ye=>{K(Ae(Te.result),Ye.oldVersion,Ye.newVersion,Ae(Te.transaction))}),V&&Te.addEventListener("blocked",()=>V()),dt.then(Ye=>{he&&Ye.addEventListener("close",()=>he()),te&&Ye.addEventListener("versionchange",()=>te())}).catch(()=>{}),dt}("firebase-heartbeat-database",1,{upgrade:(k,b)=>{0===b&&k.createObjectStore(y)}}).catch(k=>{throw ut.create("idb-open",{originalErrorMessage:k.message})})),w}function W(){return(W=(0,x.Z)(function*(k){var b;try{return(yield O()).transaction(y).objectStore(y).get(Je(k))}catch(V){if(V instanceof le.ZR)Dt.warn(V.message);else{const K=ut.create("idb-get",{originalErrorMessage:null===(b=V)||void 0===b?void 0:b.message});Dt.warn(K.message)}}})).apply(this,arguments)}function ae(k,b){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,x.Z)(function*(k,b){var V;try{const te=(yield O()).transaction(y,"readwrite");return yield te.objectStore(y).put(b,Je(k)),te.done}catch(K){if(K instanceof le.ZR)Dt.warn(K.message);else{const te=ut.create("idb-set",{originalErrorMessage:null===(V=K)||void 0===V?void 0:V.message});Dt.warn(te.message)}}})).apply(this,arguments)}function Je(k){return`${k.name}!${k.options.appId}`}class fe{constructor(b){this.container=b,this._heartbeatsCache=null;const V=this.container.getProvider("app").getImmediate();this._storage=new tr(V),this._heartbeatsCachePromise=this._storage.read().then(K=>(this._heartbeatsCache=K,K))}triggerHeartbeat(){var b=this;return(0,x.Z)(function*(){const K=b.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),te=Ft();if(null===b._heartbeatsCache&&(b._heartbeatsCache=yield b._heartbeatsCachePromise),b._heartbeatsCache.lastSentHeartbeatDate!==te&&!b._heartbeatsCache.heartbeats.some(he=>he.date===te))return b._heartbeatsCache.heartbeats.push({date:te,agent:K}),b._heartbeatsCache.heartbeats=b._heartbeatsCache.heartbeats.filter(he=>{const Te=new Date(he.date).valueOf();return Date.now()-Te<=2592e6}),b._storage.overwrite(b._heartbeatsCache)})()}getHeartbeatsHeader(){var b=this;return(0,x.Z)(function*(){if(null===b._heartbeatsCache&&(yield b._heartbeatsCachePromise),null===b._heartbeatsCache||0===b._heartbeatsCache.heartbeats.length)return"";const V=Ft(),{heartbeatsToSend:K,unsentEntries:te}=function Xt(k,b=1024){const V=[];let K=k.slice();for(const te of k){const he=V.find(Te=>Te.agent===te.agent);if(he){if(he.dates.push(te.date),nr(V)>b){he.dates.pop();break}}else if(V.push({agent:te.agent,dates:[te.date]}),nr(V)>b){V.pop();break}K=K.slice(1)}return{heartbeatsToSend:V,unsentEntries:K}}(b._heartbeatsCache.heartbeats),he=(0,le.L)(JSON.stringify({version:2,heartbeats:K}));return b._heartbeatsCache.lastSentHeartbeatDate=V,te.length>0?(b._heartbeatsCache.heartbeats=te,yield b._storage.overwrite(b._heartbeatsCache)):(b._heartbeatsCache.heartbeats=[],b._storage.overwrite(b._heartbeatsCache)),he})()}}function Ft(){return(new Date).toISOString().substring(0,10)}class tr{constructor(b){this.app=b,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,x.Z)(function*(){return!!(0,le.hl)()&&(0,le.eu)().then(()=>!0).catch(()=>!1)})()}read(){var b=this;return(0,x.Z)(function*(){return(yield b._canUseIndexedDBPromise)&&(yield function S(k){return W.apply(this,arguments)}(b.app))||{heartbeats:[]}})()}overwrite(b){var V=this;return(0,x.Z)(function*(){var K;if(yield V._canUseIndexedDBPromise){const he=yield V.read();return ae(V.app,{lastSentHeartbeatDate:null!==(K=b.lastSentHeartbeatDate)&&void 0!==K?K:he.lastSentHeartbeatDate,heartbeats:b.heartbeats})}})()}add(b){var V=this;return(0,x.Z)(function*(){var K;if(yield V._canUseIndexedDBPromise){const he=yield V.read();return ae(V.app,{lastSentHeartbeatDate:null!==(K=b.lastSentHeartbeatDate)&&void 0!==K?K:he.lastSentHeartbeatDate,heartbeats:[...he.heartbeats,...b.heartbeats]})}})()}}function nr(k){return(0,le.L)(JSON.stringify({version:2,heartbeats:k})).length}!function cs(k){Ze(new I.wA("platform-logger",b=>new ye(b),"PRIVATE")),Ze(new I.wA("heartbeat",b=>new fe(b),"PRIVATE")),Lt(qt,"0.8.2",k),Lt(qt,"0.8.2","esm2017"),Lt("fire-js","")}("")},4859:(nt,_e,X)=>{X.d(_e,{H0:()=>Re,wA:()=>ne});var x=X(5861),I=X(2090);class ne{constructor(L,N,J){this.name=L,this.instanceFactory=N,this.type=J,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(L){return this.instantiationMode=L,this}setMultipleInstances(L){return this.multipleInstances=L,this}setServiceProps(L){return this.serviceProps=L,this}setInstanceCreatedCallback(L){return this.onInstanceCreated=L,this}}const le="[DEFAULT]";class Ce{constructor(L,N){this.name=L,this.container=N,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(L){const N=this.normalizeInstanceIdentifier(L);if(!this.instancesDeferred.has(N)){const J=new I.BH;if(this.instancesDeferred.set(N,J),this.isInitialized(N)||this.shouldAutoInitialize())try{const oe=this.getOrInitializeService({instanceIdentifier:N});oe&&J.resolve(oe)}catch(oe){}}return this.instancesDeferred.get(N).promise}getImmediate(L){var N;const J=this.normalizeInstanceIdentifier(null==L?void 0:L.identifier),oe=null!==(N=null==L?void 0:L.optional)&&void 0!==N&&N;if(!this.isInitialized(J)&&!this.shouldAutoInitialize()){if(oe)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:J})}catch(ve){if(oe)return null;throw ve}}getComponent(){return this.component}setComponent(L){if(L.name!==this.name)throw Error(`Mismatching Component ${L.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=L,this.shouldAutoInitialize()){if(function at(B){return"EAGER"===B.instantiationMode}(L))try{this.getOrInitializeService({instanceIdentifier:le})}catch(N){}for(const[N,J]of this.instancesDeferred.entries()){const oe=this.normalizeInstanceIdentifier(N);try{const ve=this.getOrInitializeService({instanceIdentifier:oe});J.resolve(ve)}catch(ve){}}}}clearInstance(L=le){this.instancesDeferred.delete(L),this.instancesOptions.delete(L),this.instances.delete(L)}delete(){var L=this;return(0,x.Z)(function*(){const N=Array.from(L.instances.values());yield Promise.all([...N.filter(J=>"INTERNAL"in J).map(J=>J.INTERNAL.delete()),...N.filter(J=>"_delete"in J).map(J=>J._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(L=le){return this.instances.has(L)}getOptions(L=le){return this.instancesOptions.get(L)||{}}initialize(L={}){const{options:N={}}=L,J=this.normalizeInstanceIdentifier(L.instanceIdentifier);if(this.isInitialized(J))throw Error(`${this.name}(${J}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const oe=this.getOrInitializeService({instanceIdentifier:J,options:N});for(const[ve,vt]of this.instancesDeferred.entries())J===this.normalizeInstanceIdentifier(ve)&&vt.resolve(oe);return oe}onInit(L,N){var J;const oe=this.normalizeInstanceIdentifier(N),ve=null!==(J=this.onInitCallbacks.get(oe))&&void 0!==J?J:new Set;ve.add(L),this.onInitCallbacks.set(oe,ve);const vt=this.instances.get(oe);return vt&&L(vt,oe),()=>{ve.delete(L)}}invokeOnInitCallbacks(L,N){const J=this.onInitCallbacks.get(N);if(J)for(const oe of J)try{oe(L,N)}catch(ve){}}getOrInitializeService({instanceIdentifier:L,options:N={}}){let J=this.instances.get(L);if(!J&&this.component&&(J=this.component.instanceFactory(this.container,{instanceIdentifier:(B=L,B===le?void 0:B),options:N}),this.instances.set(L,J),this.instancesOptions.set(L,N),this.invokeOnInitCallbacks(J,L),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,L,J)}catch(oe){}var B;return J||null}normalizeInstanceIdentifier(L=le){return this.component?this.component.multipleInstances?L:le:L}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Re{constructor(L){this.name=L,this.providers=new Map}addComponent(L){const N=this.getProvider(L.name);if(N.isComponentSet())throw new Error(`Component ${L.name} has already been registered with ${this.name}`);N.setComponent(L)}addOrOverwriteComponent(L){this.getProvider(L.name).isComponentSet()&&this.providers.delete(L.name),this.addComponent(L)}getProvider(L){if(this.providers.has(L))return this.providers.get(L);const N=new Ce(L,this);return this.providers.set(L,N),N}getProviders(){return Array.from(this.providers.values())}}},1877:(nt,_e,X)=>{X.d(_e,{Am:()=>B,Ub:()=>Re,Yd:()=>at,in:()=>I});const x=[];var I=(()=>{return(L=I||(I={}))[L.DEBUG=0]="DEBUG",L[L.VERBOSE=1]="VERBOSE",L[L.INFO=2]="INFO",L[L.WARN=3]="WARN",L[L.ERROR=4]="ERROR",L[L.SILENT=5]="SILENT",I;var L})();const ne={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},le=I.INFO,Ce={[I.DEBUG]:"log",[I.VERBOSE]:"log",[I.INFO]:"info",[I.WARN]:"warn",[I.ERROR]:"error"},ie=(L,N,...J)=>{if(N<L.logLevel)return;const oe=(new Date).toISOString(),ve=Ce[N];if(!ve)throw new Error(`Attempted to log a message with an invalid logType (value: ${N})`);console[ve](`[${oe}]  ${L.name}:`,...J)};class at{constructor(N){this.name=N,this._logLevel=le,this._logHandler=ie,this._userLogHandler=null,x.push(this)}get logLevel(){return this._logLevel}set logLevel(N){if(!(N in I))throw new TypeError(`Invalid value "${N}" assigned to \`logLevel\``);this._logLevel=N}setLogLevel(N){this._logLevel="string"==typeof N?ne[N]:N}get logHandler(){return this._logHandler}set logHandler(N){if("function"!=typeof N)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=N}get userLogHandler(){return this._userLogHandler}set userLogHandler(N){this._userLogHandler=N}debug(...N){this._userLogHandler&&this._userLogHandler(this,I.DEBUG,...N),this._logHandler(this,I.DEBUG,...N)}log(...N){this._userLogHandler&&this._userLogHandler(this,I.VERBOSE,...N),this._logHandler(this,I.VERBOSE,...N)}info(...N){this._userLogHandler&&this._userLogHandler(this,I.INFO,...N),this._logHandler(this,I.INFO,...N)}warn(...N){this._userLogHandler&&this._userLogHandler(this,I.WARN,...N),this._logHandler(this,I.WARN,...N)}error(...N){this._userLogHandler&&this._userLogHandler(this,I.ERROR,...N),this._logHandler(this,I.ERROR,...N)}}function Re(L){x.forEach(N=>{N.setLogLevel(L)})}function B(L,N){for(const J of x){let oe=null;N&&N.level&&(oe=ne[N.level]),J.userLogHandler=null===L?null:(ve,vt,...Se)=>{const pe=Se.map(me=>{if(null==me)return null;if("string"==typeof me)return me;if("number"==typeof me||"boolean"==typeof me)return me.toString();if(me instanceof Error)return me.message;try{return JSON.stringify(me)}catch(At){return null}}).filter(me=>me).join(" ");vt>=(null!=oe?oe:ve.logLevel)&&L({level:I[vt].toLowerCase(),message:pe,args:Se,type:ve.name})}}}},5861:(nt,_e,X)=>{function x(ne,le,Ce,ie,at,Re,B){try{var L=ne[Re](B),N=L.value}catch(J){return void Ce(J)}L.done?le(N):Promise.resolve(N).then(ie,at)}function I(ne){return function(){var le=this,Ce=arguments;return new Promise(function(ie,at){var Re=ne.apply(le,Ce);function B(N){x(Re,ie,at,B,L,"next",N)}function L(N){x(Re,ie,at,B,L,"throw",N)}B(void 0)})}}X.d(_e,{Z:()=>I})}}]);