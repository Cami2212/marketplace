"use strict";(self.webpackChunkchaskigo=self.webpackChunkchaskigo||[]).push([[255],{8667:(M,y,c)=>{c.d(y,{U:()=>f});class f{}},5255:(M,y,c)=>{c.r(y),c.d(y,{CheckoutModule:()=>w});var f=c(9780),Z=c(9808),A=c(2676),g=c(5409),q=c(8667),e=c(5e3),k=c(4961),S=c(9531),U=c(2331),J=c(9763),N=c(6588),h=c(3075);function P(s,l){if(1&s&&(e.TgZ(0,"option",56),e._uU(1),e.qZA()),2&s){const i=l.$implicit;e.Q6J("value",i.name),e.xp6(1),e.Oqu(i.name)}}function x(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor rellene este campo."),e.qZA())}function F(s,l){if(1&s&&(e.TgZ(0,"option",20),e._uU(1),e.qZA()),2&s){const i=l.$implicit;e.Q6J("value",i.name),e.xp6(1),e.Oqu(i.name)}}function I(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor rellene este campo."),e.qZA())}function Q(s,l){if(1&s&&(e.TgZ(0,"option",20),e._uU(1),e.qZA()),2&s){const i=l.$implicit;e.Q6J("value",i.name),e.xp6(1),e.Oqu(i.name)}}function D(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor rellene este campo."),e.qZA())}function O(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor rellene este campo."),e.qZA())}function H(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor rellene este campo."),e.qZA())}function Y(s,l){if(1&s&&(e.TgZ(0,"tr")(1,"td")(2,"a",58),e._uU(3),e.qZA(),e._UZ(4,"div",49),e.TgZ(5,"div",59),e._uU(6,"Cantidad: "),e.TgZ(7,"span",60),e._uU(8),e.qZA()(),e.TgZ(9,"div",61),e._uU(10),e.qZA()(),e.TgZ(11,"td",62),e._UZ(12,"div",63),e.TgZ(13,"div",64),e._UZ(14,"div",65),e.qZA()(),e._uU(15),e.qZA()),2&s){const i=l.$implicit,t=l.last,o=e.oxw();e.xp6(2),e.MGl("href","product/",i.url,"",e.LSH),e.xp6(1),e.hij(" ",i.name,""),e.xp6(1),e.Q6J("innerHTML",i.details,e.oJD),e.xp6(4),e.Oqu(i.quantity),e.xp6(2),e.Oqu(i.shipping),e.xp6(2),e.Q6J("innerHTML",i.price,e.oJD),e.xp6(3),e.hij(" ",t?o.callback():""," ")}}function j(s,l){1&s&&(e.TgZ(0,"div",57),e._uU(1,"Por favor selecciona un m\xe9todo de pago."),e.qZA())}const L=[{path:"",component:(()=>{class s{constructor(i,t,o,a,n,r,d){this.router=i,this.usersService=t,this.productsService=o,this.ordersService=a,this.salesService=n,this.storesService=r,this.activatedRoute=d,this.path=A.y$.url,this.render=!0,this.id=null,this.saveAddress=!1,this.idProduct=null,this.shoppingCart=[],this.dialCode=null,this.flag=null,this.totalP=' <h2 class="text-right">Total <span class="totalCheckout"><div class="spinner-border"></div></span></h2>',this.subTotalP=' <h3 class="text-right">Subtotal <span class="subTotalCheckout"><div class="spinner-border"></div></span></h3>',this.taxP=' <h3 class="text-right">IVA 12% <span class="taxCheckout"><div class="spinner-border"></div></span></h3>',this.totalPrice=[],this.subTotalPrice=[],this.paymentMethod="",this.totalShoppingCart=0,this.addInfo="",this.country=null,this.stCountry="",this.countries=null,this.states=null,this.stState="",this.cities=null,this.stCity="",this.user=new q.U}ngOnInit(){if(this.usersService.authActivate().then(i=>{i&&this.usersService.getFilterData("idToken",localStorage.getItem("idToken")).subscribe(t=>{this.id=Object.keys(t).toString();for(const o in t)this.user.displayName=t[o].displayName,this.user.username=t[o].username,this.user.email=t[o].email,this.user.country=t[o].country,this.stCountry=t[o].country,this.user.state=t[o].state,this.stState=t[o].state,this.user.city=t[o].city,this.stCity=t[o].city,null!=t[o].phone&&(this.user.phone=t[o].phone.split("-")[1],this.dialCode=t[o].phone.split("-")[0]),this.user.address=t[o].address,this.usersService.getCountries().subscribe(a=>{this.countries=a})})}),localStorage.getItem("list")){let i=JSON.parse(localStorage.getItem("list"));if(this.totalShoppingCart=i.length,0==i.length)return void this.router.navigateByUrl("/shopping-cart");for(const t in i)this.productsService.getFilterData("url",i[t].product).subscribe(o=>{for(const a in o){let n='<div class="list-details small text-secondary">';if(i[t].details.length>0){let r=JSON.parse(i[t].details);for(const d in r){let u=Object.keys(r[d]);for(const p in u)n+=`<div>${u[p]}: ${r[d][u[p]]}</div>`}}else if(""!=o[a].specification){let r=JSON.parse(o[a].specification);for(const d in r){let u=Object.keys(r[d]).toString();n+=`<div>${u}: ${r[d][u][0]}</div>`}}n+="</div>",this.shoppingCart.push({url:o[a].url,name:o[a].name,category:o[a].category,image:o[a].image,delivery_time:o[a].delivery_time,quantity:i[t].unit,price:g.XY.fnc(o[a])[0],shipping:Number(o[a].shipping)*Number(i[t].unit),details:n,listDetails:i[t].details,store:o[a].store})}})}else this.router.navigateByUrl("/shopping-cart")}saveAddressFnc(i,t,o,a,n,r){this.saveAddress&&(""!=i.value&&""!=o.value&&""!=t.value&&""!=a.value&&""!=n.value?this.usersService.patchData(this.id,{country:this.user.country,country_code:this.user.country_code,state:this.user.state,city:this.user.city,phone:`${this.dialCode}-${this.user.phone}`,address:this.user.address}).subscribe(u=>{g.Hj.fnc("success","Your data was updated",null)}):(r.checked=!1,g.Hj.fnc("error","Please fill in the required fields",null)))}onSubmit(i){if(i.invalid)g.Hj.fnc("error","Requerimiento Inv\xe1lido",null);else if(g.Hj.fnc("loading","Loading...",null),"payphone"==i.value.paymentMethod){const t=o=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<o;r++)n+=a.charAt(Math.floor(Math.random()*a.length));return n};g.Hj.fnc("html",'<div id="pp-button"></div>',null),g.iW.fnc(100*this.totalPrice[0],t(10),this.user.phone).then(o=>{if("Approved"==o.transactionStatus){localStorage.setItem("id_payment",o.transactionId);let a=0;this.shoppingCart.forEach((n,r)=>{a++,this.productsService.getFilterData("url",n.url).subscribe(v=>{for(const m in v){this.idProduct=v[m].id;let T={sales:Number(v[m].sales)+Number(n.quantity),stock:Number(v[m].stock)-Number(n.quantity)};this.productsService.patchDataAuth(this.idProduct,T,localStorage.getItem("idToken")).subscribe(b=>{})}});let d=Math.floor(Number(n.delivery_time)/2),u=new Date;u.setDate(u.getDate()+d);let p=new Date;p.setDate(p.getDate()+Number(n.delivery_time));let _=[{stage:"reviewed",status:"ok",comment:"Pedido Recibido, en proceso de env\xedo",date:new Date},{stage:"sent",status:"pending",comment:"",date:u},{stage:"delivered",status:"pending",comment:"",date:p}],C={store:n.store,user:this.user.username,product:n.name,url:n.url,image:n.image,category:n.category,quantity:n.quantity,price:this.subTotalPrice[r],email:i.value.email,country:i.value.country,city:i.value.city,phone:`${this.dialCode}-${i.value.phone}`,address:i.value.address,info:i.value.addInfo,date:new Date,process:JSON.stringify(_),status:"pending"};this.ordersService.registerDatabase(C,localStorage.getItem("idToken")).subscribe(v=>{if(""!=v.name){let m=0,T=0;m=.25*this.subTotalPrice[r],T=.75*this.subTotalPrice[r];let b={id_order:v.name,client:this.user.username,product:n.name,url:n.url,quantity:n.quantity,unit_price:T.toFixed(2),commission:m.toFixed(2),total:this.subTotalPrice[r],payment_method:i.value.paymentMethod,id_payment:localStorage.getItem("id_payment"),date:new Date,status:"pending"};this.salesService.registerDatabase(b,localStorage.getItem("idToken")).subscribe(R=>{})}})}),a==this.shoppingCart.length&&(localStorage.removeItem("list"),g.Hj.fnc("success","Pago "+o.transactionId+" recibido, estado "+o.transactionStatus+"  Su pedido a sido enviado satisfactoriamente!","account/my-shopping"))}else g.Hj.fnc("error","No se pudo realizar el pago, por favor intente nuevamente",null)})}else g.Hj.fnc("error","Invalid request",null)}onCountrySelected(i){console.log(i.target.value),this.countries.forEach(t=>{i.value==t.name&&(this.usersService.getStates(t.iso2).subscribe(o=>{this.states=o,this.country=t.iso2}),this.usersService.getInfoCountry(t.iso2).subscribe(o=>{let a=Object.keys(o),n=Object.values(o);for(let r=0;r<a.length;r++)"phonecode"==a[r]?this.dialCode=n[r]:"emoji"==a[r]&&(this.flag=n[r])}))})}onStateSelected(i){this.states.forEach(t=>{i.value==t.name&&this.usersService.getCity(this.country,t.iso2).subscribe(o=>{this.cities=o})})}callback(){if(this.render){this.render=!1;let t=this.totalPrice,o=this.subTotalPrice;setTimeout(function(){let a=$(".pCheckout .end-price"),n=$(".qCheckout"),r=$(".sCheckout"),d=$(".subTotalPriceCheckout"),u=0,p=0,_=0;for(let C=0;C<a.length;C++){let v=Number($(a[C]).html())+Number($(r[C]).html()),m=Number($(n[C]).html())*v;$(d[C]).html(`$${m.toFixed(2)}`),o.push(m.toFixed(2)),u+=m,p=u/1.12,_=u-p}$(".subTotalCheckout").html(`$${p.toFixed(2)}`),$(".taxCheckout").html(`$${_.toFixed(2)}`),$(".totalCheckout").html(`$${u.toFixed(2)}`),t.push(u.toFixed(2))},500*this.totalShoppingCart)}}}return s.\u0275fac=function(i){return new(i||s)(e.Y36(f.F0),e.Y36(k.f),e.Y36(S.s),e.Y36(U.N),e.Y36(J.M),e.Y36(N._),e.Y36(f.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-checkout"]],decls:135,vars:32,consts:[[1,"ps-breadcrumb"],[1,"container"],[1,"breadcrumb"],["routerLink","/"],["href","shopping-cart"],[1,"ps-checkout","ps-section--shopping"],[1,"ps-section__header"],[1,"ps-section__content"],[1,"ps-form--checkout",3,"ngSubmit"],["f","ngForm"],[1,"row"],[1,"col-xl-7","col-lg-8","col-sm-12"],[1,"ps-form__billing-info"],[1,"ps-form__heading"],[1,"form-group"],[1,"form-group__content"],["type","text","name","displayName","readonly","","required","",1,"form-control",3,"ngModel","ngModelChange"],["type","email","name","email","email","","readonly","","required","",1,"form-control",3,"ngModel","ngModelChange"],["name","country","required","",1,"form-control",3,"ngModel","ngModelChange","change"],["country",""],[3,"value"],[3,"value","ngValue",4,"ngFor","ngForOf"],["class","text-danger",4,"ngIf"],["type","text","name","state","required","",1,"form-control",3,"ngModel","ngModelChange","change"],["state",""],[3,"value",4,"ngFor","ngForOf"],["type","text","name","city","required","",1,"form-control",3,"ngModel","ngModelChange"],["inputCity",""],[1,"form-group__content","input-group"],[1,"input-group-append"],[1,"input-group-text"],["type","text","name","phone","required","",1,"form-control",3,"ngModel","ngModelChange"],["inputPhone",""],["type","text","name","address","required","",1,"form-control",3,"ngModel","ngModelChange"],["inputAddress",""],[1,"ps-checkbox"],["type","checkbox","id","create-account","name","saveAddress",1,"form-control",3,"ngModel","ngModelChange","change"],["inputSaveAddress",""],["for","create-account"],[1,"mt-40"],["rows","7","placeholder","Notas sobre tu pedido, e.g. Notas especiales para la entrega.","name","addInfo",1,"form-control",3,"ngModel","ngModelChange"],[1,"col-xl-5","col-lg-4","col-sm-12"],[1,"ps-form__total"],[1,"content"],[1,"ps-block--checkout-total"],[1,"ps-block__header","d-flex","justify-content-between"],[1,"ps-block__content"],[1,"table","ps-block__products"],[4,"ngFor","ngForOf"],[3,"innerHTML"],[1,"py-3"],[1,"ps-radio"],["type","radio","id","payphone","name","paymentMethod","value","payphone","required","",1,"form-control",3,"ngModel","ngModelChange"],["for","payphone"],[1,"w-25",3,"src"],["type","submit",1,"ps-btn","ps-btn--fullwidth"],[3,"value","ngValue"],[1,"text-danger"],[3,"href"],[1,"small","text-secondary"],[1,"qCheckout"],[1,"d-none","sCheckout"],[1,"text-right","ps-product"],[1,"d-none","pCheckout",3,"innerHTML"],[1,"subTotalPriceCheckout"],[1,"spinner-border"]],template:function(i,t){if(1&i){const o=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"ul",2)(3,"li")(4,"a",3),e._uU(5,"Home"),e.qZA()(),e.TgZ(6,"li")(7,"a",4),e._uU(8,"Carrito de Compras"),e.qZA()(),e.TgZ(9,"li"),e._uU(10,"Checkout"),e.qZA()()()(),e.TgZ(11,"div",5)(12,"div",1)(13,"div",6)(14,"h1"),e._uU(15,"Checkout"),e.qZA()(),e.TgZ(16,"div",7)(17,"form",8,9),e.NdJ("ngSubmit",function(){e.CHM(o);const n=e.MAs(18);return t.onSubmit(n)}),e.TgZ(19,"div",10)(20,"div",11)(21,"div",12)(22,"h3",13),e._uU(23,"Detalles de Facturaci\xf3n"),e.qZA(),e.TgZ(24,"div",14)(25,"label"),e._uU(26,"Nombres"),e.qZA(),e.TgZ(27,"div",15)(28,"input",16),e.NdJ("ngModelChange",function(n){return t.user.displayName=n}),e.qZA()()(),e.TgZ(29,"div",14)(30,"label"),e._uU(31,"Correo Electr\xf3nico"),e.qZA(),e.TgZ(32,"div",15)(33,"input",17),e.NdJ("ngModelChange",function(n){return t.user.email=n}),e.qZA()()(),e.TgZ(34,"div",14)(35,"label"),e._uU(36,"Pa\xeds"),e.TgZ(37,"sup"),e._uU(38,"*"),e.qZA()(),e.TgZ(39,"div",15)(40,"select",18,19),e.NdJ("ngModelChange",function(n){return t.user.country=n})("change",function(n){return t.onCountrySelected(n)}),e.TgZ(42,"option",20),e._uU(43),e.qZA(),e.YNc(44,P,2,2,"option",21),e.qZA(),e.YNc(45,x,2,0,"div",22),e.qZA()(),e.TgZ(46,"div",14)(47,"label"),e._uU(48,"Provincia"),e.TgZ(49,"sup"),e._uU(50,"*"),e.qZA()(),e.TgZ(51,"div",15)(52,"select",23,24),e.NdJ("ngModelChange",function(n){return t.user.state=n})("change",function(){e.CHM(o);const n=e.MAs(53);return t.onStateSelected(n)}),e.TgZ(54,"option",20),e._uU(55),e.qZA(),e.YNc(56,F,2,2,"option",25),e.qZA(),e.YNc(57,I,2,0,"div",22),e.qZA()(),e.TgZ(58,"div",14)(59,"label"),e._uU(60,"Ciudad"),e.TgZ(61,"sup"),e._uU(62,"*"),e.qZA()(),e.TgZ(63,"div",15)(64,"select",26,27),e.NdJ("ngModelChange",function(n){return t.user.city=n}),e.TgZ(66,"option",20),e._uU(67),e.qZA(),e.YNc(68,Q,2,2,"option",25),e.qZA(),e.YNc(69,D,2,0,"div",22),e.qZA()(),e.TgZ(70,"div",14)(71,"label"),e._uU(72,"Tel\xe9fono"),e.TgZ(73,"sup"),e._uU(74,"*"),e.qZA()(),e.TgZ(75,"div",28)(76,"div",29)(77,"span",30),e._uU(78),e.qZA()(),e.TgZ(79,"input",31,32),e.NdJ("ngModelChange",function(n){return t.user.phone=n}),e.qZA(),e.YNc(81,O,2,0,"div",22),e.qZA()(),e.TgZ(82,"div",14)(83,"label"),e._uU(84,"Direcci\xf3n"),e.TgZ(85,"sup"),e._uU(86,"*"),e.qZA()(),e.TgZ(87,"div",15)(88,"input",33,34),e.NdJ("ngModelChange",function(n){return t.user.address=n}),e.qZA(),e.YNc(90,H,2,0,"div",22),e.qZA()(),e.TgZ(91,"div",14)(92,"div",35)(93,"input",36,37),e.NdJ("ngModelChange",function(n){return t.saveAddress=n})("change",function(){e.CHM(o);const n=e.MAs(41),r=e.MAs(53),d=e.MAs(65),u=e.MAs(80),p=e.MAs(89),_=e.MAs(94);return t.saveAddressFnc(n,r,d,u,p,_)}),e.qZA(),e.TgZ(95,"label",38),e._uU(96,"Guardar Direcci\xf3n?"),e.qZA()()(),e.TgZ(97,"h3",39),e._uU(98," Informaci\xf3n Adicional"),e.qZA(),e.TgZ(99,"div",14)(100,"label"),e._uU(101,"Notas de Orden"),e.qZA(),e.TgZ(102,"div",15)(103,"textarea",40),e.NdJ("ngModelChange",function(n){return t.addInfo=n}),e.qZA()()()()(),e.TgZ(104,"div",41)(105,"div",42)(106,"h2",13),e._uU(107,"Tu pedido"),e.qZA(),e.TgZ(108,"div",43)(109,"div",44)(110,"div",45)(111,"p"),e._uU(112,"Producto(s)"),e.qZA(),e.TgZ(113,"p"),e._uU(114,"SubTotal"),e.qZA()(),e.TgZ(115,"div",46)(116,"table",47)(117,"tbody"),e.YNc(118,Y,16,7,"tr",48),e.qZA()(),e._UZ(119,"div",49)(120,"div",49)(121,"div",49),e.qZA()(),e._UZ(122,"hr",50),e.TgZ(123,"h3",13),e._uU(124,"Seleccionar M\xe9todo de Pago"),e.qZA(),e.YNc(125,j,2,0,"div",22),e.TgZ(126,"div",14)(127,"div",51)(128,"input",52),e.NdJ("ngModelChange",function(n){return t.paymentMethod=n}),e.qZA(),e.TgZ(129,"label",53),e._uU(130,"Pagar con PayPhone? "),e.TgZ(131,"span"),e._UZ(132,"img",54),e.qZA()()()(),e.TgZ(133,"button",55),e._uU(134,"Proceder al Pago"),e.qZA()()()()()()()()()}if(2&i){const o=e.MAs(18);e.xp6(28),e.Q6J("ngModel",t.user.displayName),e.xp6(5),e.Q6J("ngModel",t.user.email),e.xp6(7),e.Q6J("ngModel",t.user.country),e.xp6(2),e.s9C("value",t.stCountry),e.xp6(1),e.Oqu(t.stCountry),e.xp6(1),e.Q6J("ngForOf",t.countries),e.xp6(1),e.Q6J("ngIf",o.submitted&&o.controls.country.errors),e.xp6(7),e.Q6J("ngModel",t.user.state),e.xp6(2),e.s9C("value",t.stState),e.xp6(1),e.Oqu(t.stState),e.xp6(1),e.Q6J("ngForOf",t.states),e.xp6(1),e.Q6J("ngIf",o.submitted&&o.controls.state.errors),e.xp6(7),e.Q6J("ngModel",t.user.city),e.xp6(2),e.s9C("value",t.stCity),e.xp6(1),e.Oqu(t.stCity),e.xp6(1),e.Q6J("ngForOf",t.cities),e.xp6(1),e.Q6J("ngIf",o.submitted&&o.controls.city.errors),e.xp6(9),e.AsE("",t.flag,"",t.dialCode,""),e.xp6(1),e.Q6J("ngModel",t.user.phone),e.xp6(2),e.Q6J("ngIf",o.submitted&&o.controls.phone.errors),e.xp6(7),e.Q6J("ngModel",t.user.address),e.xp6(2),e.Q6J("ngIf",o.submitted&&o.controls.address.errors),e.xp6(3),e.Q6J("ngModel",t.saveAddress),e.xp6(10),e.Q6J("ngModel",t.addInfo),e.xp6(15),e.Q6J("ngForOf",t.shoppingCart),e.xp6(1),e.Q6J("innerHTML",t.subTotalP,e.oJD),e.xp6(1),e.Q6J("innerHTML",t.taxP,e.oJD),e.xp6(1),e.Q6J("innerHTML",t.totalP,e.oJD),e.xp6(4),e.Q6J("ngIf",o.submitted&&o.controls.paymentMethod.errors),e.xp6(3),e.Q6J("ngModel",t.paymentMethod),e.xp6(4),e.MGl("src","",t.path,"img/payment-method/payphone.png",e.LSH)}},directives:[f.yS,h._Y,h.JL,h.F,h.Fj,h.Q7,h.JJ,h.On,h.on,h.EJ,h.YN,h.Kr,Z.sg,Z.O5,h.Wl,h._],styles:[""]}),s})()}];let E=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[f.Bz.forChild(L)],f.Bz]}),s})(),w=(()=>{class s{}return s.\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[Z.ez,f.Bz,E,h.u5]]}),s})()}}]);